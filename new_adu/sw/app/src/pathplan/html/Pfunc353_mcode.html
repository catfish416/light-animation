<!-- saved from url=(0014)about:internet -->
<div class="dead">
<pre class="code">
<span class="srcline"><span class="lineno"><a href="80,1" id="srcline1">   1</a></span><span class="line">function [xoptres,PlanRes,KurMax,...</span></span>
<span class="srcline"><span class="lineno"><a href="80,2" id="srcline2">   2</a></span><span class="line">          IterGoldenStep,IterQpStep,IterSQPStep,...</span></span>
<span class="srcline"><span class="lineno"><a href="80,3" id="srcline3">   3</a></span><span class="line">          PathPlanRetryFlg] = PathCreatorLC(Info_FdIn,Info_FoIn,Info_LdIn,Info_LoIn,Info_MeIn,...</span></span>
<span class="srcline"><span class="lineno"><a href="80,4" id="srcline4">   4</a></span><span class="line">                                            x_inIn,y_inIn,angle_inIn,y_outIn,angle_outIn,x_outIn,...</span></span>
<span class="srcline"><span class="lineno"><a href="80,5" id="srcline5">   5</a></span><span class="line">                                            TrigFlg,X_melimit_In,N,N2,PathFinishFlg,...</span></span>
<span class="srcline"><span class="lineno"><a href="80,6" id="srcline6">   6</a></span><span class="line">                                            SpeedLimitIn,aylimitIn,axlimitIn,LBx,LBu,...</span></span>
<span class="srcline"><span class="lineno"><a href="80,7" id="srcline7">   7</a></span><span class="line">                                            CurOp,NoFailResFlg,SpeedInCr)</span></span>
<span class="srcline"><span class="lineno"><a href="80,8" id="srcline8">   8</a></span><span class="line"><span class="comment">%     global Aylimit Axlimit X_melimit k_maxlimit Tc V L_veh  X L_me T_adj H AngleTC  Y W_veh  W_me X_me MSS x_qitemp y_qitemp theta_qitemp;</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,9" id="srcline9">   9</a></span><span class="line">    global k_localmaxTemp Nlimit Nlimit2 X V V_me</span></span>
<span class="srcline"><span class="lineno"><a href="80,10" id="srcline10">  10</a></span><span class="line">    persistent TrigCnt FinishFlg Pxoptres PPlanRes PKurMax </span></span>
<span class="srcline"><span class="lineno"><a href="80,11" id="srcline11">  11</a></span><span class="line">    if isempty(TrigCnt)||(PathFinishFlg &gt; 1e-1)||(CurOp &lt; 5)</span></span>
<span class="srcline"><span class="lineno"><a href="80,12" id="srcline12">  12</a></span><span class="line">        TrigCnt=0;Pxoptres=[0 0 0]';PPlanRes=0;PKurMax=0; </span></span>
<span class="srcline"><span class="lineno"><a href="80,13" id="srcline13">  13</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,14" id="srcline14">  14</a></span><span class="line">    if isempty(FinishFlg)||(PathFinishFlg &gt; 1e-1)||(CurOp &lt; 5)</span></span>
<span class="srcline"><span class="lineno"><a href="80,15" id="srcline15">  15</a></span><span class="line">        FinishFlg = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,16" id="srcline16">  16</a></span><span class="line">    end    </span></span>
<span class="srcline"><span class="lineno"><a href="80,17" id="srcline17">  17</a></span><span class="line">    Nlimit = N;Nlimit2 = N2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,18" id="srcline18">  18</a></span><span class="line">    xoptres = [0 0 0]';PlanRes = 0; KurMax = 0;T_long = 4; PathPlanRetryFlg = 0;IterGoldenStep = 0;IterQpStep = 0;IterSQPStep = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,19" id="srcline19">  19</a></span><span class="line">    <span class="comment">%Edge Trigger</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,20" id="srcline20">  20</a></span><span class="line">    if (TrigFlg &gt; 1e-1)</span></span>
<span class="srcline"><span class="lineno"><a href="80,21" id="srcline21">  21</a></span><span class="line">        FinishFlg = 0;Pxoptres=[0 0 0]';PPlanRes=0;PKurMax=0;TrigCnt = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,22" id="srcline22">  22</a></span><span class="line">        if X_melimit_In&gt;200</span></span>
<span class="srcline"><span class="lineno"><a href="80,23" id="srcline23">  23</a></span><span class="line">            X_melimit_In = 200;</span></span>
<span class="srcline"><span class="lineno"><a href="80,24" id="srcline24">  24</a></span><span class="line">        end</span></span>
<span class="srcline"><span class="lineno"><a href="80,25" id="srcline25">  25</a></span><span class="line">        PreGlbVal(x_inIn,y_inIn,angle_inIn,x_outIn,y_outIn,angle_outIn,Info_FdIn,Info_FoIn,Info_LdIn,Info_LoIn,Info_MeIn,X_melimit_In,aylimitIn,axlimitIn);</span></span>
<span class="srcline"><span class="lineno"><a href="80,26" id="srcline26">  26</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,27" id="srcline27">  27</a></span><span class="line">    if FinishFlg == 0</span></span>
<span class="srcline"><span class="lineno"><a href="80,28" id="srcline28">  28</a></span><span class="line">        LB = [LBx,0.2,1];UB = [min([LBu,X_melimit_In]),1,min([SpeedLimitIn,V_me+SpeedInCr])];x0 = [(2*UB(1)+LB(1))/3,(2*UB(2)+LB(2))/3,(2*UB(3)+LB(3))/3];</span></span>
<span class="srcline"><span class="lineno"><a href="80,29" id="srcline29">  29</a></span><span class="line">        if abs(V(3)) &lt; 30 &amp;&amp; abs(X(3))&lt;200</span></span>
<span class="srcline"><span class="lineno"><a href="80,30" id="srcline30">  30</a></span><span class="line">            if X(3) &lt; ((V_me - V(3))*abs(V_me - V(3))/4 + 10)</span></span>
<span class="srcline"><span class="lineno"><a href="80,31" id="srcline31">  31</a></span><span class="line">                <span class="comment">% X(3) &lt; 100</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,32" id="srcline32">  32</a></span><span class="line">                UB(3) = min([min([SpeedLimitIn,V_me+SpeedInCr]),abs(V(3)*1.2)]);</span></span>
<span class="srcline"><span class="lineno"><a href="80,33" id="srcline33">  33</a></span><span class="line">            end</span></span>
<span class="srcline"><span class="lineno"><a href="80,34" id="srcline34">  34</a></span><span class="line">        end</span></span>
<span class="srcline"><span class="lineno"><a href="80,35" id="srcline35">  35</a></span><span class="line">        [xoptres,Res,Sts,IterGoldenStep,IterQpStep] = SQPCal(x0',LB',UB',TrigCnt);</span></span>
<span class="srcline"><span class="lineno"><a href="80,36" id="srcline36">  36</a></span><span class="line">        if Sts == 1</span></span>
<span class="srcline"><span class="lineno"><a href="80,37" id="srcline37">  37</a></span><span class="line">            FinishFlg = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,38" id="srcline38">  38</a></span><span class="line">            if Res == 1 || NoFailResFlg &gt; 0.5</span></span>
<span class="srcline"><span class="lineno"><a href="80,39" id="srcline39">  39</a></span><span class="line">                PlanRes = 1;  TrigCnt = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,40" id="srcline40">  40</a></span><span class="line">                KurMax = max(k_localmaxTemp);</span></span>
<span class="srcline"><span class="lineno"><a href="80,41" id="srcline41">  41</a></span><span class="line">                Pxoptres=xoptres;PPlanRes=PlanRes;PKurMax=KurMax;</span></span>
<span class="srcline"><span class="lineno"><a href="80,42" id="srcline42">  42</a></span><span class="line">            else</span></span>
<span class="srcline"><span class="lineno"><a href="80,43" id="srcline43">  43</a></span><span class="line">                <span class="comment">%Fail to cal the path</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,44" id="srcline44">  44</a></span><span class="line">                PathPlanRetryFlg = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,45" id="srcline45">  45</a></span><span class="line">            end</span></span>
<span class="srcline"><span class="lineno"><a href="80,46" id="srcline46">  46</a></span><span class="line">        else</span></span>
<span class="srcline"><span class="lineno"><a href="80,47" id="srcline47">  47</a></span><span class="line">            TrigCnt = TrigCnt + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,48" id="srcline48">  48</a></span><span class="line">            IterSQPStep = TrigCnt;</span></span>
<span class="srcline"><span class="lineno"><a href="80,49" id="srcline49">  49</a></span><span class="line">        end</span></span>
<span class="srcline"><span class="lineno"><a href="80,50" id="srcline50">  50</a></span><span class="line">    else</span></span>
<span class="srcline"><span class="lineno"><a href="80,51" id="srcline51">  51</a></span><span class="line">        xoptres = Pxoptres;PlanRes = PPlanRes;KurMax = PKurMax;</span></span>
<span class="srcline"><span class="lineno"><a href="80,52" id="srcline52">  52</a></span><span class="line">    end  </span></span>
<span class="srcline"><span class="lineno"><a href="80,53" id="srcline53">  53</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,54" id="srcline54">  54</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,55" id="srcline55">  55</a></span><span class="line">function [xoptim,Res,Sts,IterGoldenStep,IterQpStep] = SQPCal(x0,LB,UB,Trig)</span></span>
<span class="srcline"><span class="lineno"><a href="80,56" id="srcline56">  56</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,57" id="srcline57">  57</a></span><span class="line">    global ratio</span></span>
<span class="srcline"><span class="lineno"><a href="80,58" id="srcline58">  58</a></span><span class="line">    global Nlimit2</span></span>
<span class="srcline"><span class="lineno"><a href="80,59" id="srcline59">  59</a></span><span class="line">    persistent FinishFlg Pdk PLamda Px1 PCostGTemp PConGTemp StepTrigFlg RunCnt PHk PBk PCurStep PCostG PConG PHx PPfunc PPosiblx PPfuncVal</span></span>
<span class="srcline"><span class="lineno"><a href="80,60" id="srcline60">  60</a></span><span class="line">    if isempty(RunCnt)</span></span>
<span class="srcline"><span class="lineno"><a href="80,61" id="srcline61">  61</a></span><span class="line">        RunCnt = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,62" id="srcline62">  62</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,63" id="srcline63">  63</a></span><span class="line">    if isempty(PHk)   </span></span>
<span class="srcline"><span class="lineno"><a href="80,64" id="srcline64">  64</a></span><span class="line">        PHk = eye(3);</span></span>
<span class="srcline"><span class="lineno"><a href="80,65" id="srcline65">  65</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,66" id="srcline66">  66</a></span><span class="line">    if isempty(PBk)   </span></span>
<span class="srcline"><span class="lineno"><a href="80,67" id="srcline67">  67</a></span><span class="line">        PBk = eye(3);</span></span>
<span class="srcline"><span class="lineno"><a href="80,68" id="srcline68">  68</a></span><span class="line">    end    </span></span>
<span class="srcline"><span class="lineno"><a href="80,69" id="srcline69">  69</a></span><span class="line">    if isempty(FinishFlg)</span></span>
<span class="srcline"><span class="lineno"><a href="80,70" id="srcline70">  70</a></span><span class="line">        FinishFlg = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,71" id="srcline71">  71</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,72" id="srcline72">  72</a></span><span class="line">    if isempty(Pdk)</span></span>
<span class="srcline"><span class="lineno"><a href="80,73" id="srcline73">  73</a></span><span class="line">        Pdk = [1 1 1]';</span></span>
<span class="srcline"><span class="lineno"><a href="80,74" id="srcline74">  74</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,75" id="srcline75">  75</a></span><span class="line">    if isempty(PLamda)</span></span>
<span class="srcline"><span class="lineno"><a href="80,76" id="srcline76">  76</a></span><span class="line">        PLamda = ones(15,1);</span></span>
<span class="srcline"><span class="lineno"><a href="80,77" id="srcline77">  77</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,78" id="srcline78">  78</a></span><span class="line">    if isempty(Px1)</span></span>
<span class="srcline"><span class="lineno"><a href="80,79" id="srcline79">  79</a></span><span class="line">        Px1 = x0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,80" id="srcline80">  80</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,81" id="srcline81">  81</a></span><span class="line">    if isempty(PCostGTemp)</span></span>
<span class="srcline"><span class="lineno"><a href="80,82" id="srcline82">  82</a></span><span class="line">        PCostGTemp = zeros(3,1);</span></span>
<span class="srcline"><span class="lineno"><a href="80,83" id="srcline83">  83</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,84" id="srcline84">  84</a></span><span class="line">    if isempty(PConGTemp)</span></span>
<span class="srcline"><span class="lineno"><a href="80,85" id="srcline85">  85</a></span><span class="line">        PConGTemp = zeros(3,15);</span></span>
<span class="srcline"><span class="lineno"><a href="80,86" id="srcline86">  86</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,87" id="srcline87">  87</a></span><span class="line">    if isempty(StepTrigFlg)</span></span>
<span class="srcline"><span class="lineno"><a href="80,88" id="srcline88">  88</a></span><span class="line">        StepTrigFlg = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,89" id="srcline89">  89</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,90" id="srcline90">  90</a></span><span class="line">    if isempty(PCurStep)</span></span>
<span class="srcline"><span class="lineno"><a href="80,91" id="srcline91">  91</a></span><span class="line">        <span class="comment">% 1 golden 2 qpsub</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,92" id="srcline92">  92</a></span><span class="line">        PCurStep = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,93" id="srcline93">  93</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,94" id="srcline94">  94</a></span><span class="line">    if isempty(PCostG)</span></span>
<span class="srcline"><span class="lineno"><a href="80,95" id="srcline95">  95</a></span><span class="line">        PCostG = zeros(3,1);</span></span>
<span class="srcline"><span class="lineno"><a href="80,96" id="srcline96">  96</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,97" id="srcline97">  97</a></span><span class="line">    if isempty(PConG)</span></span>
<span class="srcline"><span class="lineno"><a href="80,98" id="srcline98">  98</a></span><span class="line">        PConG = zeros(3,15);</span></span>
<span class="srcline"><span class="lineno"><a href="80,99" id="srcline99">  99</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,100" id="srcline100"> 100</a></span><span class="line">    if isempty(PHx)</span></span>
<span class="srcline"><span class="lineno"><a href="80,101" id="srcline101"> 101</a></span><span class="line">        PHx = zeros(1,15);PPfunc = 100;PPosiblx = x0;PPfuncVal = 100;</span></span>
<span class="srcline"><span class="lineno"><a href="80,102" id="srcline102"> 102</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,103" id="srcline103"> 103</a></span><span class="line">    ratio = 1e3;</span></span>
<span class="srcline"><span class="lineno"><a href="80,104" id="srcline104"> 104</a></span><span class="line">    limit1 = [0 0 0];limit2 = [0 0 0];lolimit = [0 0 0];hilimit = [0 0 0]; Alpha = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,105" id="srcline105"> 105</a></span><span class="line">    dk = [1 1 1]'; Lamda = ones(15,1);  x1 = x0;Bk=eye(3);Hk=eye(3);xoptim = x0;CostGTemp = zeros(3,1);ConGTemp = zeros(3,15);Sts = 0;Res = 0;CostG = zeros(3,1);ConG = zeros(3,15);Hx = zeros(1,15);</span></span>
<span class="srcline"><span class="lineno"><a href="80,106" id="srcline106"> 106</a></span><span class="line"><span class="comment">%     while (1)</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,107" id="srcline107"> 107</a></span><span class="line">    IterGoldenStep = 0;IterQpStep = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,108" id="srcline108"> 108</a></span><span class="line">    if PCurStep == 1</span></span>
<span class="srcline"><span class="lineno"><a href="80,109" id="srcline109"> 109</a></span><span class="line">        if (RunCnt == 0)</span></span>
<span class="srcline"><span class="lineno"><a href="80,110" id="srcline110"> 110</a></span><span class="line">            <span class="comment">%First Trig </span></span></span>
<span class="srcline"><span class="lineno"><a href="80,111" id="srcline111"> 111</a></span><span class="line">            RunCnt = RunCnt + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,112" id="srcline112"> 112</a></span><span class="line">            FinishFlg = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,113" id="srcline113"> 113</a></span><span class="line">            [CostG,ConG,Costx,Hx]=GradientCal(x0,LB,UB);</span></span>
<span class="srcline"><span class="lineno"><a href="80,114" id="srcline114"> 114</a></span><span class="line">            CostGTemp = CostG;</span></span>
<span class="srcline"><span class="lineno"><a href="80,115" id="srcline115"> 115</a></span><span class="line">            ConGTemp = ConG;</span></span>
<span class="srcline"><span class="lineno"><a href="80,116" id="srcline116"> 116</a></span><span class="line"><span class="comment">%             PPfunc = Pfunc(x0,LB,UB);</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,117" id="srcline117"> 117</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,118" id="srcline118"> 118</a></span><span class="line">            PPfunc = -x0(3)+ratio*norm(min([0,min(Hx)]),1);</span></span>
<span class="srcline"><span class="lineno"><a href="80,119" id="srcline119"> 119</a></span><span class="line">            PPosiblx = x0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,120" id="srcline120"> 120</a></span><span class="line">            PPfuncVal = PPfunc;</span></span>
<span class="srcline"><span class="lineno"><a href="80,121" id="srcline121"> 121</a></span><span class="line">        else</span></span>
<span class="srcline"><span class="lineno"><a href="80,122" id="srcline122"> 122</a></span><span class="line">            <span class="comment">%LoadFrom Previous Step</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,123" id="srcline123"> 123</a></span><span class="line">            dk = Pdk;Lamda = PLamda;x1 = Px1;CostGTemp = PCostGTemp;ConGTemp = PConGTemp;Hk = PHk;Bk = PBk;</span></span>
<span class="srcline"><span class="lineno"><a href="80,124" id="srcline124"> 124</a></span><span class="line">            n = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,125" id="srcline125"> 125</a></span><span class="line">            while(1)</span></span>
<span class="srcline"><span class="lineno"><a href="80,126" id="srcline126"> 126</a></span><span class="line">                for i = 1:3</span></span>
<span class="srcline"><span class="lineno"><a href="80,127" id="srcline127"> 127</a></span><span class="line">                    if abs(dk(i)) &lt; 1e-4</span></span>
<span class="srcline"><span class="lineno"><a href="80,128" id="srcline128"> 128</a></span><span class="line">                        limit1(i) = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,129" id="srcline129"> 129</a></span><span class="line">                        limit2(i) = 1e4;                </span></span>
<span class="srcline"><span class="lineno"><a href="80,130" id="srcline130"> 130</a></span><span class="line">                    else</span></span>
<span class="srcline"><span class="lineno"><a href="80,131" id="srcline131"> 131</a></span><span class="line">                        limit1(i) = ((LB(i) - x1(i))./dk(i));</span></span>
<span class="srcline"><span class="lineno"><a href="80,132" id="srcline132"> 132</a></span><span class="line">                        limit2(i) = ((UB(i) - x1(i))./dk(i));</span></span>
<span class="srcline"><span class="lineno"><a href="80,133" id="srcline133"> 133</a></span><span class="line">                    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,134" id="srcline134"> 134</a></span><span class="line">                    lolimit(i) = min([limit1(i),limit2(i)]);</span></span>
<span class="srcline"><span class="lineno"><a href="80,135" id="srcline135"> 135</a></span><span class="line">                    hilimit(i) = max([limit1(i),limit2(i)]);</span></span>
<span class="srcline"><span class="lineno"><a href="80,136" id="srcline136"> 136</a></span><span class="line">                end</span></span>
<span class="srcline"><span class="lineno"><a href="80,137" id="srcline137"> 137</a></span><span class="line">                Lo = max([lolimit,0]);</span></span>
<span class="srcline"><span class="lineno"><a href="80,138" id="srcline138"> 138</a></span><span class="line">                Hi = min(hilimit);</span></span>
<span class="srcline"><span class="lineno"><a href="80,139" id="srcline139"> 139</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="80,140" id="srcline140"> 140</a></span><span class="line">                if (n &lt;= 3)&amp;&amp;((Hi &lt;=0)||(Hi &lt; Lo))</span></span>
<span class="srcline"><span class="lineno"><a href="80,141" id="srcline141"> 141</a></span><span class="line">                    n = n+1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,142" id="srcline142"> 142</a></span><span class="line">                    if Hi &lt;= 0</span></span>
<span class="srcline"><span class="lineno"><a href="80,143" id="srcline143"> 143</a></span><span class="line">                        for i = 1:3</span></span>
<span class="srcline"><span class="lineno"><a href="80,144" id="srcline144"> 144</a></span><span class="line">                            if hilimit(i)&lt;1e-3 || hilimit(i) &lt; Lo</span></span>
<span class="srcline"><span class="lineno"><a href="80,145" id="srcline145"> 145</a></span><span class="line">                                dk(i) = 0;                               </span></span>
<span class="srcline"><span class="lineno"><a href="80,146" id="srcline146"> 146</a></span><span class="line">                            end</span></span>
<span class="srcline"><span class="lineno"><a href="80,147" id="srcline147"> 147</a></span><span class="line">                        end</span></span>
<span class="srcline"><span class="lineno"><a href="80,148" id="srcline148"> 148</a></span><span class="line">                    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,149" id="srcline149"> 149</a></span><span class="line">                else</span></span>
<span class="srcline"><span class="lineno"><a href="80,150" id="srcline150"> 150</a></span><span class="line">                    break;</span></span>
<span class="srcline"><span class="lineno"><a href="80,151" id="srcline151"> 151</a></span><span class="line">                end</span></span>
<span class="srcline"><span class="lineno"><a href="80,152" id="srcline152"> 152</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,153" id="srcline153"> 153</a></span><span class="line">            end            </span></span>
<span class="srcline"><span class="lineno"><a href="80,154" id="srcline154"> 154</a></span><span class="line">            if (Hi &lt;=0)||(Hi &lt; Lo)</span></span>
<span class="srcline"><span class="lineno"><a href="80,155" id="srcline155"> 155</a></span><span class="line">                FinishFlg = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,156" id="srcline156"> 156</a></span><span class="line">            end            </span></span>
<span class="srcline"><span class="lineno"><a href="80,157" id="srcline157"> 157</a></span><span class="line">            Accurcy = min(abs([1e-2/dk(1),1e-3/dk(2),1e-2/dk(3)]));</span></span>
<span class="srcline"><span class="lineno"><a href="80,158" id="srcline158"> 158</a></span><span class="line">            [Alpha,IterGoldenStep]=goldenSearch(x1,dk,Lo,Hi,LB,UB,Accurcy);</span></span>
<span class="srcline"><span class="lineno"><a href="80,159" id="srcline159"> 159</a></span><span class="line">            if max(abs(Alpha * dk)) &lt; 1e-3</span></span>
<span class="srcline"><span class="lineno"><a href="80,160" id="srcline160"> 160</a></span><span class="line">                FinishFlg = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,161" id="srcline161"> 161</a></span><span class="line">            end</span></span>
<span class="srcline"><span class="lineno"><a href="80,162" id="srcline162"> 162</a></span><span class="line">            BestStep = Alpha * dk;</span></span>
<span class="srcline"><span class="lineno"><a href="80,163" id="srcline163"> 163</a></span><span class="line">            if (BestStep(1) &lt; 1e-2)&amp;&amp; (BestStep(3) &lt; 1e-2) &amp;&amp; (BestStep(2) &lt; 1e-3)                          </span></span>
<span class="srcline"><span class="lineno"><a href="80,164" id="srcline164"> 164</a></span><span class="line">            end</span></span>
<span class="srcline"><span class="lineno"><a href="80,165" id="srcline165"> 165</a></span><span class="line">            x1temp = x1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,166" id="srcline166"> 166</a></span><span class="line">            x1 = x1 + Alpha * dk;</span></span>
<span class="srcline"><span class="lineno"><a href="80,167" id="srcline167"> 167</a></span><span class="line">            sk=x1-x1temp; </span></span>
<span class="srcline"><span class="lineno"><a href="80,168" id="srcline168"> 168</a></span><span class="line">            [CostG,ConG,Costx,Hx] = GradientCal(x1,LB,UB);</span></span>
<span class="srcline"><span class="lineno"><a href="80,169" id="srcline169"> 169</a></span><span class="line">            PPfuncVal = -x1(3)+ratio*norm(min([0,min(Hx)]),1);</span></span>
<span class="srcline"><span class="lineno"><a href="80,170" id="srcline170"> 170</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="80,171" id="srcline171"> 171</a></span><span class="line">            initial_CostGLx = LxGradientCal(CostGTemp,ConGTemp,Lamda);</span></span>
<span class="srcline"><span class="lineno"><a href="80,172" id="srcline172"> 172</a></span><span class="line">            CostGLx = LxGradientCal(CostG,ConG,Lamda);</span></span>
<span class="srcline"><span class="lineno"><a href="80,173" id="srcline173"> 173</a></span><span class="line">            CostGTemp = CostG;</span></span>
<span class="srcline"><span class="lineno"><a href="80,174" id="srcline174"> 174</a></span><span class="line">            ConGTemp = ConG;</span></span>
<span class="srcline"><span class="lineno"><a href="80,175" id="srcline175"> 175</a></span><span class="line">            yk = CostGLx-initial_CostGLx; </span></span>
<span class="srcline"><span class="lineno"><a href="80,176" id="srcline176"> 176</a></span><span class="line">            if  yk'*sk&gt;0</span></span>
<span class="srcline"><span class="lineno"><a href="80,177" id="srcline177"> 177</a></span><span class="line">                Bk=Bk+(yk*yk')/(yk'*sk)-(Bk*sk*sk'*Bk)/(yk'*Bk*yk);  </span></span>
<span class="srcline"><span class="lineno"><a href="80,178" id="srcline178"> 178</a></span><span class="line">            else </span></span>
<span class="srcline"><span class="lineno"><a href="80,179" id="srcline179"> 179</a></span><span class="line">            end</span></span>
<span class="srcline"><span class="lineno"><a href="80,180" id="srcline180"> 180</a></span><span class="line">            if yk'* sk &gt; 0 </span></span>
<span class="srcline"><span class="lineno"><a href="80,181" id="srcline181"> 181</a></span><span class="line">                Hk = Hk + ((sk - Hk*yk)*sk' + sk*(sk-Hk*yk)')/(yk'*sk)-(sk-Hk*yk)'*yk*sk*sk'/(yk'*sk)^2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,182" id="srcline182"> 182</a></span><span class="line">            end</span></span>
<span class="srcline"><span class="lineno"><a href="80,183" id="srcline183"> 183</a></span><span class="line">        end</span></span>
<span class="srcline"><span class="lineno"><a href="80,184" id="srcline184"> 184</a></span><span class="line">        PHk = Hk;PCostG = CostG;PConG = ConG;PHx = Hx;Px1 = x1;PConGTemp = ConGTemp;PBk = Bk;PCostGTemp = CostGTemp; </span></span>
<span class="srcline"><span class="lineno"><a href="80,185" id="srcline185"> 185</a></span><span class="line">        PCurStep = 2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,186" id="srcline186"> 186</a></span><span class="line">        if PPfuncVal &lt; PPfunc</span></span>
<span class="srcline"><span class="lineno"><a href="80,187" id="srcline187"> 187</a></span><span class="line">            PPfunc = PPfuncVal;</span></span>
<span class="srcline"><span class="lineno"><a href="80,188" id="srcline188"> 188</a></span><span class="line">            PPosiblx = x1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,189" id="srcline189"> 189</a></span><span class="line">        end</span></span>
<span class="srcline"><span class="lineno"><a href="80,190" id="srcline190"> 190</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="80,191" id="srcline191"> 191</a></span><span class="line">    else          </span></span>
<span class="srcline"><span class="lineno"><a href="80,192" id="srcline192"> 192</a></span><span class="line">        if (FinishFlg == 0)&amp;&amp;(PCurStep == 2)</span></span>
<span class="srcline"><span class="lineno"><a href="80,193" id="srcline193"> 193</a></span><span class="line">            Hk = PHk;CostG = PCostG;ConG = PConG;Hx = PHx;PCurStep = 1;Bk = PBk;</span></span>
<span class="srcline"><span class="lineno"><a href="80,194" id="srcline194"> 194</a></span><span class="line">            y1 = ones(15,1);w1 = ones(15,1);dx1 = ones(3,1);</span></span>
<span class="srcline"><span class="lineno"><a href="80,195" id="srcline195"> 195</a></span><span class="line"><span class="comment">%             [dk,Lamda] = qpfunc( Hk,CostG,ConG',-Hx,dx1,y1,w1 );  </span></span></span>
<span class="srcline"><span class="lineno"><a href="80,196" id="srcline196"> 196</a></span><span class="line">            [dk,Lamda,IterQpStep] = qpfunc( Bk,CostG,ConG',-Hx,dx1,y1,w1 );  </span></span>
<span class="srcline"><span class="lineno"><a href="80,197" id="srcline197"> 197</a></span><span class="line">            if (norm(dk,2)&lt;1e-3)||(Alpha &lt; 1e-4)</span></span>
<span class="srcline"><span class="lineno"><a href="80,198" id="srcline198"> 198</a></span><span class="line">                FinishFlg = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,199" id="srcline199"> 199</a></span><span class="line">            else</span></span>
<span class="srcline"><span class="lineno"><a href="80,200" id="srcline200"> 200</a></span><span class="line">                Pdk = dk; PLamda = Lamda; </span></span>
<span class="srcline"><span class="lineno"><a href="80,201" id="srcline201"> 201</a></span><span class="line">            end</span></span>
<span class="srcline"><span class="lineno"><a href="80,202" id="srcline202"> 202</a></span><span class="line">        end</span></span>
<span class="srcline"><span class="lineno"><a href="80,203" id="srcline203"> 203</a></span><span class="line">        PCurStep = 1; </span></span>
<span class="srcline"><span class="lineno"><a href="80,204" id="srcline204"> 204</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,205" id="srcline205"> 205</a></span><span class="line">    RunCnt = RunCnt + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,206" id="srcline206"> 206</a></span><span class="line">    if RunCnt &gt; Nlimit2</span></span>
<span class="srcline"><span class="lineno"><a href="80,207" id="srcline207"> 207</a></span><span class="line">        FinishFlg = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,208" id="srcline208"> 208</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,209" id="srcline209"> 209</a></span><span class="line">    if FinishFlg == 1;        </span></span>
<span class="srcline"><span class="lineno"><a href="80,210" id="srcline210"> 210</a></span><span class="line">        Sts = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,211" id="srcline211"> 211</a></span><span class="line">        if RunCnt &gt; Nlimit2</span></span>
<span class="srcline"><span class="lineno"><a href="80,212" id="srcline212"> 212</a></span><span class="line">            <span class="comment">% 0 Failure 1 Success</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,213" id="srcline213"> 213</a></span><span class="line">           </span></span>
<span class="srcline"><span class="lineno"><a href="80,214" id="srcline214"> 214</a></span><span class="line"><span class="comment">%            Costx = Pfunc(Px1,LB,UB);</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,215" id="srcline215"> 215</a></span><span class="line">           xoptim = Px1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,216" id="srcline216"> 216</a></span><span class="line">        else</span></span>
<span class="srcline"><span class="lineno"><a href="80,217" id="srcline217"> 217</a></span><span class="line">           </span></span>
<span class="srcline"><span class="lineno"><a href="80,218" id="srcline218"> 218</a></span><span class="line">           xoptim = Px1; </span></span>
<span class="srcline"><span class="lineno"><a href="80,219" id="srcline219"> 219</a></span><span class="line">        end</span></span>
<span class="srcline"><span class="lineno"><a href="80,220" id="srcline220"> 220</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="80,221" id="srcline221"> 221</a></span><span class="line">        Pval = Pfunc(xoptim,LB,UB);</span></span>
<span class="srcline"><span class="lineno"><a href="80,222" id="srcline222"> 222</a></span><span class="line">        if Pval &gt; 10</span></span>
<span class="srcline"><span class="lineno"><a href="80,223" id="srcline223"> 223</a></span><span class="line">            Res = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,224" id="srcline224"> 224</a></span><span class="line">        else</span></span>
<span class="srcline"><span class="lineno"><a href="80,225" id="srcline225"> 225</a></span><span class="line">            Res = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,226" id="srcline226"> 226</a></span><span class="line">        end</span></span>
<span class="srcline"><span class="lineno"><a href="80,227" id="srcline227"> 227</a></span><span class="line">        RunCnt = 0;PCurStep = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,228" id="srcline228"> 228</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,229" id="srcline229"> 229</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,230" id="srcline230"> 230</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,231" id="srcline231"> 231</a></span><span class="line">function [CostG,ConG,Costx,Hx]= GradientCal(Xin,LB,UB)</span></span>
<span class="srcline"><span class="lineno"><a href="80,232" id="srcline232"> 232</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,233" id="srcline233"> 233</a></span><span class="line">    value1Cost=ones(3,1);</span></span>
<span class="srcline"><span class="lineno"><a href="80,234" id="srcline234"> 234</a></span><span class="line">    value2Cost=ones(3,1);</span></span>
<span class="srcline"><span class="lineno"><a href="80,235" id="srcline235"> 235</a></span><span class="line">    value1Con=ones(3,15);</span></span>
<span class="srcline"><span class="lineno"><a href="80,236" id="srcline236"> 236</a></span><span class="line">    value2Con=ones(3,15);</span></span>
<span class="srcline"><span class="lineno"><a href="80,237" id="srcline237"> 237</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,238" id="srcline238"> 238</a></span><span class="line">    dx=1e-1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,239" id="srcline239"> 239</a></span><span class="line">    dy=1e-1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,240" id="srcline240"> 240</a></span><span class="line">    dz=1e-1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,241" id="srcline241"> 241</a></span><span class="line">    Xin_x=Xin+ [dx;0;0];</span></span>
<span class="srcline"><span class="lineno"><a href="80,242" id="srcline242"> 242</a></span><span class="line">    Xin_y=Xin+ [0;dy;0];</span></span>
<span class="srcline"><span class="lineno"><a href="80,243" id="srcline243"> 243</a></span><span class="line">    Xin_z=Xin+ [0;0;dz];</span></span>
<span class="srcline"><span class="lineno"><a href="80,244" id="srcline244"> 244</a></span><span class="line">    value1Cost(1) = (  CostFun(Xin_x) - CostFun(Xin) ) / dx;    <span class="comment">%x</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,245" id="srcline245"> 245</a></span><span class="line">    value1Cost(2) = (  CostFun(Xin_y) - CostFun(Xin) ) / dy ;   <span class="comment">%y</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,246" id="srcline246"> 246</a></span><span class="line">    value1Cost(3) = (  CostFun(Xin_z) - CostFun(Xin) ) / dz ;   <span class="comment">%z</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,247" id="srcline247"> 247</a></span><span class="line">    ConFuncXinVal = ConFunc(Xin,LB,UB);</span></span>
<span class="srcline"><span class="lineno"><a href="80,248" id="srcline248"> 248</a></span><span class="line">    value1Con(1,:) = (  ConFunc(Xin_x,LB,UB) - ConFuncXinVal ) / dx;    <span class="comment">%x</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,249" id="srcline249"> 249</a></span><span class="line">    value1Con(2,:) = (  ConFunc(Xin_y,LB,UB) - ConFuncXinVal ) / dy ;   <span class="comment">%y</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,250" id="srcline250"> 250</a></span><span class="line">    value1Con(3,:) = (  ConFunc(Xin_z,LB,UB) - ConFuncXinVal ) / dz ;   <span class="comment">%z</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,251" id="srcline251"> 251</a></span><span class="line">    CostG = value1Cost;</span></span>
<span class="srcline"><span class="lineno"><a href="80,252" id="srcline252"> 252</a></span><span class="line">    ConG = value1Con;</span></span>
<span class="srcline"><span class="lineno"><a href="80,253" id="srcline253"> 253</a></span><span class="line">    Costx = CostFun(Xin);</span></span>
<span class="srcline"><span class="lineno"><a href="80,254" id="srcline254"> 254</a></span><span class="line">    Hx = ConFuncXinVal;</span></span>
<span class="srcline"><span class="lineno"><a href="80,255" id="srcline255"> 255</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,256" id="srcline256"> 256</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,257" id="srcline257"> 257</a></span><span class="line">function [bestStep,goldenn]=goldenSearch(x0,direction,lo,hi,LB,UB,Accurcy)</span></span>
<span class="srcline"><span class="lineno"><a href="80,258" id="srcline258"> 258</a></span><span class="line">    global Nlimit </span></span>
<span class="srcline"><span class="lineno"><a href="80,259" id="srcline259"> 259</a></span><span class="line">    a=lo;</span></span>
<span class="srcline"><span class="lineno"><a href="80,260" id="srcline260"> 260</a></span><span class="line">    b=hi;</span></span>
<span class="srcline"><span class="lineno"><a href="80,261" id="srcline261"> 261</a></span><span class="line">    <span class="comment">% TBD Change 2</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,262" id="srcline262"> 262</a></span><span class="line">    error = Accurcy;</span></span>
<span class="srcline"><span class="lineno"><a href="80,263" id="srcline263"> 263</a></span><span class="line">    golden=0.61803398;</span></span>
<span class="srcline"><span class="lineno"><a href="80,264" id="srcline264"> 264</a></span><span class="line">    goldenn = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,265" id="srcline265"> 265</a></span><span class="line">    alpha=a + (1-golden) * (b-a);</span></span>
<span class="srcline"><span class="lineno"><a href="80,266" id="srcline266"> 266</a></span><span class="line">    beta=a + golden * (b-a);</span></span>
<span class="srcline"><span class="lineno"><a href="80,267" id="srcline267"> 267</a></span><span class="line">    f_alpha=Pfunc( x0 + alpha * direction,LB,UB);</span></span>
<span class="srcline"><span class="lineno"><a href="80,268" id="srcline268"> 268</a></span><span class="line">    f_beta=Pfunc( x0 + beta * direction,LB,UB);</span></span>
<span class="srcline"><span class="lineno"><a href="80,269" id="srcline269"> 269</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,270" id="srcline270"> 270</a></span><span class="line">    while(abs(b-a)&gt;error)</span></span>
<span class="srcline"><span class="lineno"><a href="80,271" id="srcline271"> 271</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,272" id="srcline272"> 272</a></span><span class="line">    <span class="comment">%     a1=a;  b1=b;</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,273" id="srcline273"> 273</a></span><span class="line">        goldenn = goldenn + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,274" id="srcline274"> 274</a></span><span class="line">        b - a;</span></span>
<span class="srcline"><span class="lineno"><a href="80,275" id="srcline275"> 275</a></span><span class="line">        f_beta - f_alpha;</span></span>
<span class="srcline"><span class="lineno"><a href="80,276" id="srcline276"> 276</a></span><span class="line">        if alpha&gt;beta</span></span>
<span class="srcline"><span class="lineno"><a href="80,277" id="srcline277"> 277</a></span><span class="line">    <span class="comment">%         a=a1;b=b1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,278" id="srcline278"> 278</a></span><span class="line">            alpha=a + (1-golden) * (b-a);</span></span>
<span class="srcline"><span class="lineno"><a href="80,279" id="srcline279"> 279</a></span><span class="line">            beta=a + golden * (b-a);</span></span>
<span class="srcline"><span class="lineno"><a href="80,280" id="srcline280"> 280</a></span><span class="line">            f_alpha=Pfunc( x0 + alpha * direction,LB,UB);</span></span>
<span class="srcline"><span class="lineno"><a href="80,281" id="srcline281"> 281</a></span><span class="line">            f_beta=Pfunc( x0 + beta * direction,LB,UB);       </span></span>
<span class="srcline"><span class="lineno"><a href="80,282" id="srcline282"> 282</a></span><span class="line">        end  </span></span>
<span class="srcline"><span class="lineno"><a href="80,283" id="srcline283"> 283</a></span><span class="line">        if f_alpha&lt;=f_beta</span></span>
<span class="srcline"><span class="lineno"><a href="80,284" id="srcline284"> 284</a></span><span class="line">            b=beta;</span></span>
<span class="srcline"><span class="lineno"><a href="80,285" id="srcline285"> 285</a></span><span class="line">            beta=alpha;</span></span>
<span class="srcline"><span class="lineno"><a href="80,286" id="srcline286"> 286</a></span><span class="line">            f_beta=f_alpha;</span></span>
<span class="srcline"><span class="lineno"><a href="80,287" id="srcline287"> 287</a></span><span class="line">            alpha=a + (b-beta);</span></span>
<span class="srcline"><span class="lineno"><a href="80,288" id="srcline288"> 288</a></span><span class="line">            f_alpha=Pfunc( x0 + alpha*direction,LB,UB);</span></span>
<span class="srcline"><span class="lineno"><a href="80,289" id="srcline289"> 289</a></span><span class="line">    <span class="comment">%         a1=a;  b1=b;</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,290" id="srcline290"> 290</a></span><span class="line">        else</span></span>
<span class="srcline"><span class="lineno"><a href="80,291" id="srcline291"> 291</a></span><span class="line">            a = alpha;</span></span>
<span class="srcline"><span class="lineno"><a href="80,292" id="srcline292"> 292</a></span><span class="line">            alpha = beta;</span></span>
<span class="srcline"><span class="lineno"><a href="80,293" id="srcline293"> 293</a></span><span class="line">            f_alpha = f_beta;</span></span>
<span class="srcline"><span class="lineno"><a href="80,294" id="srcline294"> 294</a></span><span class="line">            beta = b - (alpha-a);</span></span>
<span class="srcline"><span class="lineno"><a href="80,295" id="srcline295"> 295</a></span><span class="line">            f_beta = Pfunc( x0 + beta * direction,LB,UB);</span></span>
<span class="srcline"><span class="lineno"><a href="80,296" id="srcline296"> 296</a></span><span class="line">    <span class="comment">%         a1=a;  b1=b;</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,297" id="srcline297"> 297</a></span><span class="line">        end</span></span>
<span class="srcline"><span class="lineno"><a href="80,298" id="srcline298"> 298</a></span><span class="line">        if goldenn &gt; Nlimit</span></span>
<span class="srcline"><span class="lineno"><a href="80,299" id="srcline299"> 299</a></span><span class="line">            break;</span></span>
<span class="srcline"><span class="lineno"><a href="80,300" id="srcline300"> 300</a></span><span class="line">        end</span></span>
<span class="srcline"><span class="lineno"><a href="80,301" id="srcline301"> 301</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,302" id="srcline302"> 302</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,303" id="srcline303"> 303</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,304" id="srcline304"> 304</a></span><span class="line">    if Pfunc(x0 + a * direction,LB,UB)&lt;Pfunc(x0 + b * direction,LB,UB)</span></span>
<span class="srcline"><span class="lineno"><a href="80,305" id="srcline305"> 305</a></span><span class="line">        bestStep=a;</span></span>
<span class="srcline"><span class="lineno"><a href="80,306" id="srcline306"> 306</a></span><span class="line">    else</span></span>
<span class="srcline"><span class="lineno"><a href="80,307" id="srcline307"> 307</a></span><span class="line">        bestStep=b;</span></span>
<span class="srcline"><span class="lineno"><a href="80,308" id="srcline308"> 308</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,309" id="srcline309"> 309</a></span><span class="line">    n = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,310" id="srcline310"> 310</a></span><span class="line">    goldenn;</span></span>
<span class="srcline"><span class="lineno"><a href="80,311" id="srcline311"> 311</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,312" id="srcline312"> 312</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,313" id="srcline313"> 313</a></span><span class="line">function [dk,dkLamda,qpfunck] = qpfunc( H,c,A,b,x1,y1,w1 )</span></span>
<span class="srcline"><span class="lineno"><a href="80,314" id="srcline314"> 314</a></span><span class="line"><span class="comment">%UNTITLED2 Summary of this function goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,315" id="srcline315"> 315</a></span><span class="line"><span class="comment">%   Detailed explanation goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,316" id="srcline316"> 316</a></span><span class="line">    global Nlimit </span></span>
<span class="srcline"><span class="lineno"><a href="80,317" id="srcline317"> 317</a></span><span class="line">    Delta = 0.1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,318" id="srcline318"> 318</a></span><span class="line">    P = 0.9;</span></span>
<span class="srcline"><span class="lineno"><a href="80,319" id="srcline319"> 319</a></span><span class="line">    E = ones(length(y1),1);</span></span>
<span class="srcline"><span class="lineno"><a href="80,320" id="srcline320"> 320</a></span><span class="line">    m = length(b);</span></span>
<span class="srcline"><span class="lineno"><a href="80,321" id="srcline321"> 321</a></span><span class="line">    qpfunck = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,322" id="srcline322"> 322</a></span><span class="line">    while(1)</span></span>
<span class="srcline"><span class="lineno"><a href="80,323" id="srcline323"> 323</a></span><span class="line">        qpfunck = qpfunck+1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,324" id="srcline324"> 324</a></span><span class="line">        if qpfunck &gt; Nlimit</span></span>
<span class="srcline"><span class="lineno"><a href="80,325" id="srcline325"> 325</a></span><span class="line">            dk = x1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,326" id="srcline326"> 326</a></span><span class="line">            dkLamda = y1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,327" id="srcline327"> 327</a></span><span class="line">            break;</span></span>
<span class="srcline"><span class="lineno"><a href="80,328" id="srcline328"> 328</a></span><span class="line">        end</span></span>
<span class="srcline"><span class="lineno"><a href="80,329" id="srcline329"> 329</a></span><span class="line">        Y = diag(y1);</span></span>
<span class="srcline"><span class="lineno"><a href="80,330" id="srcline330"> 330</a></span><span class="line">        W = diag(w1);</span></span>
<span class="srcline"><span class="lineno"><a href="80,331" id="srcline331"> 331</a></span><span class="line">        Rho = b - A*x1 + w1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,332" id="srcline332"> 332</a></span><span class="line">        Sigma = c + H*x1 -A'*y1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,333" id="srcline333"> 333</a></span><span class="line">        Gamma = y1'*w1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,334" id="srcline334"> 334</a></span><span class="line">        Mu = Delta * Gamma / m;</span></span>
<span class="srcline"><span class="lineno"><a href="80,335" id="srcline335"> 335</a></span><span class="line"><span class="comment">%         newMatricL = [-H A';A inv(Y)*W];</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,336" id="srcline336"> 336</a></span><span class="line"><span class="comment">%         newMatricR = [c + H*x1 - A'*y1;b-A*x1 + Mu*inv(Y)*E];</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,337" id="srcline337"> 337</a></span><span class="line"><span class="comment">%         dxy = inv(newMatricL)*newMatricR;</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,338" id="srcline338"> 338</a></span><span class="line">        newMatricL = [-H A';A Y\W];</span></span>
<span class="srcline"><span class="lineno"><a href="80,339" id="srcline339"> 339</a></span><span class="line">        newMatricR = [c + H*x1 - A'*y1;b-A*x1 + Mu*Y\E];</span></span>
<span class="srcline"><span class="lineno"><a href="80,340" id="srcline340"> 340</a></span><span class="line">        dxy = newMatricL\newMatricR;</span></span>
<span class="srcline"><span class="lineno"><a href="80,341" id="srcline341"> 341</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="80,342" id="srcline342"> 342</a></span><span class="line">        dx = dxy(1:length(x1));</span></span>
<span class="srcline"><span class="lineno"><a href="80,343" id="srcline343"> 343</a></span><span class="line">        dy = dxy((length(x1)+1):(length(dxy)));</span></span>
<span class="srcline"><span class="lineno"><a href="80,344" id="srcline344"> 344</a></span><span class="line"><span class="comment">%         dw = inv(Y)*(Mu*E - Y*W*E - W*dy);</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,345" id="srcline345"> 345</a></span><span class="line">        dw = Y\(Mu*E - Y*W*E - W*dy);</span></span>
<span class="srcline"><span class="lineno"><a href="80,346" id="srcline346"> 346</a></span><span class="line">        LamdaTemp1 = [-dy./y1,-dw./w1];</span></span>
<span class="srcline"><span class="lineno"><a href="80,347" id="srcline347"> 347</a></span><span class="line">        Lamda = min([1, P*pinv(max([-dy./y1;-dw./w1]))]);</span></span>
<span class="srcline"><span class="lineno"><a href="80,348" id="srcline348"> 348</a></span><span class="line"><span class="comment">%         if (norm(Gamma,1)&lt;1e-3)&amp;(norm(Rho,1)&lt;1e-3)&amp;(norm(Sigma,1)&lt;1e-3)||(Lamda&lt;1e-3)</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,349" id="srcline349"> 349</a></span><span class="line">        if (norm(Gamma,1)&lt;1e-3)&amp;&amp;(norm(Rho,1)&lt;1e-3)&amp;&amp;(norm(Sigma,1)&lt;1e-3)||(Lamda&lt;1e-5)</span></span>
<span class="srcline"><span class="lineno"><a href="80,350" id="srcline350"> 350</a></span><span class="line">            dk = x1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,351" id="srcline351"> 351</a></span><span class="line">            dkLamda = y1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,352" id="srcline352"> 352</a></span><span class="line">            break;</span></span>
<span class="srcline"><span class="lineno"><a href="80,353" id="srcline353"> 353</a></span><span class="line">        else</span></span>
<span class="srcline"><span class="lineno"><a href="80,354" id="srcline354"> 354</a></span><span class="line">            x1 = x1 + Lamda*dx;</span></span>
<span class="srcline"><span class="lineno"><a href="80,355" id="srcline355"> 355</a></span><span class="line">            y1 = y1 + Lamda*dy;</span></span>
<span class="srcline"><span class="lineno"><a href="80,356" id="srcline356"> 356</a></span><span class="line">            w1 = w1 + Lamda*dw;</span></span>
<span class="srcline"><span class="lineno"><a href="80,357" id="srcline357"> 357</a></span><span class="line">        end</span></span>
<span class="srcline"><span class="lineno"><a href="80,358" id="srcline358"> 358</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,359" id="srcline359"> 359</a></span><span class="line">    qpfunck;</span></span>
<span class="srcline"><span class="lineno"><a href="80,360" id="srcline360"> 360</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,361" id="srcline361"> 361</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,362" id="srcline362"> 362</a></span><span class="line">function dLxVal= LxGradientCal2(Xin,Lamda,LB,UB,CostGTemp,ConGTemp)</span></span>
<span class="srcline"><span class="lineno"><a href="80,363" id="srcline363"> 363</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,364" id="srcline364"> 364</a></span><span class="line">    value1=ones(3,1);</span></span>
<span class="srcline"><span class="lineno"><a href="80,365" id="srcline365"> 365</a></span><span class="line">    value2=ones(3,1);</span></span>
<span class="srcline"><span class="lineno"><a href="80,366" id="srcline366"> 366</a></span><span class="line">    value1LxVal = [0 0 0];</span></span>
<span class="srcline"><span class="lineno"><a href="80,367" id="srcline367"> 367</a></span><span class="line">    value2LxVal = [0 0 0];</span></span>
<span class="srcline"><span class="lineno"><a href="80,368" id="srcline368"> 368</a></span><span class="line">    dx=1e-1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,369" id="srcline369"> 369</a></span><span class="line">    dy=1e-1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,370" id="srcline370"> 370</a></span><span class="line">    dz=1e-1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,371" id="srcline371"> 371</a></span><span class="line">    Xin_x=Xin+ [dx;0;0];</span></span>
<span class="srcline"><span class="lineno"><a href="80,372" id="srcline372"> 372</a></span><span class="line">    Xin_y=Xin+ [0;dy;0];</span></span>
<span class="srcline"><span class="lineno"><a href="80,373" id="srcline373"> 373</a></span><span class="line">    Xin_z=Xin+ [0;0;dz];</span></span>
<span class="srcline"><span class="lineno"><a href="80,374" id="srcline374"> 374</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,375" id="srcline375"> 375</a></span><span class="line">    ConFuncValue = ConFunc(Xin,LB,UB);</span></span>
<span class="srcline"><span class="lineno"><a href="80,376" id="srcline376"> 376</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,377" id="srcline377"> 377</a></span><span class="line">    value1LxVal(1) = (CostFun(Xin_x) - CostFun(Xin)- Lamda' *  ConFunc(Xin_x,LB,UB) + Lamda' *  ConFuncValue)/dx;</span></span>
<span class="srcline"><span class="lineno"><a href="80,378" id="srcline378"> 378</a></span><span class="line">    value1LxVal(2) = (CostFun(Xin_y) - CostFun(Xin)- Lamda' *  ConFunc(Xin_y,LB,UB) + Lamda' *  ConFuncValue)/dy;</span></span>
<span class="srcline"><span class="lineno"><a href="80,379" id="srcline379"> 379</a></span><span class="line">    value1LxVal(3) = (CostFun(Xin_z) - CostFun(Xin)- Lamda' *  ConFunc(Xin_z,LB,UB) + Lamda' *  ConFuncValue)/dz;</span></span>
<span class="srcline"><span class="lineno"><a href="80,380" id="srcline380"> 380</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,381" id="srcline381"> 381</a></span><span class="line">    dLxVal = value1LxVal;</span></span>
<span class="srcline"><span class="lineno"><a href="80,382" id="srcline382"> 382</a></span><span class="line">    dLxVal = dLxVal';</span></span>
<span class="srcline"><span class="lineno"><a href="80,383" id="srcline383"> 383</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="80,384" id="srcline384"> 384</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,385" id="srcline385"> 385</a></span><span class="line"><span class="comment">% TBD change 5</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,386" id="srcline386"> 386</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,387" id="srcline387"> 387</a></span><span class="line">function dLxVal= LxGradientCal(CostG,ConG,Lamda)</span></span>
<span class="srcline"><span class="lineno"><a href="80,388" id="srcline388"> 388</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,389" id="srcline389"> 389</a></span><span class="line">    dLxVal = CostG -  ConG* Lamda;</span></span>
<span class="srcline"><span class="lineno"><a href="80,390" id="srcline390"> 390</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="80,391" id="srcline391"> 391</a></span><span class="line">end</span></span>
</pre>
</div>
<pre class="code">
<span class="srcline"><span class="lineno"><a href="80,392" id="srcline392"> 392</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,393" id="srcline393"> 393</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S238T1U2541">Pval</span>= Pfunc(<span class="var type1" id="S239T30U2544">Xin</span>,<span class="var type1" id="S240T30U2545">LB</span>,<span class="var type1" id="S241T30U2546">UB</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="80,394" id="srcline394"> 394</a></span><span class="line">    <span class="keyword">global</span> <span class="var type0" id="S242T0U2548">ratio</span>   </span></span>
<span class="srcline"><span class="lineno"><a href="80,395" id="srcline395"> 395</a></span><span class="line">    <span class="mxinfo " id="T61:U5">[<span class="var type1" id="S243T61U2552">C</span>,<span class="var type1" id="S244T53U2553">Ceq</span>] = <span class="fcn" id="F271N71:B2555">LaneChgNonLinearCon</span>( <span class="var type1" id="S239T30U2556">Xin</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,396" id="srcline396"> 396</a></span><span class="line">    <span class="mxinfo " id="T1:U9"><span class="var type1" id="S246T1U2559">LengthC</span> = <span class="mxinfo " id="T1:U11">9</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,397" id="srcline397"> 397</a></span><span class="line">    <span class="mxinfo " id="T1:U12"><span class="var type1" id="S247T1U2563">LengthLB</span> = <span class="mxinfo " id="T1:U14">length(<span class="var type1" id="S240T30U2566">LB</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,398" id="srcline398"> 398</a></span><span class="line">    <span class="mxinfo " id="T3:U16"><span class="mxinfo " id="T3:U17"><span class="var type1" id="S243T61U2570">C</span>((<span class="var type1" id="S246T1U2574">LengthC</span>+1):(<span class="var type1" id="S246T1U2578">LengthC</span>+<span class="var type1" id="S247T1U2579">LengthLB</span>))</span>= <span class="mxinfo " id="T30:U22"><span class="var type1" id="S239T30U2581">Xin</span> - <span class="var type1" id="S241T30U2582">UB</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,399" id="srcline399"> 399</a></span><span class="line">    <span class="mxinfo " id="T3:U25"><span class="mxinfo " id="T3:U26"><span class="var type1" id="S243T61U2586">C</span>((<span class="var type1" id="S246T1U2591">LengthC</span>+<span class="var type1" id="S247T1U2592">LengthLB</span>+1):(<span class="var type1" id="S246T1U2597">LengthC</span>+<span class="var type1" id="S247T1U2598">LengthLB</span>+<span class="var type1" id="S247T1U2599">LengthLB</span>))</span>= <span class="mxinfo " id="T30:U33"><span class="var type1" id="S240T30U2601">LB</span> - <span class="var type1" id="S239T30U2602">Xin</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,400" id="srcline400"> 400</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,401" id="srcline401"> 401</a></span><span class="line">    <span class="mxinfo " id="T1:U36"><span class="var type1" id="S249T1U2605">hminx</span>= <span class="mxinfo " id="T1:U38">min(<span class="mxinfo " id="T33:U39">[<span class="mxinfo " id="T1:U40">0</span>,<span class="mxinfo " id="T1:U41">min(<span class="mxinfo " id="T61:U42">-<span class="var type1" id="S243T61U2614">C</span></span>)</span>]</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,402" id="srcline402"> 402</a></span><span class="line">    <span class="mxinfo " id="T1:U44"><span class="var type1" id="S238T1U2617">Pval</span> = <span class="mxinfo " id="T1:U46"><span class="mxinfo " id="T1:U47">- <span class="mxinfo " id="T1:U48"><span class="var type1" id="S239T30U2621">Xin</span>(<span class="mxinfo " id="T9:U50">3</span>)</span></span> + <span class="mxinfo " id="T1:U51"><span class="var type1" id="S242T1U2624">ratio</span>* <span class="mxinfo " id="T1:U53">norm(<span class="var type1" id="S249T1U2627">hminx</span>,1)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,403" id="srcline403"> 403</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,404" id="srcline404"> 404</a></span><span class="line"></span></span>
</pre>
<div class="dead">
<pre class="code">
<span class="srcline"><span class="lineno"><a href="80,405" id="srcline405"> 405</a></span><span class="line">function Fcost= CostFun(Xin)</span></span>
<span class="srcline"><span class="lineno"><a href="80,406" id="srcline406"> 406</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,407" id="srcline407"> 407</a></span><span class="line">    Fcost = LaneChgCostFunc(Xin);</span></span>
<span class="srcline"><span class="lineno"><a href="80,408" id="srcline408"> 408</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,409" id="srcline409"> 409</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,410" id="srcline410"> 410</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,411" id="srcline411"> 411</a></span><span class="line">function ConVal= ConFunc(Xin,LB,UB)</span></span>
<span class="srcline"><span class="lineno"><a href="80,412" id="srcline412"> 412</a></span><span class="line">    [C,Ceq] = LaneChgNonLinearCon( Xin);</span></span>
<span class="srcline"><span class="lineno"><a href="80,413" id="srcline413"> 413</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,414" id="srcline414"> 414</a></span><span class="line">    LengthC = 9;</span></span>
<span class="srcline"><span class="lineno"><a href="80,415" id="srcline415"> 415</a></span><span class="line">    LengthLB = length(LB);</span></span>
<span class="srcline"><span class="lineno"><a href="80,416" id="srcline416"> 416</a></span><span class="line">    C((LengthC+1):(LengthC+LengthLB))= Xin - UB;</span></span>
<span class="srcline"><span class="lineno"><a href="80,417" id="srcline417"> 417</a></span><span class="line">    C((LengthC+LengthLB+1):(LengthC+LengthLB+LengthLB))= LB - Xin;</span></span>
<span class="srcline"><span class="lineno"><a href="80,418" id="srcline418"> 418</a></span><span class="line">    C=-C;</span></span>
<span class="srcline"><span class="lineno"><a href="80,419" id="srcline419"> 419</a></span><span class="line">    ConVal = C;</span></span>
<span class="srcline"><span class="lineno"><a href="80,420" id="srcline420"> 420</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,421" id="srcline421"> 421</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,422" id="srcline422"> 422</a></span><span class="line">function CosFunValue = LaneChgCostFunc(Xin)</span></span>
<span class="srcline"><span class="lineno"><a href="80,423" id="srcline423"> 423</a></span><span class="line">    CosFunValue = -Xin(3);</span></span>
<span class="srcline"><span class="lineno"><a href="80,424" id="srcline424"> 424</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,425" id="srcline425"> 425</a></span><span class="line">function [ C,Ceq ] = LaneChgNonLinearCon( Xin )</span></span>
<span class="srcline"><span class="lineno"><a href="80,426" id="srcline426"> 426</a></span><span class="line">global V_me V L_veh X_me X L_me T_adj Y_cal;</span></span>
<span class="srcline"><span class="lineno"><a href="80,427" id="srcline427"> 427</a></span><span class="line">global Aylimit Axlimit X_melimit k_maxlimit;</span></span>
<span class="srcline"><span class="lineno"><a href="80,428" id="srcline428"> 428</a></span><span class="line"><span class="comment">% global T_lat Axlimit </span></span></span>
<span class="srcline"><span class="lineno"><a href="80,429" id="srcline429"> 429</a></span><span class="line">global DeltaTemp k_localmaxTemp ArclengthTol</span></span>
<span class="srcline"><span class="lineno"><a href="80,430" id="srcline430"> 430</a></span><span class="line">global x_qitemp y_qitemp theta_qitemp</span></span>
<span class="srcline"><span class="lineno"><a href="80,431" id="srcline431"> 431</a></span><span class="line">global x_in y_in angle_in y_out angle_out x_out</span></span>
<span class="srcline"><span class="lineno"><a href="80,432" id="srcline432"> 432</a></span><span class="line">C = zeros(15,1);</span></span>
<span class="srcline"><span class="lineno"><a href="80,433" id="srcline433"> 433</a></span><span class="line">Tc = [0 0 0 0]';</span></span>
<span class="srcline"><span class="lineno"><a href="80,434" id="srcline434"> 434</a></span><span class="line">MSS = [0 0 0 0]';</span></span>
<span class="srcline"><span class="lineno"><a href="80,435" id="srcline435"> 435</a></span><span class="line"><span class="comment">%T_long=Xin(2);</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,436" id="srcline436"> 436</a></span><span class="line">V_tar=Xin(3);</span></span>
<span class="srcline"><span class="lineno"><a href="80,437" id="srcline437"> 437</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,438" id="srcline438"> 438</a></span><span class="line">T_lat = 5;</span></span>
<span class="srcline"><span class="lineno"><a href="80,439" id="srcline439"> 439</a></span><span class="line"><span class="comment">% x_in = 0;y_in = 0;angle_in = 0;y_out = 3;angle_out = 0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,440" id="srcline440"> 440</a></span><span class="line">x_outLo = Xin(1);</span></span>
<span class="srcline"><span class="lineno"><a href="80,441" id="srcline441"> 441</a></span><span class="line">if abs(sin(angle_out)) &gt; 0.98   </span></span>
<span class="srcline"><span class="lineno"><a href="80,442" id="srcline442"> 442</a></span><span class="line">    y_outLo = y_out;</span></span>
<span class="srcline"><span class="lineno"><a href="80,443" id="srcline443"> 443</a></span><span class="line">else</span></span>
<span class="srcline"><span class="lineno"><a href="80,444" id="srcline444"> 444</a></span><span class="line">    y_outLo = tan(angle_out)*(x_outLo - x_out) + y_out;</span></span>
<span class="srcline"><span class="lineno"><a href="80,445" id="srcline445"> 445</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,446" id="srcline446"> 446</a></span><span class="line">[ x_qi,y_qi,theta_qi ] = qiConfigCal( x_in,y_in,angle_in,x_outLo,y_outLo,angle_out );</span></span>
<span class="srcline"><span class="lineno"><a href="80,447" id="srcline447"> 447</a></span><span class="line"> x_qitemp = x_qi;y_qitemp=y_qi;theta_qitemp=theta_qi;</span></span>
<span class="srcline"><span class="lineno"><a href="80,448" id="srcline448"> 448</a></span><span class="line"><span class="comment">%[ x_qitemp,y_qitemp,theta_qitemp ] = qiConfigCal( x_in,y_in,angle_in,x_outLo,y_outLo,angle_out );</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,449" id="srcline449"> 449</a></span><span class="line">[DeltaTemp(1),k_localmaxTemp(1),ArclengthTol(1)] = ElementaryPathPlot( x_in,y_in,angle_in,x_qi,y_qi,theta_qi );</span></span>
<span class="srcline"><span class="lineno"><a href="80,450" id="srcline450"> 450</a></span><span class="line">[DeltaTemp(2),k_localmaxTemp(2),ArclengthTol(2)] = ElementaryPathPlot( x_qi,y_qi,theta_qi,x_outLo,y_outLo,angle_out );</span></span>
<span class="srcline"><span class="lineno"><a href="80,451" id="srcline451"> 451</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,452" id="srcline452"> 452</a></span><span class="line">delta_limit = 0.5;</span></span>
<span class="srcline"><span class="lineno"><a href="80,453" id="srcline453"> 453</a></span><span class="line">DeltalimitC = max(abs(DeltaTemp)) - delta_limit;</span></span>
<span class="srcline"><span class="lineno"><a href="80,454" id="srcline454"> 454</a></span><span class="line">AylimitC = max(abs(k_localmaxTemp)) * V_tar^2 - Aylimit;</span></span>
<span class="srcline"><span class="lineno"><a href="80,455" id="srcline455"> 455</a></span><span class="line">KmlimitC = max(abs(k_localmaxTemp)) - k_maxlimit;</span></span>
<span class="srcline"><span class="lineno"><a href="80,456" id="srcline456"> 456</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,457" id="srcline457"> 457</a></span><span class="line">S_arc = ArclengthTol(1) + ArclengthTol(2);</span></span>
<span class="srcline"><span class="lineno"><a href="80,458" id="srcline458"> 458</a></span><span class="line">if V_tar == V_me</span></span>
<span class="srcline"><span class="lineno"><a href="80,459" id="srcline459"> 459</a></span><span class="line">    T_lat = S_arc / V_me;</span></span>
<span class="srcline"><span class="lineno"><a href="80,460" id="srcline460"> 460</a></span><span class="line">    T_long = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,461" id="srcline461"> 461</a></span><span class="line">    S_acc = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,462" id="srcline462"> 462</a></span><span class="line">    a = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,463" id="srcline463"> 463</a></span><span class="line">else</span></span>
<span class="srcline"><span class="lineno"><a href="80,464" id="srcline464"> 464</a></span><span class="line">    Tuplimit = 2 * S_arc / (V_tar + V_me);</span></span>
<span class="srcline"><span class="lineno"><a href="80,465" id="srcline465"> 465</a></span><span class="line">    T_long = Tuplimit * Xin(2);</span></span>
<span class="srcline"><span class="lineno"><a href="80,466" id="srcline466"> 466</a></span><span class="line">    S_acc = (V_tar + V_me)/2 * T_long;</span></span>
<span class="srcline"><span class="lineno"><a href="80,467" id="srcline467"> 467</a></span><span class="line">    a = (V_tar - V_me)/(abs(T_long)+5e-1);</span></span>
<span class="srcline"><span class="lineno"><a href="80,468" id="srcline468"> 468</a></span><span class="line">    if S_acc &lt; S_arc</span></span>
<span class="srcline"><span class="lineno"><a href="80,469" id="srcline469"> 469</a></span><span class="line">        T_lat = T_long + (S_arc - S_acc) / V_tar;</span></span>
<span class="srcline"><span class="lineno"><a href="80,470" id="srcline470"> 470</a></span><span class="line">    else</span></span>
<span class="srcline"><span class="lineno"><a href="80,471" id="srcline471"> 471</a></span><span class="line">        V_end = sqrt(V_me^2 + 2*a*S_arc);</span></span>
<span class="srcline"><span class="lineno"><a href="80,472" id="srcline472"> 472</a></span><span class="line">        if a == 0</span></span>
<span class="srcline"><span class="lineno"><a href="80,473" id="srcline473"> 473</a></span><span class="line">            T_lat = S_arc / V_me;</span></span>
<span class="srcline"><span class="lineno"><a href="80,474" id="srcline474"> 474</a></span><span class="line">        else        </span></span>
<span class="srcline"><span class="lineno"><a href="80,475" id="srcline475"> 475</a></span><span class="line">            T_lat = (V_end - V_me)/a;</span></span>
<span class="srcline"><span class="lineno"><a href="80,476" id="srcline476"> 476</a></span><span class="line">        end</span></span>
<span class="srcline"><span class="lineno"><a href="80,477" id="srcline477"> 477</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,478" id="srcline478"> 478</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,479" id="srcline479"> 479</a></span><span class="line">AxlimitC = abs(a) - Axlimit;</span></span>
<span class="srcline"><span class="lineno"><a href="80,480" id="srcline480"> 480</a></span><span class="line">Ycal = Y_cal;</span></span>
<span class="srcline"><span class="lineno"><a href="80,481" id="srcline481"> 481</a></span><span class="line">Xcal = X;</span></span>
<span class="srcline"><span class="lineno"><a href="80,482" id="srcline482"> 482</a></span><span class="line"><span class="comment">% 1 Fl 2 Rr</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,483" id="srcline483"> 483</a></span><span class="line">[xposition,yposition,Theta,ArcPos] = ArcPosCal( angle_out,angle_in,x_in,y_in,x_outLo,y_outLo,Ycal,Xcal );</span></span>
<span class="srcline"><span class="lineno"><a href="80,484" id="srcline484"> 484</a></span><span class="line"><span class="comment">%Fd</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,485" id="srcline485"> 485</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,486" id="srcline486"> 486</a></span><span class="line"><span class="comment">% if xposition(1)&gt;0</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,487" id="srcline487"> 487</a></span><span class="line"><span class="comment">%     Tc(1) = (xposition(1) - X(1))/(V(1)+1e-6);</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,488" id="srcline488"> 488</a></span><span class="line"><span class="comment">% else</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,489" id="srcline489"> 489</a></span><span class="line"><span class="comment">%     Tc(1) = 0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,490" id="srcline490"> 490</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,491" id="srcline491"> 491</a></span><span class="line"><span class="comment">% if xposition(2)&gt;0</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,492" id="srcline492"> 492</a></span><span class="line"><span class="comment">%     Tc(2) = (xposition(2) - X(2))/(V(2)+1e-6);</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,493" id="srcline493"> 493</a></span><span class="line"><span class="comment">% else</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,494" id="srcline494"> 494</a></span><span class="line"><span class="comment">%     Tc(2) = T_lat;</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,495" id="srcline495"> 495</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,496" id="srcline496"> 496</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="80,497" id="srcline497"> 497</a></span><span class="line"><span class="comment">% if xposition(3)&gt;0</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,498" id="srcline498"> 498</a></span><span class="line"><span class="comment">%     Tc(3) = (-xposition(3) + X(3))/(V(3)+1e-6);</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,499" id="srcline499"> 499</a></span><span class="line"><span class="comment">% else</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,500" id="srcline500"> 500</a></span><span class="line"><span class="comment">%     Tc(3) = 0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,501" id="srcline501"> 501</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,502" id="srcline502"> 502</a></span><span class="line"><span class="comment">% if xposition(4)&gt;0</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,503" id="srcline503"> 503</a></span><span class="line"><span class="comment">%     Tc(4) = (-xposition(4) + X(4))/(V(4)+1e-6);</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,504" id="srcline504"> 504</a></span><span class="line"><span class="comment">% else</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,505" id="srcline505"> 505</a></span><span class="line"><span class="comment">%     Tc(4) = T_lat;</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,506" id="srcline506"> 506</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,507" id="srcline507"> 507</a></span><span class="line">for i =1:4</span></span>
<span class="srcline"><span class="lineno"><a href="80,508" id="srcline508"> 508</a></span><span class="line">    if abs(ArcPos(i)) &lt; 255</span></span>
<span class="srcline"><span class="lineno"><a href="80,509" id="srcline509"> 509</a></span><span class="line">        Tc(i) = TcCalation(ArcPos(i),S_acc,V_tar,V_me,a);</span></span>
<span class="srcline"><span class="lineno"><a href="80,510" id="srcline510"> 510</a></span><span class="line">    else</span></span>
<span class="srcline"><span class="lineno"><a href="80,511" id="srcline511"> 511</a></span><span class="line">        Tc(i) = 255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,512" id="srcline512"> 512</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,513" id="srcline513"> 513</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,514" id="srcline514"> 514</a></span><span class="line">for i = 1:4</span></span>
<span class="srcline"><span class="lineno"><a href="80,515" id="srcline515"> 515</a></span><span class="line">    if Tc(i) &lt; 0</span></span>
<span class="srcline"><span class="lineno"><a href="80,516" id="srcline516"> 516</a></span><span class="line">        Tc(i) = T_lat;</span></span>
<span class="srcline"><span class="lineno"><a href="80,517" id="srcline517"> 517</a></span><span class="line">    else</span></span>
<span class="srcline"><span class="lineno"><a href="80,518" id="srcline518"> 518</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,519" id="srcline519"> 519</a></span><span class="line">end </span></span>
<span class="srcline"><span class="lineno"><a href="80,520" id="srcline520"> 520</a></span><span class="line"><span class="comment">% X_meTemp = X_me - 2 * (ArcPos(1)+ArcPos(2) - xposition(1) - xposition(2));</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,521" id="srcline521"> 521</a></span><span class="line">X_meTemp = (ArclengthTol(1) + ArclengthTol(1)) - x_outLo;</span></span>
<span class="srcline"><span class="lineno"><a href="80,522" id="srcline522"> 522</a></span><span class="line"><span class="comment">%MSSFdlimitC &lt; 0 which means safemargin &gt;0</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,523" id="srcline523"> 523</a></span><span class="line">if T_lat &lt; T_long</span></span>
<span class="srcline"><span class="lineno"><a href="80,524" id="srcline524"> 524</a></span><span class="line">    T_lat = T_long;</span></span>
<span class="srcline"><span class="lineno"><a href="80,525" id="srcline525"> 525</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,526" id="srcline526"> 526</a></span><span class="line">if Tc(1)&lt;255</span></span>
<span class="srcline"><span class="lineno"><a href="80,527" id="srcline527"> 527</a></span><span class="line">    MSS(1) = MSSFdJudgment( V_tar,V_me,V(1),T_long,Tc(1),T_lat,T_adj );</span></span>
<span class="srcline"><span class="lineno"><a href="80,528" id="srcline528"> 528</a></span><span class="line">    MSSFdlimitC = X(1) + X_meTemp + L_me + MSS(1);</span></span>
<span class="srcline"><span class="lineno"><a href="80,529" id="srcline529"> 529</a></span><span class="line">else</span></span>
<span class="srcline"><span class="lineno"><a href="80,530" id="srcline530"> 530</a></span><span class="line">    MSSFdlimitC = -50;</span></span>
<span class="srcline"><span class="lineno"><a href="80,531" id="srcline531"> 531</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,532" id="srcline532"> 532</a></span><span class="line">if Tc(2)&lt;255</span></span>
<span class="srcline"><span class="lineno"><a href="80,533" id="srcline533"> 533</a></span><span class="line">    MSS(2) = MSSFoJudgment( V_tar,V_me,V(2),T_long,Tc(2),T_lat,T_adj );</span></span>
<span class="srcline"><span class="lineno"><a href="80,534" id="srcline534"> 534</a></span><span class="line">    MSSFolimitC = X(2) + X_meTemp + L_me + MSS(2);</span></span>
<span class="srcline"><span class="lineno"><a href="80,535" id="srcline535"> 535</a></span><span class="line">else</span></span>
<span class="srcline"><span class="lineno"><a href="80,536" id="srcline536"> 536</a></span><span class="line">    MSSFolimitC = -50;</span></span>
<span class="srcline"><span class="lineno"><a href="80,537" id="srcline537"> 537</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,538" id="srcline538"> 538</a></span><span class="line">if Tc(3)&lt;255</span></span>
<span class="srcline"><span class="lineno"><a href="80,539" id="srcline539"> 539</a></span><span class="line">    MSS(3) = MSSLdJudgment( V_tar,V_me,V(3),T_long,Tc(3),T_lat,T_adj );</span></span>
<span class="srcline"><span class="lineno"><a href="80,540" id="srcline540"> 540</a></span><span class="line">    MSSLdlimitC = MSS(3) + L_veh(3) - X(3);</span></span>
<span class="srcline"><span class="lineno"><a href="80,541" id="srcline541"> 541</a></span><span class="line">else</span></span>
<span class="srcline"><span class="lineno"><a href="80,542" id="srcline542"> 542</a></span><span class="line">    MSSLdlimitC = -50;</span></span>
<span class="srcline"><span class="lineno"><a href="80,543" id="srcline543"> 543</a></span><span class="line">end    </span></span>
<span class="srcline"><span class="lineno"><a href="80,544" id="srcline544"> 544</a></span><span class="line">if Tc(4)&lt;255</span></span>
<span class="srcline"><span class="lineno"><a href="80,545" id="srcline545"> 545</a></span><span class="line">    MSS(4) = MSSLoJudgment( V_tar,V_me,V(4),T_long,Tc(4),T_lat,T_adj );</span></span>
<span class="srcline"><span class="lineno"><a href="80,546" id="srcline546"> 546</a></span><span class="line">    MSSLolimitC = MSS(4) + L_veh(4) - X(4);</span></span>
<span class="srcline"><span class="lineno"><a href="80,547" id="srcline547"> 547</a></span><span class="line">else</span></span>
<span class="srcline"><span class="lineno"><a href="80,548" id="srcline548"> 548</a></span><span class="line">    MSSLolimitC = -50;</span></span>
<span class="srcline"><span class="lineno"><a href="80,549" id="srcline549"> 549</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,550" id="srcline550"> 550</a></span><span class="line">X_melimitC =  x_outLo - X_melimit;</span></span>
<span class="srcline"><span class="lineno"><a href="80,551" id="srcline551"> 551</a></span><span class="line">C(1)=DeltalimitC;</span></span>
<span class="srcline"><span class="lineno"><a href="80,552" id="srcline552"> 552</a></span><span class="line">C(2)=KmlimitC;</span></span>
<span class="srcline"><span class="lineno"><a href="80,553" id="srcline553"> 553</a></span><span class="line">C(3)=MSSFdlimitC;</span></span>
<span class="srcline"><span class="lineno"><a href="80,554" id="srcline554"> 554</a></span><span class="line">C(4)=MSSFolimitC;</span></span>
<span class="srcline"><span class="lineno"><a href="80,555" id="srcline555"> 555</a></span><span class="line">C(5)=AxlimitC;</span></span>
<span class="srcline"><span class="lineno"><a href="80,556" id="srcline556"> 556</a></span><span class="line">C(6)=MSSLdlimitC;</span></span>
<span class="srcline"><span class="lineno"><a href="80,557" id="srcline557"> 557</a></span><span class="line">C(7)=MSSLolimitC;</span></span>
<span class="srcline"><span class="lineno"><a href="80,558" id="srcline558"> 558</a></span><span class="line">C(8)=X_melimitC;</span></span>
<span class="srcline"><span class="lineno"><a href="80,559" id="srcline559"> 559</a></span><span class="line">C(9)=AylimitC; </span></span>
<span class="srcline"><span class="lineno"><a href="80,560" id="srcline560"> 560</a></span><span class="line">Ceq = [];</span></span>
<span class="srcline"><span class="lineno"><a href="80,561" id="srcline561"> 561</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,562" id="srcline562"> 562</a></span><span class="line">function Tc = TcCalation(ArcPos,S_acc,V_tar,V_me,A)</span></span>
<span class="srcline"><span class="lineno"><a href="80,563" id="srcline563"> 563</a></span><span class="line">    if ArcPos &lt; 0.5</span></span>
<span class="srcline"><span class="lineno"><a href="80,564" id="srcline564"> 564</a></span><span class="line">        Tc = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,565" id="srcline565"> 565</a></span><span class="line">    else</span></span>
<span class="srcline"><span class="lineno"><a href="80,566" id="srcline566"> 566</a></span><span class="line">        if ArcPos &gt; S_acc</span></span>
<span class="srcline"><span class="lineno"><a href="80,567" id="srcline567"> 567</a></span><span class="line">            T_long = S_acc*2/(V_tar + V_me);</span></span>
<span class="srcline"><span class="lineno"><a href="80,568" id="srcline568"> 568</a></span><span class="line">            Tc = (ArcPos - S_acc)/V_tar + T_long;</span></span>
<span class="srcline"><span class="lineno"><a href="80,569" id="srcline569"> 569</a></span><span class="line">        else</span></span>
<span class="srcline"><span class="lineno"><a href="80,570" id="srcline570"> 570</a></span><span class="line">            if abs(A)&gt;1e-2</span></span>
<span class="srcline"><span class="lineno"><a href="80,571" id="srcline571"> 571</a></span><span class="line"><span class="comment">%                 Tc = (-V_me - sqrt(V_me^2+2*A*ArcPos))/A;</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,572" id="srcline572"> 572</a></span><span class="line"><span class="comment">%             elseif A &lt; -1e-2</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,573" id="srcline573"> 573</a></span><span class="line"><span class="comment">%                 Tc = (-V_me + sqrt(V_me^2+2*A*ArcPos))/A;</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,574" id="srcline574"> 574</a></span><span class="line">                Tc = (-V_me + sqrt(V_me^2+2*A*ArcPos))/A;</span></span>
<span class="srcline"><span class="lineno"><a href="80,575" id="srcline575"> 575</a></span><span class="line">            else</span></span>
<span class="srcline"><span class="lineno"><a href="80,576" id="srcline576"> 576</a></span><span class="line">                Tc = ArcPos/(abs(V_me)+1e-5);</span></span>
<span class="srcline"><span class="lineno"><a href="80,577" id="srcline577"> 577</a></span><span class="line">            end</span></span>
<span class="srcline"><span class="lineno"><a href="80,578" id="srcline578"> 578</a></span><span class="line">        end</span></span>
<span class="srcline"><span class="lineno"><a href="80,579" id="srcline579"> 579</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,580" id="srcline580"> 580</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,581" id="srcline581"> 581</a></span><span class="line">function [xposition,yposition,Theta,ArcPos] = ArcPosCal( angle_out,angle_in,x_in,y_in,x_out,y_out,Ycal,Xcal )</span></span>
<span class="srcline"><span class="lineno"><a href="80,582" id="srcline582"> 582</a></span><span class="line"><span class="comment">%UNTITLED2 Summary of this function goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,583" id="srcline583"> 583</a></span><span class="line"><span class="comment">%   Detailed explanation goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,584" id="srcline584"> 584</a></span><span class="line">    global  ArclengthTol</span></span>
<span class="srcline"><span class="lineno"><a href="80,585" id="srcline585"> 585</a></span><span class="line"><span class="comment">%     global x_qitemp y_qitemp theta_qitemp k_localmaxTemp DeltaTemp</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,586" id="srcline586"> 586</a></span><span class="line">    xposition = [0 0 0 0];</span></span>
<span class="srcline"><span class="lineno"><a href="80,587" id="srcline587"> 587</a></span><span class="line">    yposition = [1.5 1.5 1.5 1.5];</span></span>
<span class="srcline"><span class="lineno"><a href="80,588" id="srcline588"> 588</a></span><span class="line">    Theta = [0 0 0 0];</span></span>
<span class="srcline"><span class="lineno"><a href="80,589" id="srcline589"> 589</a></span><span class="line">    ArcPos = [0 0 0 0];</span></span>
<span class="srcline"><span class="lineno"><a href="80,590" id="srcline590"> 590</a></span><span class="line">    [ArcPos,xposition,Theta] = SecantMethod2( angle_out,angle_in,x_in,y_in,x_out,y_out,0.8*ArclengthTol(1),1.1*ArclengthTol(1),Ycal,Xcal,(ArclengthTol(1)+ArclengthTol(2)) ); </span></span>
<span class="srcline"><span class="lineno"><a href="80,591" id="srcline591"> 591</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,592" id="srcline592"> 592</a></span><span class="line"> </span></span>
<span class="srcline"><span class="lineno"><a href="80,593" id="srcline593"> 593</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,594" id="srcline594"> 594</a></span><span class="line">function [xres,xposition,theta] = SecantMethod2( angle_out,angle_in,x_in,y_in,x_out,y_out,x0,x1,Ycal,Xcal,ArcEnd )</span></span>
<span class="srcline"><span class="lineno"><a href="80,595" id="srcline595"> 595</a></span><span class="line">global V</span></span>
<span class="srcline"><span class="lineno"><a href="80,596" id="srcline596"> 596</a></span><span class="line">    <span class="comment">% Fd-Rl Fo-Rr Ld-Fl Lo-Fr</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,597" id="srcline597"> 597</a></span><span class="line">    xres = [0 0 0 0];</span></span>
<span class="srcline"><span class="lineno"><a href="80,598" id="srcline598"> 598</a></span><span class="line">    temp1 = x0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,599" id="srcline599"> 599</a></span><span class="line">    temp2 = x1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,600" id="srcline600"> 600</a></span><span class="line">    xposition = [0 0 0 0];</span></span>
<span class="srcline"><span class="lineno"><a href="80,601" id="srcline601"> 601</a></span><span class="line">    theta = [0 0 0 0]; </span></span>
<span class="srcline"><span class="lineno"><a href="80,602" id="srcline602"> 602</a></span><span class="line">    funAcy = 1e-1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,603" id="srcline603"> 603</a></span><span class="line">    <span class="comment">% Do a check, whether this function has a res</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,604" id="srcline604"> 604</a></span><span class="line">        <span class="comment">% TBD change 4</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,605" id="srcline605"> 605</a></span><span class="line">        <span class="comment">%     x0 = x2;</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,606" id="srcline606"> 606</a></span><span class="line"><span class="comment">%         </span></span></span>
<span class="srcline"><span class="lineno"><a href="80,607" id="srcline607"> 607</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,608" id="srcline608"> 608</a></span><span class="line">      if abs(V(1))&lt;100  </span></span>
<span class="srcline"><span class="lineno"><a href="80,609" id="srcline609"> 609</a></span><span class="line">            [xpositionRlStart,ypositionRlStart,ThetaRlStart] = LaneChgRlPosCal2( 0,angle_out,angle_in,x_in,y_in,x_out,y_out );</span></span>
<span class="srcline"><span class="lineno"><a href="80,610" id="srcline610"> 610</a></span><span class="line">            [xpositionRlEnd,ypositionRlEnd,ThetaRlEnd] = LaneChgRlPosCal2( ArcEnd,angle_out,angle_in,x_in,y_in,x_out,y_out );</span></span>
<span class="srcline"><span class="lineno"><a href="80,611" id="srcline611"> 611</a></span><span class="line">            YcalLoStart = YcalFunc(Xcal(1),Ycal(1),angle_out,xpositionRlStart);</span></span>
<span class="srcline"><span class="lineno"><a href="80,612" id="srcline612"> 612</a></span><span class="line">            YcalLoEnd = YcalFunc(Xcal(1),Ycal(1),angle_out,xpositionRlEnd);</span></span>
<span class="srcline"><span class="lineno"><a href="80,613" id="srcline613"> 613</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="80,614" id="srcline614"> 614</a></span><span class="line">            if (ypositionRlEnd &lt; YcalLoStart)</span></span>
<span class="srcline"><span class="lineno"><a href="80,615" id="srcline615"> 615</a></span><span class="line">                xres(1) = 255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,616" id="srcline616"> 616</a></span><span class="line">                xposition(1) = 255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,617" id="srcline617"> 617</a></span><span class="line">                theta(1) = 255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,618" id="srcline618"> 618</a></span><span class="line">            elseif (ypositionRlStart &gt; YcalLoEnd)</span></span>
<span class="srcline"><span class="lineno"><a href="80,619" id="srcline619"> 619</a></span><span class="line">                xres(1) = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,620" id="srcline620"> 620</a></span><span class="line">                xposition(1) = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,621" id="srcline621"> 621</a></span><span class="line">                theta(1) = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,622" id="srcline622"> 622</a></span><span class="line">            else</span></span>
<span class="srcline"><span class="lineno"><a href="80,623" id="srcline623"> 623</a></span><span class="line">                x0 = temp1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,624" id="srcline624"> 624</a></span><span class="line">                x1 = temp2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,625" id="srcline625"> 625</a></span><span class="line">        <span class="comment">%         [xpositionRl1,ypositionRl1,ThetaRl1] = LaneChgRlPosCal2( x1,angle_out,angle_in,x_in,y_in,x_out,y_out );</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,626" id="srcline626"> 626</a></span><span class="line">        <span class="comment">%         funx1 = ypositionRl1 -  Ycal(1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,627" id="srcline627"> 627</a></span><span class="line">        <span class="comment">%         [xpositionRl0,ypositionRl0,ThetaRl0] = LaneChgRlPosCal2( x0,angle_out,angle_in,x_in,y_in,x_out,y_out );</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,628" id="srcline628"> 628</a></span><span class="line">        <span class="comment">%         funx0 = ypositionRl0 - Ycal(1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,629" id="srcline629"> 629</a></span><span class="line">        <span class="comment">%         x2 = x1-funx1*(x1-x0)/(funx1-funx0);</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,630" id="srcline630"> 630</a></span><span class="line">                <span class="comment">%x2 = x1-fun(x1)*(x1-x0)/(fun(x1)-fun(x0));    n = 1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,631" id="srcline631"> 631</a></span><span class="line">                Secantn = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,632" id="srcline632"> 632</a></span><span class="line">                xres(1) = -255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,633" id="srcline633"> 633</a></span><span class="line">                xposition(1) = -255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,634" id="srcline634"> 634</a></span><span class="line">                theta(1) = -255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,635" id="srcline635"> 635</a></span><span class="line">                while(1)       <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,636" id="srcline636"> 636</a></span><span class="line">        <span class="comment">%             x0=x1;                                       %x1x0</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,637" id="srcline637"> 637</a></span><span class="line">        <span class="comment">%             x1=x2;                                       %x2x1</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,638" id="srcline638"> 638</a></span><span class="line">                    <span class="comment">%x2=x1-fun(x1)*(x1-x0)/(fun(x1)-fun(x0));     %</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,639" id="srcline639"> 639</a></span><span class="line">                    [xpositionRl1,ypositionRl1,ThetaRl1] = LaneChgRlPosCal2( x1,angle_out,angle_in,x_in,y_in,x_out,y_out );                                </span></span>
<span class="srcline"><span class="lineno"><a href="80,640" id="srcline640"> 640</a></span><span class="line">                    YcalLo1 = YcalFunc(Xcal(1),Ycal(1),angle_out,xpositionRl1);                    </span></span>
<span class="srcline"><span class="lineno"><a href="80,641" id="srcline641"> 641</a></span><span class="line">                    funx1 = ypositionRl1 - YcalLo1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,642" id="srcline642"> 642</a></span><span class="line">                    if (funx1 &lt; funAcy)&amp;&amp;(funx1 &gt; -funAcy)</span></span>
<span class="srcline"><span class="lineno"><a href="80,643" id="srcline643"> 643</a></span><span class="line">                        xTemp = x1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,644" id="srcline644"> 644</a></span><span class="line">                        xpositionTemp = xpositionRl1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,645" id="srcline645"> 645</a></span><span class="line">                        ThetaRTemp = ThetaRl1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,646" id="srcline646"> 646</a></span><span class="line">                        break;</span></span>
<span class="srcline"><span class="lineno"><a href="80,647" id="srcline647"> 647</a></span><span class="line">                    else</span></span>
<span class="srcline"><span class="lineno"><a href="80,648" id="srcline648"> 648</a></span><span class="line">                    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,649" id="srcline649"> 649</a></span><span class="line">                    [xpositionRl0,ypositionRl0,ThetaRl0] = LaneChgRlPosCal2( x0,angle_out,angle_in,x_in,y_in,x_out,y_out );</span></span>
<span class="srcline"><span class="lineno"><a href="80,650" id="srcline650"> 650</a></span><span class="line">                    YcalLo0 = YcalFunc(Xcal(1),Ycal(1),angle_out,xpositionRl0);</span></span>
<span class="srcline"><span class="lineno"><a href="80,651" id="srcline651"> 651</a></span><span class="line">                    funx0 = ypositionRl0 - YcalLo0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,652" id="srcline652"> 652</a></span><span class="line">                    if (funx0 &lt; funAcy)&amp;&amp;(funx0 &gt; -funAcy)</span></span>
<span class="srcline"><span class="lineno"><a href="80,653" id="srcline653"> 653</a></span><span class="line">                        xTemp = x0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,654" id="srcline654"> 654</a></span><span class="line">                        xpositionTemp = xpositionRl0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,655" id="srcline655"> 655</a></span><span class="line">                        ThetaRTemp = ThetaRl0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,656" id="srcline656"> 656</a></span><span class="line">                        break;</span></span>
<span class="srcline"><span class="lineno"><a href="80,657" id="srcline657"> 657</a></span><span class="line">                    else</span></span>
<span class="srcline"><span class="lineno"><a href="80,658" id="srcline658"> 658</a></span><span class="line">                    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,659" id="srcline659"> 659</a></span><span class="line">                    if abs(funx1-funx0)&gt;funAcy</span></span>
<span class="srcline"><span class="lineno"><a href="80,660" id="srcline660"> 660</a></span><span class="line">                        x2 = x1-funx1*(x1-x0)/(funx1-funx0);</span></span>
<span class="srcline"><span class="lineno"><a href="80,661" id="srcline661"> 661</a></span><span class="line">                        x0=x1;                                       <span class="comment">%x1x0</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,662" id="srcline662"> 662</a></span><span class="line">                        x1=x2;                                       <span class="comment">%x2x1</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,663" id="srcline663"> 663</a></span><span class="line">                    else</span></span>
<span class="srcline"><span class="lineno"><a href="80,664" id="srcline664"> 664</a></span><span class="line">                        xTemp = (x0+x1)/2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,665" id="srcline665"> 665</a></span><span class="line">                        xpositionTemp = (xpositionRl0+xpositionRl1)/2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,666" id="srcline666"> 666</a></span><span class="line">                        ThetaRTemp = (ThetaRl0+ThetaRl1)/2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,667" id="srcline667"> 667</a></span><span class="line">                        break;</span></span>
<span class="srcline"><span class="lineno"><a href="80,668" id="srcline668"> 668</a></span><span class="line">                    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,669" id="srcline669"> 669</a></span><span class="line">                    if (abs(x1-x0)&gt;=1.0e-1) &amp;&amp; (Secantn&lt;=20)</span></span>
<span class="srcline"><span class="lineno"><a href="80,670" id="srcline670"> 670</a></span><span class="line">                    else</span></span>
<span class="srcline"><span class="lineno"><a href="80,671" id="srcline671"> 671</a></span><span class="line">                        xTemp = (x0+x1)/2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,672" id="srcline672"> 672</a></span><span class="line">                        xpositionTemp = (xpositionRl0+xpositionRl1)/2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,673" id="srcline673"> 673</a></span><span class="line">                        ThetaRTemp = (ThetaRl0+ThetaRl1)/2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,674" id="srcline674"> 674</a></span><span class="line">                        break;</span></span>
<span class="srcline"><span class="lineno"><a href="80,675" id="srcline675"> 675</a></span><span class="line">                    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,676" id="srcline676"> 676</a></span><span class="line">                    Secantn=Secantn+1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,677" id="srcline677"> 677</a></span><span class="line">                end</span></span>
<span class="srcline"><span class="lineno"><a href="80,678" id="srcline678"> 678</a></span><span class="line">                xres(1) = xTemp;</span></span>
<span class="srcline"><span class="lineno"><a href="80,679" id="srcline679"> 679</a></span><span class="line">                xposition(1) = xpositionTemp;</span></span>
<span class="srcline"><span class="lineno"><a href="80,680" id="srcline680"> 680</a></span><span class="line">                theta(1) = ThetaRTemp;</span></span>
<span class="srcline"><span class="lineno"><a href="80,681" id="srcline681"> 681</a></span><span class="line">            end</span></span>
<span class="srcline"><span class="lineno"><a href="80,682" id="srcline682"> 682</a></span><span class="line">      else</span></span>
<span class="srcline"><span class="lineno"><a href="80,683" id="srcline683"> 683</a></span><span class="line">          xres(1) = -255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,684" id="srcline684"> 684</a></span><span class="line">          xposition(1) = -255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,685" id="srcline685"> 685</a></span><span class="line">          theta(1) = -255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,686" id="srcline686"> 686</a></span><span class="line">      end</span></span>
<span class="srcline"><span class="lineno"><a href="80,687" id="srcline687"> 687</a></span><span class="line">      if abs(V(2))&lt;100  </span></span>
<span class="srcline"><span class="lineno"><a href="80,688" id="srcline688"> 688</a></span><span class="line">            <span class="comment">% Do a check, whether this function has a res</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,689" id="srcline689"> 689</a></span><span class="line">                <span class="comment">% TBD change 4</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,690" id="srcline690"> 690</a></span><span class="line">                <span class="comment">%     x0 = x2;</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,691" id="srcline691"> 691</a></span><span class="line">            [xpositionRrStart,ypositionRrStart,ThetaRrStart] = LaneChgRrPosCal2( 0,angle_out,angle_in,x_in,y_in,x_out,y_out );</span></span>
<span class="srcline"><span class="lineno"><a href="80,692" id="srcline692"> 692</a></span><span class="line">            [xpositionRrEnd,ypositionRrEnd,ThetaRrEnd] = LaneChgRrPosCal2( ArcEnd,angle_out,angle_in,x_in,y_in,x_out,y_out );</span></span>
<span class="srcline"><span class="lineno"><a href="80,693" id="srcline693"> 693</a></span><span class="line">            YcalLoStart = YcalFunc(Xcal(2),Ycal(2),angle_out,xpositionRrStart);</span></span>
<span class="srcline"><span class="lineno"><a href="80,694" id="srcline694"> 694</a></span><span class="line">            YcalLoEnd = YcalFunc(Xcal(2),Ycal(2),angle_out,xpositionRrEnd);</span></span>
<span class="srcline"><span class="lineno"><a href="80,695" id="srcline695"> 695</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="80,696" id="srcline696"> 696</a></span><span class="line">            if (ypositionRrEnd &lt; YcalLoStart)</span></span>
<span class="srcline"><span class="lineno"><a href="80,697" id="srcline697"> 697</a></span><span class="line">                xres(2) = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,698" id="srcline698"> 698</a></span><span class="line">                xposition(2) = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,699" id="srcline699"> 699</a></span><span class="line">                theta(2) = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,700" id="srcline700"> 700</a></span><span class="line">            elseif(ypositionRrStart &gt; YcalLoEnd)</span></span>
<span class="srcline"><span class="lineno"><a href="80,701" id="srcline701"> 701</a></span><span class="line">                xres(2) = 255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,702" id="srcline702"> 702</a></span><span class="line">                xposition(2) = 255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,703" id="srcline703"> 703</a></span><span class="line">                theta(2) = 255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,704" id="srcline704"> 704</a></span><span class="line">            else</span></span>
<span class="srcline"><span class="lineno"><a href="80,705" id="srcline705"> 705</a></span><span class="line">                x0 = temp1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,706" id="srcline706"> 706</a></span><span class="line">                x1 = temp2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,707" id="srcline707"> 707</a></span><span class="line">                Secantn = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,708" id="srcline708"> 708</a></span><span class="line">                xres(2) = -255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,709" id="srcline709"> 709</a></span><span class="line">                xposition(2) = -255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,710" id="srcline710"> 710</a></span><span class="line">                theta(2) = -255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,711" id="srcline711"> 711</a></span><span class="line">                while(1)       <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,712" id="srcline712"> 712</a></span><span class="line">        <span class="comment">%             x0=x1;                                       %x1x0</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,713" id="srcline713"> 713</a></span><span class="line">        <span class="comment">%             x1=x2;                                       %x2x1</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,714" id="srcline714"> 714</a></span><span class="line">                    <span class="comment">%x2=x1-fun(x1)*(x1-x0)/(fun(x1)-fun(x0));     %</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,715" id="srcline715"> 715</a></span><span class="line">                    [xpositionRr1,ypositionRr1,ThetaRr1] = LaneChgRrPosCal2( x1,angle_out,angle_in,x_in,y_in,x_out,y_out );</span></span>
<span class="srcline"><span class="lineno"><a href="80,716" id="srcline716"> 716</a></span><span class="line">                    YcalLo1 = YcalFunc(Xcal(2),Ycal(2),angle_out,xpositionRr1);                    </span></span>
<span class="srcline"><span class="lineno"><a href="80,717" id="srcline717"> 717</a></span><span class="line">                    funx1 = ypositionRr1 - YcalLo1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,718" id="srcline718"> 718</a></span><span class="line">                    if (funx1 &lt; funAcy)&amp;&amp;(funx1 &gt; -funAcy)</span></span>
<span class="srcline"><span class="lineno"><a href="80,719" id="srcline719"> 719</a></span><span class="line">                        xTemp = x1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,720" id="srcline720"> 720</a></span><span class="line">                        xpositionTemp = xpositionRr1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,721" id="srcline721"> 721</a></span><span class="line">                        ThetaRTemp = ThetaRr1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,722" id="srcline722"> 722</a></span><span class="line">                        break;</span></span>
<span class="srcline"><span class="lineno"><a href="80,723" id="srcline723"> 723</a></span><span class="line">                    else</span></span>
<span class="srcline"><span class="lineno"><a href="80,724" id="srcline724"> 724</a></span><span class="line">                    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,725" id="srcline725"> 725</a></span><span class="line">                    [xpositionRr0,ypositionRr0,ThetaRr0] = LaneChgRrPosCal2( x0,angle_out,angle_in,x_in,y_in,x_out,y_out );</span></span>
<span class="srcline"><span class="lineno"><a href="80,726" id="srcline726"> 726</a></span><span class="line">                    YcalLo0 = YcalFunc(Xcal(2),Ycal(2),angle_out,xpositionRr0);                    </span></span>
<span class="srcline"><span class="lineno"><a href="80,727" id="srcline727"> 727</a></span><span class="line">                    funx0 = ypositionRr0 - YcalLo0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,728" id="srcline728"> 728</a></span><span class="line">                    if (funx0 &lt; funAcy)&amp;&amp;(funx0 &gt; -funAcy)</span></span>
<span class="srcline"><span class="lineno"><a href="80,729" id="srcline729"> 729</a></span><span class="line">                        xTemp = x0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,730" id="srcline730"> 730</a></span><span class="line">                        xpositionTemp = xpositionRr0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,731" id="srcline731"> 731</a></span><span class="line">                        ThetaRTemp = ThetaRr0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,732" id="srcline732"> 732</a></span><span class="line">                        break;</span></span>
<span class="srcline"><span class="lineno"><a href="80,733" id="srcline733"> 733</a></span><span class="line">                    else</span></span>
<span class="srcline"><span class="lineno"><a href="80,734" id="srcline734"> 734</a></span><span class="line">                    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,735" id="srcline735"> 735</a></span><span class="line">                    if abs(funx1-funx0)&gt;funAcy</span></span>
<span class="srcline"><span class="lineno"><a href="80,736" id="srcline736"> 736</a></span><span class="line">                        x2 = x1-funx1*(x1-x0)/(funx1-funx0);</span></span>
<span class="srcline"><span class="lineno"><a href="80,737" id="srcline737"> 737</a></span><span class="line">                        x0=x1;                                       <span class="comment">%x1x0</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,738" id="srcline738"> 738</a></span><span class="line">                        x1=x2;                                       <span class="comment">%x2x1</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,739" id="srcline739"> 739</a></span><span class="line">                    else</span></span>
<span class="srcline"><span class="lineno"><a href="80,740" id="srcline740"> 740</a></span><span class="line">                        xTemp = (x0+x1)/2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,741" id="srcline741"> 741</a></span><span class="line">                        xpositionTemp = (xpositionRr1+xpositionRr0)/2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,742" id="srcline742"> 742</a></span><span class="line">                        ThetaRTemp = (ThetaRr0+ThetaRr1)/2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,743" id="srcline743"> 743</a></span><span class="line">                        break;</span></span>
<span class="srcline"><span class="lineno"><a href="80,744" id="srcline744"> 744</a></span><span class="line">                    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,745" id="srcline745"> 745</a></span><span class="line">                    if (abs(x1-x0)&gt;=1.0e-1) &amp;&amp; (Secantn&lt;=20)</span></span>
<span class="srcline"><span class="lineno"><a href="80,746" id="srcline746"> 746</a></span><span class="line">                    else</span></span>
<span class="srcline"><span class="lineno"><a href="80,747" id="srcline747"> 747</a></span><span class="line">                        xTemp = (x0+x1)/2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,748" id="srcline748"> 748</a></span><span class="line">                        xpositionTemp = (xpositionRr1+xpositionRr0)/2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,749" id="srcline749"> 749</a></span><span class="line">                        ThetaRTemp = (ThetaRr0+ThetaRr1)/2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,750" id="srcline750"> 750</a></span><span class="line">                        break;</span></span>
<span class="srcline"><span class="lineno"><a href="80,751" id="srcline751"> 751</a></span><span class="line">                    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,752" id="srcline752"> 752</a></span><span class="line">                    Secantn=Secantn+1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,753" id="srcline753"> 753</a></span><span class="line">                end</span></span>
<span class="srcline"><span class="lineno"><a href="80,754" id="srcline754"> 754</a></span><span class="line">                xres(2) = xTemp;</span></span>
<span class="srcline"><span class="lineno"><a href="80,755" id="srcline755"> 755</a></span><span class="line">                xposition(2) = xpositionTemp;</span></span>
<span class="srcline"><span class="lineno"><a href="80,756" id="srcline756"> 756</a></span><span class="line">                theta(2) = ThetaRTemp; </span></span>
<span class="srcline"><span class="lineno"><a href="80,757" id="srcline757"> 757</a></span><span class="line">            end </span></span>
<span class="srcline"><span class="lineno"><a href="80,758" id="srcline758"> 758</a></span><span class="line">      else</span></span>
<span class="srcline"><span class="lineno"><a href="80,759" id="srcline759"> 759</a></span><span class="line">            xres(2) = -255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,760" id="srcline760"> 760</a></span><span class="line">            xposition(2) = -255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,761" id="srcline761"> 761</a></span><span class="line">            theta(2) = -255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,762" id="srcline762"> 762</a></span><span class="line">      end</span></span>
<span class="srcline"><span class="lineno"><a href="80,763" id="srcline763"> 763</a></span><span class="line">      if abs(V(3))&lt;100  </span></span>
<span class="srcline"><span class="lineno"><a href="80,764" id="srcline764"> 764</a></span><span class="line">            <span class="comment">% Do a simple check, whether this function has a res</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,765" id="srcline765"> 765</a></span><span class="line">            [xpositionFlEnd,ypositionFlEnd,ThetaFlEnd] = LaneChgFlPosCal2( ArcEnd,angle_out,angle_in,x_in,y_in,x_out,y_out );</span></span>
<span class="srcline"><span class="lineno"><a href="80,766" id="srcline766"> 766</a></span><span class="line">            [xpositionFlStart,ypositionFlStart,ThetaFlStart] = LaneChgFlPosCal2( 0,angle_out,angle_in,x_in,y_in,x_out,y_out );</span></span>
<span class="srcline"><span class="lineno"><a href="80,767" id="srcline767"> 767</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="80,768" id="srcline768"> 768</a></span><span class="line">            YcalLoStart = YcalFunc(Xcal(3),Ycal(3),angle_out,xpositionFlStart);</span></span>
<span class="srcline"><span class="lineno"><a href="80,769" id="srcline769"> 769</a></span><span class="line">            YcalLoEnd = YcalFunc(Xcal(3),Ycal(3),angle_out,xpositionFlEnd);</span></span>
<span class="srcline"><span class="lineno"><a href="80,770" id="srcline770"> 770</a></span><span class="line">            if (ypositionFlEnd &lt; YcalLoStart)</span></span>
<span class="srcline"><span class="lineno"><a href="80,771" id="srcline771"> 771</a></span><span class="line">                xres(3) = 255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,772" id="srcline772"> 772</a></span><span class="line">                xposition(3) = 255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,773" id="srcline773"> 773</a></span><span class="line">                theta(3) = 255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,774" id="srcline774"> 774</a></span><span class="line">            elseif(ypositionFlStart &gt; YcalLoEnd)</span></span>
<span class="srcline"><span class="lineno"><a href="80,775" id="srcline775"> 775</a></span><span class="line">                xres(3) = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,776" id="srcline776"> 776</a></span><span class="line">                xposition(3) = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,777" id="srcline777"> 777</a></span><span class="line">                theta(3) = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,778" id="srcline778"> 778</a></span><span class="line">            else</span></span>
<span class="srcline"><span class="lineno"><a href="80,779" id="srcline779"> 779</a></span><span class="line">                x0 = temp1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,780" id="srcline780"> 780</a></span><span class="line">                x1 = temp2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,781" id="srcline781"> 781</a></span><span class="line">                Secantn = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,782" id="srcline782"> 782</a></span><span class="line">                xres(3) = -255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,783" id="srcline783"> 783</a></span><span class="line">                xposition(3) = -255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,784" id="srcline784"> 784</a></span><span class="line">                theta(3) = -255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,785" id="srcline785"> 785</a></span><span class="line">                while(1)  </span></span>
<span class="srcline"><span class="lineno"><a href="80,786" id="srcline786"> 786</a></span><span class="line">                    [xpositionFl1,ypositionFl1,ThetaFl1] = LaneChgFlPosCal2( x1,angle_out,angle_in,x_in,y_in,x_out,y_out );</span></span>
<span class="srcline"><span class="lineno"><a href="80,787" id="srcline787"> 787</a></span><span class="line">                    YcalLo1 = YcalFunc(Xcal(3),Ycal(3),angle_out,xpositionFl1);      </span></span>
<span class="srcline"><span class="lineno"><a href="80,788" id="srcline788"> 788</a></span><span class="line">                    funx1 = ypositionFl1 -  YcalLo1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,789" id="srcline789"> 789</a></span><span class="line">                    if (funx1 &lt; funAcy)&amp;&amp;(funx1 &gt; -funAcy)</span></span>
<span class="srcline"><span class="lineno"><a href="80,790" id="srcline790"> 790</a></span><span class="line">                        xTemp = x1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,791" id="srcline791"> 791</a></span><span class="line">                        xpositionTemp = xpositionFl1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,792" id="srcline792"> 792</a></span><span class="line">                        ThetaRTemp = ThetaFl1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,793" id="srcline793"> 793</a></span><span class="line">                        break;</span></span>
<span class="srcline"><span class="lineno"><a href="80,794" id="srcline794"> 794</a></span><span class="line">                    else</span></span>
<span class="srcline"><span class="lineno"><a href="80,795" id="srcline795"> 795</a></span><span class="line">                    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,796" id="srcline796"> 796</a></span><span class="line">                    [xpositionFl0,ypositionFl0,ThetaFl0] = LaneChgFlPosCal2( x0,angle_out,angle_in,x_in,y_in,x_out,y_out );</span></span>
<span class="srcline"><span class="lineno"><a href="80,797" id="srcline797"> 797</a></span><span class="line">                    YcalLo0 = YcalFunc(Xcal(3),Ycal(3),angle_out,xpositionFl0);    </span></span>
<span class="srcline"><span class="lineno"><a href="80,798" id="srcline798"> 798</a></span><span class="line">                    funx0 = ypositionFl0 -  YcalLo0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,799" id="srcline799"> 799</a></span><span class="line">                    if (funx0 &lt; funAcy)&amp;&amp;(funx0 &gt; -funAcy)</span></span>
<span class="srcline"><span class="lineno"><a href="80,800" id="srcline800"> 800</a></span><span class="line">                        xTemp = x0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,801" id="srcline801"> 801</a></span><span class="line">                        xpositionTemp = xpositionFl0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,802" id="srcline802"> 802</a></span><span class="line">                        ThetaRTemp = ThetaFl0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,803" id="srcline803"> 803</a></span><span class="line">                        break;</span></span>
<span class="srcline"><span class="lineno"><a href="80,804" id="srcline804"> 804</a></span><span class="line">                    else</span></span>
<span class="srcline"><span class="lineno"><a href="80,805" id="srcline805"> 805</a></span><span class="line">                    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,806" id="srcline806"> 806</a></span><span class="line">                    if abs(funx1-funx0)&gt;funAcy</span></span>
<span class="srcline"><span class="lineno"><a href="80,807" id="srcline807"> 807</a></span><span class="line">                        x2 = x1-funx1*(x1-x0)/(funx1-funx0);</span></span>
<span class="srcline"><span class="lineno"><a href="80,808" id="srcline808"> 808</a></span><span class="line">                        x0=x1;                                       <span class="comment">%x1x0</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,809" id="srcline809"> 809</a></span><span class="line">                        x1=x2;                                       <span class="comment">%x2x1</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,810" id="srcline810"> 810</a></span><span class="line">                    else</span></span>
<span class="srcline"><span class="lineno"><a href="80,811" id="srcline811"> 811</a></span><span class="line">                        xTemp = (x0+x1)/2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,812" id="srcline812"> 812</a></span><span class="line">                        xpositionTemp = (xpositionFl1+xpositionFl0)/2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,813" id="srcline813"> 813</a></span><span class="line">                        ThetaRTemp = (ThetaFl1+ThetaFl0)/2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,814" id="srcline814"> 814</a></span><span class="line">                        break;</span></span>
<span class="srcline"><span class="lineno"><a href="80,815" id="srcline815"> 815</a></span><span class="line">                    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,816" id="srcline816"> 816</a></span><span class="line">                    if (abs(x1-x0)&gt;=1.0e-1) &amp;&amp; (Secantn&lt;=20)</span></span>
<span class="srcline"><span class="lineno"><a href="80,817" id="srcline817"> 817</a></span><span class="line">                    else</span></span>
<span class="srcline"><span class="lineno"><a href="80,818" id="srcline818"> 818</a></span><span class="line">                        xTemp = (x0+x1)/2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,819" id="srcline819"> 819</a></span><span class="line">                        xpositionTemp = (xpositionFl1+xpositionFl0)/2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,820" id="srcline820"> 820</a></span><span class="line">                        ThetaRTemp = (ThetaFl1+ThetaFl0)/2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,821" id="srcline821"> 821</a></span><span class="line">                        break;</span></span>
<span class="srcline"><span class="lineno"><a href="80,822" id="srcline822"> 822</a></span><span class="line">                    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,823" id="srcline823"> 823</a></span><span class="line">                    Secantn=Secantn+1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,824" id="srcline824"> 824</a></span><span class="line">                end</span></span>
<span class="srcline"><span class="lineno"><a href="80,825" id="srcline825"> 825</a></span><span class="line">                xres(3) = xTemp;</span></span>
<span class="srcline"><span class="lineno"><a href="80,826" id="srcline826"> 826</a></span><span class="line">                xposition(3) = xpositionTemp;</span></span>
<span class="srcline"><span class="lineno"><a href="80,827" id="srcline827"> 827</a></span><span class="line">                theta(3) = ThetaRTemp;</span></span>
<span class="srcline"><span class="lineno"><a href="80,828" id="srcline828"> 828</a></span><span class="line">            end</span></span>
<span class="srcline"><span class="lineno"><a href="80,829" id="srcline829"> 829</a></span><span class="line">      else</span></span>
<span class="srcline"><span class="lineno"><a href="80,830" id="srcline830"> 830</a></span><span class="line">            xres(3) = -255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,831" id="srcline831"> 831</a></span><span class="line">            xposition(3) = -255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,832" id="srcline832"> 832</a></span><span class="line">            theta(3) = -255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,833" id="srcline833"> 833</a></span><span class="line">      end</span></span>
<span class="srcline"><span class="lineno"><a href="80,834" id="srcline834"> 834</a></span><span class="line">      if abs(V(4))&lt;100</span></span>
<span class="srcline"><span class="lineno"><a href="80,835" id="srcline835"> 835</a></span><span class="line">            [xpositionFrEnd,ypositionFrEnd,ThetaFrEnd] = LaneChgFrPosCal2( ArcEnd,angle_out,angle_in,x_in,y_in,x_out,y_out );</span></span>
<span class="srcline"><span class="lineno"><a href="80,836" id="srcline836"> 836</a></span><span class="line">            [xpositionFrStart,ypositionFrStart,ThetaFrStart] = LaneChgFrPosCal2( 0,angle_out,angle_in,x_in,y_in,x_out,y_out );</span></span>
<span class="srcline"><span class="lineno"><a href="80,837" id="srcline837"> 837</a></span><span class="line">            YcalLoStart = YcalFunc(Xcal(4),Ycal(4),angle_out,xpositionFrStart);</span></span>
<span class="srcline"><span class="lineno"><a href="80,838" id="srcline838"> 838</a></span><span class="line">            YcalLoEnd = YcalFunc(Xcal(4),Ycal(4),angle_out,xpositionFrEnd);</span></span>
<span class="srcline"><span class="lineno"><a href="80,839" id="srcline839"> 839</a></span><span class="line">            if (ypositionFrEnd &lt; YcalLoStart)</span></span>
<span class="srcline"><span class="lineno"><a href="80,840" id="srcline840"> 840</a></span><span class="line">                xres(4) = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,841" id="srcline841"> 841</a></span><span class="line">                xposition(4) = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,842" id="srcline842"> 842</a></span><span class="line">                theta(4) = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,843" id="srcline843"> 843</a></span><span class="line">            elseif(ypositionFrStart &gt; YcalLoEnd)</span></span>
<span class="srcline"><span class="lineno"><a href="80,844" id="srcline844"> 844</a></span><span class="line">                xres(4) = 255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,845" id="srcline845"> 845</a></span><span class="line">                xposition(4) = 255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,846" id="srcline846"> 846</a></span><span class="line">                theta(4) = 255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,847" id="srcline847"> 847</a></span><span class="line">            else</span></span>
<span class="srcline"><span class="lineno"><a href="80,848" id="srcline848"> 848</a></span><span class="line">                x0 = temp1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,849" id="srcline849"> 849</a></span><span class="line">                x1 = temp2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,850" id="srcline850"> 850</a></span><span class="line">                Secantn = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,851" id="srcline851"> 851</a></span><span class="line">                xres(4) = -255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,852" id="srcline852"> 852</a></span><span class="line">                xposition(4) = -255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,853" id="srcline853"> 853</a></span><span class="line">                theta(4) = -255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,854" id="srcline854"> 854</a></span><span class="line">                while(1) </span></span>
<span class="srcline"><span class="lineno"><a href="80,855" id="srcline855"> 855</a></span><span class="line">                    [xpositionFr1,ypositionFr1,ThetaFr1] = LaneChgFrPosCal2( x1,angle_out,angle_in,x_in,y_in,x_out,y_out );</span></span>
<span class="srcline"><span class="lineno"><a href="80,856" id="srcline856"> 856</a></span><span class="line">                    YcalLo1 = YcalFunc(Xcal(4),Ycal(4),angle_out,xpositionFr1);      </span></span>
<span class="srcline"><span class="lineno"><a href="80,857" id="srcline857"> 857</a></span><span class="line">                    funx1 = ypositionFr1 -  YcalLo1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,858" id="srcline858"> 858</a></span><span class="line">                    if (funx1 &lt; funAcy)&amp;&amp;(funx1 &gt; -funAcy)</span></span>
<span class="srcline"><span class="lineno"><a href="80,859" id="srcline859"> 859</a></span><span class="line">                        xTemp = x1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,860" id="srcline860"> 860</a></span><span class="line">                        xpositionTemp = xpositionFr1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,861" id="srcline861"> 861</a></span><span class="line">                        ThetaRTemp = ThetaFr1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,862" id="srcline862"> 862</a></span><span class="line">                        break;</span></span>
<span class="srcline"><span class="lineno"><a href="80,863" id="srcline863"> 863</a></span><span class="line">                    else</span></span>
<span class="srcline"><span class="lineno"><a href="80,864" id="srcline864"> 864</a></span><span class="line">                    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,865" id="srcline865"> 865</a></span><span class="line">                    [xpositionFr0,ypositionFr0,ThetaFr0] = LaneChgFrPosCal2( x0,angle_out,angle_in,x_in,y_in,x_out,y_out );</span></span>
<span class="srcline"><span class="lineno"><a href="80,866" id="srcline866"> 866</a></span><span class="line">                    YcalLo0 = YcalFunc(Xcal(4),Ycal(4),angle_out,xpositionFr0);      </span></span>
<span class="srcline"><span class="lineno"><a href="80,867" id="srcline867"> 867</a></span><span class="line">                    funx0 = ypositionFr0 -  YcalLo0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,868" id="srcline868"> 868</a></span><span class="line">                    if (funx0 &lt; funAcy)&amp;&amp;(funx0 &gt; -funAcy)</span></span>
<span class="srcline"><span class="lineno"><a href="80,869" id="srcline869"> 869</a></span><span class="line">                        xTemp = x0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,870" id="srcline870"> 870</a></span><span class="line">                        xpositionTemp = xpositionFr0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,871" id="srcline871"> 871</a></span><span class="line">                        ThetaRTemp = ThetaFr0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,872" id="srcline872"> 872</a></span><span class="line">                        break;</span></span>
<span class="srcline"><span class="lineno"><a href="80,873" id="srcline873"> 873</a></span><span class="line">                    else</span></span>
<span class="srcline"><span class="lineno"><a href="80,874" id="srcline874"> 874</a></span><span class="line">                    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,875" id="srcline875"> 875</a></span><span class="line">                    if abs(funx1-funx0)&gt;funAcy/2</span></span>
<span class="srcline"><span class="lineno"><a href="80,876" id="srcline876"> 876</a></span><span class="line">                        x2 = x1-funx1*(x1-x0)/(funx1-funx0);</span></span>
<span class="srcline"><span class="lineno"><a href="80,877" id="srcline877"> 877</a></span><span class="line">                        x0=x1;                                       <span class="comment">%x1x0</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,878" id="srcline878"> 878</a></span><span class="line">                        x1=x2;                                       <span class="comment">%x2x1</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,879" id="srcline879"> 879</a></span><span class="line">                    else</span></span>
<span class="srcline"><span class="lineno"><a href="80,880" id="srcline880"> 880</a></span><span class="line">                        xTemp = (x0+x1)/2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,881" id="srcline881"> 881</a></span><span class="line">                        xpositionTemp = (xpositionFr0+xpositionFr1)/2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,882" id="srcline882"> 882</a></span><span class="line">                        ThetaRTemp = (ThetaFr1+ThetaFr0)/2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,883" id="srcline883"> 883</a></span><span class="line">                        break;</span></span>
<span class="srcline"><span class="lineno"><a href="80,884" id="srcline884"> 884</a></span><span class="line">                    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,885" id="srcline885"> 885</a></span><span class="line">                    if (abs(x1-x0)&gt;=1.0e-1) &amp;&amp; (Secantn&lt;=20)</span></span>
<span class="srcline"><span class="lineno"><a href="80,886" id="srcline886"> 886</a></span><span class="line">                    else</span></span>
<span class="srcline"><span class="lineno"><a href="80,887" id="srcline887"> 887</a></span><span class="line">                        xTemp = (x0+x1)/2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,888" id="srcline888"> 888</a></span><span class="line">                        xpositionTemp = (xpositionFr0+xpositionFr1)/2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,889" id="srcline889"> 889</a></span><span class="line">                        ThetaRTemp = (ThetaFr1+ThetaFr0)/2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,890" id="srcline890"> 890</a></span><span class="line">                        break;</span></span>
<span class="srcline"><span class="lineno"><a href="80,891" id="srcline891"> 891</a></span><span class="line">                    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,892" id="srcline892"> 892</a></span><span class="line">                    Secantn=Secantn+1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,893" id="srcline893"> 893</a></span><span class="line">                end</span></span>
<span class="srcline"><span class="lineno"><a href="80,894" id="srcline894"> 894</a></span><span class="line">                xres(4) = xTemp;</span></span>
<span class="srcline"><span class="lineno"><a href="80,895" id="srcline895"> 895</a></span><span class="line">                xposition(4) = xpositionTemp;</span></span>
<span class="srcline"><span class="lineno"><a href="80,896" id="srcline896"> 896</a></span><span class="line">                theta(4) = ThetaRTemp;</span></span>
<span class="srcline"><span class="lineno"><a href="80,897" id="srcline897"> 897</a></span><span class="line">            end</span></span>
<span class="srcline"><span class="lineno"><a href="80,898" id="srcline898"> 898</a></span><span class="line">      else</span></span>
<span class="srcline"><span class="lineno"><a href="80,899" id="srcline899"> 899</a></span><span class="line">            xres(4) = -255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,900" id="srcline900"> 900</a></span><span class="line">            xposition(4) = -255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,901" id="srcline901"> 901</a></span><span class="line">            theta(4) = -255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,902" id="srcline902"> 902</a></span><span class="line">      end    </span></span>
<span class="srcline"><span class="lineno"><a href="80,903" id="srcline903"> 903</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,904" id="srcline904"> 904</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,905" id="srcline905"> 905</a></span><span class="line">function Y1 = YcalFunc(X0,Y0,Angle0,X1)</span></span>
<span class="srcline"><span class="lineno"><a href="80,906" id="srcline906"> 906</a></span><span class="line">    if abs(sin(Angle0)) &gt; 0.98   </span></span>
<span class="srcline"><span class="lineno"><a href="80,907" id="srcline907"> 907</a></span><span class="line">        Y1 = Y0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,908" id="srcline908"> 908</a></span><span class="line">    else</span></span>
<span class="srcline"><span class="lineno"><a href="80,909" id="srcline909"> 909</a></span><span class="line">        Y1 = tan(Angle0)*(X1 - X0) + Y0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,910" id="srcline910"> 910</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,911" id="srcline911"> 911</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,912" id="srcline912"> 912</a></span><span class="line">function [xpositionFl,ypositionFl,Theta] = LaneChgFlPosCal2( Arc,angle_out,angle_in,x_in,y_in,x_out,y_out )</span></span>
<span class="srcline"><span class="lineno"><a href="80,913" id="srcline913"> 913</a></span><span class="line"><span class="comment">%UNTITLED3 Summary of this function goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,914" id="srcline914"> 914</a></span><span class="line"><span class="comment">%   Detailed explanation goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,915" id="srcline915"> 915</a></span><span class="line">    global DeltaTemp ArclengthTol</span></span>
<span class="srcline"><span class="lineno"><a href="80,916" id="srcline916"> 916</a></span><span class="line">    global x_qitemp y_qitemp theta_qitemp</span></span>
<span class="srcline"><span class="lineno"><a href="80,917" id="srcline917"> 917</a></span><span class="line">    global L_me W_me    </span></span>
<span class="srcline"><span class="lineno"><a href="80,918" id="srcline918"> 918</a></span><span class="line">    if Arc &lt;= 0</span></span>
<span class="srcline"><span class="lineno"><a href="80,919" id="srcline919"> 919</a></span><span class="line">        xposition = Arc * cos(angle_in) + x_in;</span></span>
<span class="srcline"><span class="lineno"><a href="80,920" id="srcline920"> 920</a></span><span class="line">        yposition = Arc * sin(angle_in) + y_in;</span></span>
<span class="srcline"><span class="lineno"><a href="80,921" id="srcline921"> 921</a></span><span class="line">        Theta = angle_in;</span></span>
<span class="srcline"><span class="lineno"><a href="80,922" id="srcline922"> 922</a></span><span class="line">    elseif (Arc &lt;= ArclengthTol(1))&amp;&amp;(Arc &gt; 0)</span></span>
<span class="srcline"><span class="lineno"><a href="80,923" id="srcline923"> 923</a></span><span class="line">        [xposition,yposition,Theta] = ElementaryPosCal( Arc,DeltaTemp(1),ArclengthTol(1),theta_qitemp,angle_in,x_in,y_in,x_qitemp,y_qitemp );</span></span>
<span class="srcline"><span class="lineno"><a href="80,924" id="srcline924"> 924</a></span><span class="line">    elseif (Arc &gt; ArclengthTol(1))&amp;&amp;(Arc &lt;= (ArclengthTol(1) + ArclengthTol(2)))</span></span>
<span class="srcline"><span class="lineno"><a href="80,925" id="srcline925"> 925</a></span><span class="line">        Arc = Arc - ArclengthTol(1);</span></span>
<span class="srcline"><span class="lineno"><a href="80,926" id="srcline926"> 926</a></span><span class="line">        [xposition,yposition,Theta] = ElementaryPosCal( Arc,DeltaTemp(2),ArclengthTol(2),angle_out,theta_qitemp,x_qitemp,y_qitemp,x_out,y_out );</span></span>
<span class="srcline"><span class="lineno"><a href="80,927" id="srcline927"> 927</a></span><span class="line">    else</span></span>
<span class="srcline"><span class="lineno"><a href="80,928" id="srcline928"> 928</a></span><span class="line">        xposition = Arc * cos(angle_out) + x_out;</span></span>
<span class="srcline"><span class="lineno"><a href="80,929" id="srcline929"> 929</a></span><span class="line">        yposition = Arc * sin(angle_out) + y_out;</span></span>
<span class="srcline"><span class="lineno"><a href="80,930" id="srcline930"> 930</a></span><span class="line">        Theta = angle_out;        </span></span>
<span class="srcline"><span class="lineno"><a href="80,931" id="srcline931"> 931</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,932" id="srcline932"> 932</a></span><span class="line">    xpositionFl = xposition + L_me * cos(Theta) - W_me * sin(Theta) / 2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,933" id="srcline933"> 933</a></span><span class="line">    ypositionFl = yposition + L_me * sin(Theta) + W_me * cos(Theta) / 2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,934" id="srcline934"> 934</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,935" id="srcline935"> 935</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,936" id="srcline936"> 936</a></span><span class="line">function [xpositionFr,ypositionFr,Theta] = LaneChgFrPosCal2( Arc,angle_out,angle_in,x_in,y_in,x_out,y_out )</span></span>
<span class="srcline"><span class="lineno"><a href="80,937" id="srcline937"> 937</a></span><span class="line"><span class="comment">%UNTITLED3 Summary of this function goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,938" id="srcline938"> 938</a></span><span class="line"><span class="comment">%   Detailed explanation goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,939" id="srcline939"> 939</a></span><span class="line">    global DeltaTemp ArclengthTol</span></span>
<span class="srcline"><span class="lineno"><a href="80,940" id="srcline940"> 940</a></span><span class="line">    global x_qitemp y_qitemp theta_qitemp</span></span>
<span class="srcline"><span class="lineno"><a href="80,941" id="srcline941"> 941</a></span><span class="line">    global L_me W_me    </span></span>
<span class="srcline"><span class="lineno"><a href="80,942" id="srcline942"> 942</a></span><span class="line">    if Arc &lt;= 0</span></span>
<span class="srcline"><span class="lineno"><a href="80,943" id="srcline943"> 943</a></span><span class="line">        xposition = Arc * cos(angle_in) + x_in;</span></span>
<span class="srcline"><span class="lineno"><a href="80,944" id="srcline944"> 944</a></span><span class="line">        yposition = Arc * sin(angle_in) + y_in;</span></span>
<span class="srcline"><span class="lineno"><a href="80,945" id="srcline945"> 945</a></span><span class="line">        Theta = angle_in;</span></span>
<span class="srcline"><span class="lineno"><a href="80,946" id="srcline946"> 946</a></span><span class="line">    elseif (Arc &lt;= ArclengthTol(1))&amp;&amp;(Arc &gt; 0)</span></span>
<span class="srcline"><span class="lineno"><a href="80,947" id="srcline947"> 947</a></span><span class="line">        [xposition,yposition,Theta] = ElementaryPosCal( Arc,DeltaTemp(1),ArclengthTol(1),theta_qitemp,angle_in,x_in,y_in,x_qitemp,y_qitemp );</span></span>
<span class="srcline"><span class="lineno"><a href="80,948" id="srcline948"> 948</a></span><span class="line">    elseif (Arc &gt; ArclengthTol(1))&amp;&amp;(Arc &lt;= (ArclengthTol(1) + ArclengthTol(2)))</span></span>
<span class="srcline"><span class="lineno"><a href="80,949" id="srcline949"> 949</a></span><span class="line">        Arc = Arc - ArclengthTol(1);</span></span>
<span class="srcline"><span class="lineno"><a href="80,950" id="srcline950"> 950</a></span><span class="line">        [xposition,yposition,Theta] = ElementaryPosCal( Arc,DeltaTemp(2),ArclengthTol(2),angle_out,theta_qitemp,x_qitemp,y_qitemp,x_out,y_out );</span></span>
<span class="srcline"><span class="lineno"><a href="80,951" id="srcline951"> 951</a></span><span class="line">    else</span></span>
<span class="srcline"><span class="lineno"><a href="80,952" id="srcline952"> 952</a></span><span class="line">        xposition = Arc * cos(angle_out) + x_out;</span></span>
<span class="srcline"><span class="lineno"><a href="80,953" id="srcline953"> 953</a></span><span class="line">        yposition = Arc * sin(angle_out) + y_out;</span></span>
<span class="srcline"><span class="lineno"><a href="80,954" id="srcline954"> 954</a></span><span class="line">        Theta = angle_out;        </span></span>
<span class="srcline"><span class="lineno"><a href="80,955" id="srcline955"> 955</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,956" id="srcline956"> 956</a></span><span class="line">    xpositionFr = xposition + L_me * cos(Theta) + W_me * sin(Theta) / 2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,957" id="srcline957"> 957</a></span><span class="line">    ypositionFr = yposition + L_me * sin(Theta) - W_me * cos(Theta) / 2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,958" id="srcline958"> 958</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,959" id="srcline959"> 959</a></span><span class="line">function [xpositionRr,ypositionRr,Theta] = LaneChgRrPosCal2( Arc,angle_out,angle_in,x_in,y_in,x_out,y_out )</span></span>
<span class="srcline"><span class="lineno"><a href="80,960" id="srcline960"> 960</a></span><span class="line"><span class="comment">%UNTITLED3 Summary of this function goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,961" id="srcline961"> 961</a></span><span class="line"><span class="comment">%   Detailed explanation goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,962" id="srcline962"> 962</a></span><span class="line">    global DeltaTemp ArclengthTol</span></span>
<span class="srcline"><span class="lineno"><a href="80,963" id="srcline963"> 963</a></span><span class="line">    global x_qitemp y_qitemp theta_qitemp</span></span>
<span class="srcline"><span class="lineno"><a href="80,964" id="srcline964"> 964</a></span><span class="line">    global L_me W_me</span></span>
<span class="srcline"><span class="lineno"><a href="80,965" id="srcline965"> 965</a></span><span class="line">    if Arc &lt;= 0</span></span>
<span class="srcline"><span class="lineno"><a href="80,966" id="srcline966"> 966</a></span><span class="line">        xposition = Arc * cos(angle_in) + x_in;</span></span>
<span class="srcline"><span class="lineno"><a href="80,967" id="srcline967"> 967</a></span><span class="line">        yposition = Arc * sin(angle_in) + y_in;</span></span>
<span class="srcline"><span class="lineno"><a href="80,968" id="srcline968"> 968</a></span><span class="line">        Theta = angle_in;</span></span>
<span class="srcline"><span class="lineno"><a href="80,969" id="srcline969"> 969</a></span><span class="line">    elseif (Arc &lt;= ArclengthTol(1))&amp;&amp;(Arc &gt; 0)</span></span>
<span class="srcline"><span class="lineno"><a href="80,970" id="srcline970"> 970</a></span><span class="line">        [xposition,yposition,Theta] = ElementaryPosCal( Arc,DeltaTemp(1),ArclengthTol(1),theta_qitemp,angle_in,x_in,y_in,x_qitemp,y_qitemp );</span></span>
<span class="srcline"><span class="lineno"><a href="80,971" id="srcline971"> 971</a></span><span class="line">    elseif (Arc &gt; ArclengthTol(1))&amp;&amp;(Arc &lt;= (ArclengthTol(1) + ArclengthTol(2)))</span></span>
<span class="srcline"><span class="lineno"><a href="80,972" id="srcline972"> 972</a></span><span class="line">        Arc = Arc - ArclengthTol(1);</span></span>
<span class="srcline"><span class="lineno"><a href="80,973" id="srcline973"> 973</a></span><span class="line">        [xposition,yposition,Theta] = ElementaryPosCal( Arc,DeltaTemp(2),ArclengthTol(2),angle_out,theta_qitemp,x_qitemp,y_qitemp,x_out,y_out );</span></span>
<span class="srcline"><span class="lineno"><a href="80,974" id="srcline974"> 974</a></span><span class="line">    else</span></span>
<span class="srcline"><span class="lineno"><a href="80,975" id="srcline975"> 975</a></span><span class="line">        xposition = Arc * cos(angle_out) + x_out;</span></span>
<span class="srcline"><span class="lineno"><a href="80,976" id="srcline976"> 976</a></span><span class="line">        yposition = Arc * sin(angle_out) + y_out;</span></span>
<span class="srcline"><span class="lineno"><a href="80,977" id="srcline977"> 977</a></span><span class="line">        Theta = angle_out;</span></span>
<span class="srcline"><span class="lineno"><a href="80,978" id="srcline978"> 978</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,979" id="srcline979"> 979</a></span><span class="line">    xpositionRr = xposition + W_me * sin(Theta) / 2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,980" id="srcline980"> 980</a></span><span class="line">    ypositionRr = yposition - W_me * cos(Theta) / 2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,981" id="srcline981"> 981</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,982" id="srcline982"> 982</a></span><span class="line">function [xpositionRl,ypositionRl,Theta] = LaneChgRlPosCal2( Arc,angle_out,angle_in,x_in,y_in,x_out,y_out )</span></span>
<span class="srcline"><span class="lineno"><a href="80,983" id="srcline983"> 983</a></span><span class="line"><span class="comment">%UNTITLED3 Summary of this function goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,984" id="srcline984"> 984</a></span><span class="line"><span class="comment">%   Detailed explanation goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,985" id="srcline985"> 985</a></span><span class="line">    global DeltaTemp ArclengthTol</span></span>
<span class="srcline"><span class="lineno"><a href="80,986" id="srcline986"> 986</a></span><span class="line">    global x_qitemp y_qitemp theta_qitemp</span></span>
<span class="srcline"><span class="lineno"><a href="80,987" id="srcline987"> 987</a></span><span class="line">    global L_me W_me</span></span>
<span class="srcline"><span class="lineno"><a href="80,988" id="srcline988"> 988</a></span><span class="line">    if Arc &lt;= 0</span></span>
<span class="srcline"><span class="lineno"><a href="80,989" id="srcline989"> 989</a></span><span class="line">        xposition = Arc * cos(angle_in) + x_in;</span></span>
<span class="srcline"><span class="lineno"><a href="80,990" id="srcline990"> 990</a></span><span class="line">        yposition = Arc * sin(angle_in) + y_in;</span></span>
<span class="srcline"><span class="lineno"><a href="80,991" id="srcline991"> 991</a></span><span class="line">        Theta = angle_in;</span></span>
<span class="srcline"><span class="lineno"><a href="80,992" id="srcline992"> 992</a></span><span class="line">    elseif (Arc &lt;= ArclengthTol(1))&amp;&amp;(Arc &gt; 0)</span></span>
<span class="srcline"><span class="lineno"><a href="80,993" id="srcline993"> 993</a></span><span class="line">        [xposition,yposition,Theta] = ElementaryPosCal( Arc,DeltaTemp(1),ArclengthTol(1),theta_qitemp,angle_in,x_in,y_in,x_qitemp,y_qitemp );</span></span>
<span class="srcline"><span class="lineno"><a href="80,994" id="srcline994"> 994</a></span><span class="line">    elseif (Arc &gt; ArclengthTol(1))&amp;&amp;(Arc &lt;= (ArclengthTol(1) + ArclengthTol(2)))</span></span>
<span class="srcline"><span class="lineno"><a href="80,995" id="srcline995"> 995</a></span><span class="line">        Arc = Arc - ArclengthTol(1);</span></span>
<span class="srcline"><span class="lineno"><a href="80,996" id="srcline996"> 996</a></span><span class="line">        [xposition,yposition,Theta] = ElementaryPosCal( Arc,DeltaTemp(2),ArclengthTol(2),angle_out,theta_qitemp,x_qitemp,y_qitemp,x_out,y_out );</span></span>
<span class="srcline"><span class="lineno"><a href="80,997" id="srcline997"> 997</a></span><span class="line">    else</span></span>
<span class="srcline"><span class="lineno"><a href="80,998" id="srcline998"> 998</a></span><span class="line">        xposition = Arc * cos(angle_out) + x_out;</span></span>
<span class="srcline"><span class="lineno"><a href="80,999" id="srcline999"> 999</a></span><span class="line">        yposition = Arc * sin(angle_out) + y_out;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1000" id="srcline1000">1000</a></span><span class="line">        Theta = angle_out;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1001" id="srcline1001">1001</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1002" id="srcline1002">1002</a></span><span class="line">    xpositionRl = xposition - W_me * sin(Theta) / 2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1003" id="srcline1003">1003</a></span><span class="line">    ypositionRl = yposition + W_me * cos(Theta) / 2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1004" id="srcline1004">1004</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1005" id="srcline1005">1005</a></span><span class="line">function [xposition,yposition,Theta] = ElementaryPosCal( Arc,Delta,Arclength,angle_out,angle_in,x_in,y_in,x_out,y_out )</span></span>
<span class="srcline"><span class="lineno"><a href="80,1006" id="srcline1006">1006</a></span><span class="line"><span class="comment">%UNTITLED Summary of this function goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1007" id="srcline1007">1007</a></span><span class="line"><span class="comment">%   Detailed explanation goes here   </span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1008" id="srcline1008">1008</a></span><span class="line">    Beta = (angle_out - angle_in)/2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1009" id="srcline1009">1009</a></span><span class="line">    theta_rot = angle_in;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1010" id="srcline1010">1010</a></span><span class="line">    x_outRot = (x_out - x_in)*cos(theta_rot) + (y_out - y_in)*sin(theta_rot);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1011" id="srcline1011">1011</a></span><span class="line">    y_outRot = (y_out - y_in)*cos(theta_rot) - (x_out - x_in)*sin(theta_rot);    </span></span>
<span class="srcline"><span class="lineno"><a href="80,1012" id="srcline1012">1012</a></span><span class="line">    if Beta == 0</span></span>
<span class="srcline"><span class="lineno"><a href="80,1013" id="srcline1013">1013</a></span><span class="line">        SignBeta = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1014" id="srcline1014">1014</a></span><span class="line">    else</span></span>
<span class="srcline"><span class="lineno"><a href="80,1015" id="srcline1015">1015</a></span><span class="line">        SignBeta = sign(Beta);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1016" id="srcline1016">1016</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1017" id="srcline1017">1017</a></span><span class="line">    if Arc &lt; Arclength/2    </span></span>
<span class="srcline"><span class="lineno"><a href="80,1018" id="srcline1018">1018</a></span><span class="line">        ulimit = Arc * sqrt(abs( Delta )/2);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1019" id="srcline1019">1019</a></span><span class="line">        Theta = Delta * (Arc)^2/2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1020" id="srcline1020">1020</a></span><span class="line">        xpositionTemp = sqrt(2/abs(Delta))*quadcosu2(ulimit);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1021" id="srcline1021">1021</a></span><span class="line">        ypositionTemp = sqrt(2/abs(Delta))*quadsinu2(ulimit) * SignBeta;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1022" id="srcline1022">1022</a></span><span class="line">    else</span></span>
<span class="srcline"><span class="lineno"><a href="80,1023" id="srcline1023">1023</a></span><span class="line">        ulimit = (Arclength - Arc) * sqrt(abs(Delta)/2); </span></span>
<span class="srcline"><span class="lineno"><a href="80,1024" id="srcline1024">1024</a></span><span class="line">        <span class="comment">%Theta = 2*Beta*SignBeta - Delta * (Arclength - Arc)^2/2; </span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1025" id="srcline1025">1025</a></span><span class="line">        xpositionMirrTemp = sqrt(2/abs(Delta))*quadcosu2(ulimit);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1026" id="srcline1026">1026</a></span><span class="line">        ypositionMirrTemp = sqrt(2/abs(Delta))*quadsinu2(ulimit) * SignBeta;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1027" id="srcline1027">1027</a></span><span class="line">        <span class="comment">%mirror line Ax+By+C=0</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1028" id="srcline1028">1028</a></span><span class="line">        x_mirr = (x_outRot)/2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1029" id="srcline1029">1029</a></span><span class="line">        y_mirr = (y_outRot)/2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1030" id="srcline1030">1030</a></span><span class="line">        angle_mirr = pi/2 + atan((y_outRot)/(x_outRot));</span></span>
<span class="srcline"><span class="lineno"><a href="80,1031" id="srcline1031">1031</a></span><span class="line">        A = tan(angle_mirr);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1032" id="srcline1032">1032</a></span><span class="line">        B = -1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1033" id="srcline1033">1033</a></span><span class="line">        C = y_mirr - A * x_mirr;      </span></span>
<span class="srcline"><span class="lineno"><a href="80,1034" id="srcline1034">1034</a></span><span class="line">        <span class="comment">%two points are symmetrical to the Ax+By+C we just defined</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1035" id="srcline1035">1035</a></span><span class="line">        xpositionTemp = xpositionMirrTemp - 2*A*(A*xpositionMirrTemp+B*ypositionMirrTemp+C)/(A^2+B^2);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1036" id="srcline1036">1036</a></span><span class="line">        ypositionTemp = ypositionMirrTemp - 2*B*(A*xpositionMirrTemp+B*ypositionMirrTemp+C)/(A^2+B^2);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1037" id="srcline1037">1037</a></span><span class="line">        Theta = 2*abs(Beta)*SignBeta - Delta * (Arclength - Arc)^2/2;          </span></span>
<span class="srcline"><span class="lineno"><a href="80,1038" id="srcline1038">1038</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1039" id="srcline1039">1039</a></span><span class="line">    theta_rot = - angle_in;   </span></span>
<span class="srcline"><span class="lineno"><a href="80,1040" id="srcline1040">1040</a></span><span class="line">    xposition = xpositionTemp*cos(theta_rot) + ypositionTemp*sin(theta_rot);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1041" id="srcline1041">1041</a></span><span class="line">    yposition = ypositionTemp*cos(theta_rot) - xpositionTemp*sin(theta_rot) ;  </span></span>
<span class="srcline"><span class="lineno"><a href="80,1042" id="srcline1042">1042</a></span><span class="line">    xposition = xposition + x_in;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1043" id="srcline1043">1043</a></span><span class="line">    yposition = yposition + y_in;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1044" id="srcline1044">1044</a></span><span class="line">    Theta = Theta + angle_in;    </span></span>
<span class="srcline"><span class="lineno"><a href="80,1045" id="srcline1045">1045</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1046" id="srcline1046">1046</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1047" id="srcline1047">1047</a></span><span class="line">function [ x_qi,y_qi,theta_qi ] = qiConfigCal( x_in,y_in,angle_in,x_out,y_out,angle_out )</span></span>
<span class="srcline"><span class="lineno"><a href="80,1048" id="srcline1048">1048</a></span><span class="line"><span class="comment">%UNTITLED2 Summary of this function goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1049" id="srcline1049">1049</a></span><span class="line"><span class="comment">%   Detailed explanation goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1050" id="srcline1050">1050</a></span><span class="line">    kesi_en = angle_out - angle_in;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1051" id="srcline1051">1051</a></span><span class="line">    r_en = sqrt((x_in-x_out)^2+(y_in-y_out)^2);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1052" id="srcline1052">1052</a></span><span class="line">    k_qi_en = 2 * sin(kesi_en/2)/r_en;    </span></span>
<span class="srcline"><span class="lineno"><a href="80,1053" id="srcline1053">1053</a></span><span class="line">    if k_qi_en == 0</span></span>
<span class="srcline"><span class="lineno"><a href="80,1054" id="srcline1054">1054</a></span><span class="line">        x_qi = (x_in + x_out)/2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1055" id="srcline1055">1055</a></span><span class="line">        y_qi = (y_in + y_out)/2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1056" id="srcline1056">1056</a></span><span class="line">        theta_qi = asin((y_out - y_in)/r_en) * 2 + (angle_in + angle_out)/2;        </span></span>
<span class="srcline"><span class="lineno"><a href="80,1057" id="srcline1057">1057</a></span><span class="line">    else</span></span>
<span class="srcline"><span class="lineno"><a href="80,1058" id="srcline1058">1058</a></span><span class="line">        r_qi_en = abs(1/k_qi_en);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1059" id="srcline1059">1059</a></span><span class="line">        angle_qi_CC = 2* asin(r_en*k_qi_en/2);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1060" id="srcline1060">1060</a></span><span class="line">        alpha_en = atan((y_out-y_in)/(x_out-x_in));</span></span>
<span class="srcline"><span class="lineno"><a href="80,1061" id="srcline1061">1061</a></span><span class="line">        if (x_out &lt; x_in)</span></span>
<span class="srcline"><span class="lineno"><a href="80,1062" id="srcline1062">1062</a></span><span class="line">            alpha_en = alpha_en + pi;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1063" id="srcline1063">1063</a></span><span class="line">        elseif angle_in &gt; pi</span></span>
<span class="srcline"><span class="lineno"><a href="80,1064" id="srcline1064">1064</a></span><span class="line">            alpha_en = alpha_en + pi*2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1065" id="srcline1065">1065</a></span><span class="line">        end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1066" id="srcline1066">1066</a></span><span class="line">        if alpha_en &gt; 1e-5</span></span>
<span class="srcline"><span class="lineno"><a href="80,1067" id="srcline1067">1067</a></span><span class="line">            while alpha_en &gt; 2*pi</span></span>
<span class="srcline"><span class="lineno"><a href="80,1068" id="srcline1068">1068</a></span><span class="line">                alpha_en = alpha_en - 2 * pi;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1069" id="srcline1069">1069</a></span><span class="line">            end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1070" id="srcline1070">1070</a></span><span class="line">        else</span></span>
<span class="srcline"><span class="lineno"><a href="80,1071" id="srcline1071">1071</a></span><span class="line">            while alpha_en &lt; -2*pi</span></span>
<span class="srcline"><span class="lineno"><a href="80,1072" id="srcline1072">1072</a></span><span class="line">                alpha_en = alpha_en + 2*pi;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1073" id="srcline1073">1073</a></span><span class="line">            end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1074" id="srcline1074">1074</a></span><span class="line">        end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1075" id="srcline1075">1075</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1076" id="srcline1076">1076</a></span><span class="line">        angle_qi = angle_qi_CC/2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1077" id="srcline1077">1077</a></span><span class="line">        if k_qi_en == 0</span></span>
<span class="srcline"><span class="lineno"><a href="80,1078" id="srcline1078">1078</a></span><span class="line">            signK = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1079" id="srcline1079">1079</a></span><span class="line">        else</span></span>
<span class="srcline"><span class="lineno"><a href="80,1080" id="srcline1080">1080</a></span><span class="line">            signK = sign(k_qi_en);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1081" id="srcline1081">1081</a></span><span class="line">        end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1082" id="srcline1082">1082</a></span><span class="line">        a = r_qi_en * cos(-angle_qi_CC/2+angle_qi)-sqrt(r_qi_en^2-r_en^2/4);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1083" id="srcline1083">1083</a></span><span class="line">        b = r_qi_en * sin(-angle_qi_CC/2+angle_qi);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1084" id="srcline1084">1084</a></span><span class="line">        x_qi = a * sin(alpha_en) * signK - b * cos(alpha_en) * signK + (x_in + x_out) / 2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1085" id="srcline1085">1085</a></span><span class="line">        y_qi = - a * cos(alpha_en) * signK - b * sin(alpha_en) * signK + (y_in + y_out) / 2 ; </span></span>
<span class="srcline"><span class="lineno"><a href="80,1086" id="srcline1086">1086</a></span><span class="line">        theta_qi = - ( angle_in +angle_out )/2 + 2 * alpha_en;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1087" id="srcline1087">1087</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1088" id="srcline1088">1088</a></span><span class="line">    if theta_qi &gt; 1e-5</span></span>
<span class="srcline"><span class="lineno"><a href="80,1089" id="srcline1089">1089</a></span><span class="line">        while theta_qi &gt; 2*pi</span></span>
<span class="srcline"><span class="lineno"><a href="80,1090" id="srcline1090">1090</a></span><span class="line">            theta_qi = theta_qi - 2 * pi;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1091" id="srcline1091">1091</a></span><span class="line">        end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1092" id="srcline1092">1092</a></span><span class="line">    else</span></span>
<span class="srcline"><span class="lineno"><a href="80,1093" id="srcline1093">1093</a></span><span class="line">        while theta_qi &lt; -2*pi</span></span>
<span class="srcline"><span class="lineno"><a href="80,1094" id="srcline1094">1094</a></span><span class="line">            theta_qi = theta_qi + 2*pi;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1095" id="srcline1095">1095</a></span><span class="line">        end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1096" id="srcline1096">1096</a></span><span class="line">    end       </span></span>
<span class="srcline"><span class="lineno"><a href="80,1097" id="srcline1097">1097</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1098" id="srcline1098">1098</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1099" id="srcline1099">1099</a></span><span class="line">function [Delta,k_localmax,Arclength] = ElementaryPathPlot( x_in,y_in,angle_in,x_out,y_out,angle_out )</span></span>
<span class="srcline"><span class="lineno"><a href="80,1100" id="srcline1100">1100</a></span><span class="line">    <span class="comment">%UNTITLED2 Summary of this function goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1101" id="srcline1101">1101</a></span><span class="line">    <span class="comment">%   Detailed explanation goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1102" id="srcline1102">1102</a></span><span class="line">    Nlen = 20;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1103" id="srcline1103">1103</a></span><span class="line">    xposition = zeros(Nlen,1);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1104" id="srcline1104">1104</a></span><span class="line">    yposition = zeros(Nlen,1);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1105" id="srcline1105">1105</a></span><span class="line">    Theta = zeros(Nlen,1);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1106" id="srcline1106">1106</a></span><span class="line">    kur = zeros(Nlen,1);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1107" id="srcline1107">1107</a></span><span class="line">    <span class="comment">%ArcPos = zeros(Nlen,1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1108" id="srcline1108">1108</a></span><span class="line">    Beta = (angle_out - angle_in)/2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1109" id="srcline1109">1109</a></span><span class="line">    r = sqrt((x_in-x_out)^2+(y_in-y_out)^2);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1110" id="srcline1110">1110</a></span><span class="line">    <span class="comment">%Move</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1111" id="srcline1111">1111</a></span><span class="line">    x_inMove = x_in - x_in;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1112" id="srcline1112">1112</a></span><span class="line">    y_inMove = y_in - y_in;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1113" id="srcline1113">1113</a></span><span class="line">    x_outMove = x_out - x_in;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1114" id="srcline1114">1114</a></span><span class="line">    y_outMove = y_out - y_in;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1115" id="srcline1115">1115</a></span><span class="line">    <span class="comment">%Rotate</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1116" id="srcline1116">1116</a></span><span class="line">    theta_rot = angle_in;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1117" id="srcline1117">1117</a></span><span class="line">    x_inRot = x_inMove*cos(theta_rot) + y_inMove*sin(theta_rot);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1118" id="srcline1118">1118</a></span><span class="line">    x_outRot = x_outMove*cos(theta_rot) + y_outMove*sin(theta_rot);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1119" id="srcline1119">1119</a></span><span class="line">    y_inRot = y_inMove*cos(theta_rot) - x_inMove*sin(theta_rot);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1120" id="srcline1120">1120</a></span><span class="line">    y_outRot = y_outMove*cos(theta_rot) - x_outMove*sin(theta_rot);    </span></span>
<span class="srcline"><span class="lineno"><a href="80,1121" id="srcline1121">1121</a></span><span class="line">    SignBeta = sign(Beta);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1122" id="srcline1122">1122</a></span><span class="line">    Beta = abs(Beta);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1123" id="srcline1123">1123</a></span><span class="line">    ulimit = sqrt(Beta);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1124" id="srcline1124">1124</a></span><span class="line">    D_BetaVal = sin(Beta)*quadsinu2(ulimit)+cos(Beta)*quadcosu2(ulimit);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1125" id="srcline1125">1125</a></span><span class="line">    Delta = 8*SignBeta*D_BetaVal^2/r^2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1126" id="srcline1126">1126</a></span><span class="line">    <span class="comment">%longth of the trajectary     </span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1127" id="srcline1127">1127</a></span><span class="line">    Arclength = 2*sqrt(2*abs(Beta/Delta*SignBeta));</span></span>
<span class="srcline"><span class="lineno"><a href="80,1128" id="srcline1128">1128</a></span><span class="line">    k_localmax = Delta * Arclength/2;    </span></span>
<span class="srcline"><span class="lineno"><a href="80,1129" id="srcline1129">1129</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1130" id="srcline1130">1130</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1131" id="srcline1131">1131</a></span><span class="line">function quadcosu2val = quadcosu2( ulimit )</span></span>
<span class="srcline"><span class="lineno"><a href="80,1132" id="srcline1132">1132</a></span><span class="line">    <span class="comment">%UNTITLED4 Summary of this function goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1133" id="srcline1133">1133</a></span><span class="line">    <span class="comment">%   Detailed explanation goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1134" id="srcline1134">1134</a></span><span class="line">    <span class="comment">% this function is used to calculate the integral of cos(x^2),which is used</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1135" id="srcline1135">1135</a></span><span class="line">    <span class="comment">% to calculate x position</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1136" id="srcline1136">1136</a></span><span class="line">    global quadcosu2tbl</span></span>
<span class="srcline"><span class="lineno"><a href="80,1137" id="srcline1137">1137</a></span><span class="line">    index = fix(ulimit/0.005) + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1138" id="srcline1138">1138</a></span><span class="line">    quadcosu2val = quadcosu2tbl(index);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1139" id="srcline1139">1139</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1140" id="srcline1140">1140</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1141" id="srcline1141">1141</a></span><span class="line">function quadsinu2val = quadsinu2( ulimit )</span></span>
<span class="srcline"><span class="lineno"><a href="80,1142" id="srcline1142">1142</a></span><span class="line"><span class="comment">%UNTITLED4 Summary of this function goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1143" id="srcline1143">1143</a></span><span class="line"><span class="comment">%   Detailed explanation goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1144" id="srcline1144">1144</a></span><span class="line"><span class="comment">% this function is used to calculate the integral of sin(x^2),which is used</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1145" id="srcline1145">1145</a></span><span class="line"><span class="comment">% to calculate y position</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1146" id="srcline1146">1146</a></span><span class="line">    global quadsinu2tbl </span></span>
<span class="srcline"><span class="lineno"><a href="80,1147" id="srcline1147">1147</a></span><span class="line">    index = fix(ulimit/0.005) + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1148" id="srcline1148">1148</a></span><span class="line">    quadsinu2val = quadsinu2tbl(index);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1149" id="srcline1149">1149</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1150" id="srcline1150">1150</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1151" id="srcline1151">1151</a></span><span class="line">function MSS = MSSFdJudgment( V_tar,V_me,V_obj,T_long,Tc,T_lat,T_adj )</span></span>
<span class="srcline"><span class="lineno"><a href="80,1152" id="srcline1152">1152</a></span><span class="line"><span class="comment">%UNTITLED5 Summary of this function goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1153" id="srcline1153">1153</a></span><span class="line"><span class="comment">%   Detailed explanation goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1154" id="srcline1154">1154</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="80,1155" id="srcline1155">1155</a></span><span class="line">    if abs(V_me-V_tar)&lt;1e-5</span></span>
<span class="srcline"><span class="lineno"><a href="80,1156" id="srcline1156">1156</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="80,1157" id="srcline1157">1157</a></span><span class="line">        if V_me&gt;V_obj</span></span>
<span class="srcline"><span class="lineno"><a href="80,1158" id="srcline1158">1158</a></span><span class="line">            MSS = (-V_me+V_obj)*(Tc+T_adj);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1159" id="srcline1159">1159</a></span><span class="line">        else</span></span>
<span class="srcline"><span class="lineno"><a href="80,1160" id="srcline1160">1160</a></span><span class="line">            MSS = (-V_me+V_obj)*(T_adj+T_lat);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1161" id="srcline1161">1161</a></span><span class="line">        end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1162" id="srcline1162">1162</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="80,1163" id="srcline1163">1163</a></span><span class="line">    else</span></span>
<span class="srcline"><span class="lineno"><a href="80,1164" id="srcline1164">1164</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1165" id="srcline1165">1165</a></span><span class="line">        T_max = (V_obj - V_me)/(V_tar - V_me)*T_long;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1166" id="srcline1166">1166</a></span><span class="line">        MSSTemp1 = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1167" id="srcline1167">1167</a></span><span class="line">        MSSTemp2 = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1168" id="srcline1168">1168</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1169" id="srcline1169">1169</a></span><span class="line">        if Tc &lt; T_long</span></span>
<span class="srcline"><span class="lineno"><a href="80,1170" id="srcline1170">1170</a></span><span class="line">            if (V_obj &gt;= V_tar)&amp;&amp;(V_tar &gt;V_me)</span></span>
<span class="srcline"><span class="lineno"><a href="80,1171" id="srcline1171">1171</a></span><span class="line">                MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,T_lat,0 ,T_adj);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1172" id="srcline1172">1172</a></span><span class="line">            elseif (V_obj &gt;= V_me)&amp;&amp;(V_me &gt; V_tar)</span></span>
<span class="srcline"><span class="lineno"><a href="80,1173" id="srcline1173">1173</a></span><span class="line">                MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,T_lat,0 ,T_adj);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1174" id="srcline1174">1174</a></span><span class="line">            elseif (V_me &gt;= V_obj)&amp;&amp;(V_obj &gt;= V_tar)</span></span>
<span class="srcline"><span class="lineno"><a href="80,1175" id="srcline1175">1175</a></span><span class="line">                if Tc &gt; T_max</span></span>
<span class="srcline"><span class="lineno"><a href="80,1176" id="srcline1176">1176</a></span><span class="line">                    MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,T_lat,0 ,T_adj);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1177" id="srcline1177">1177</a></span><span class="line">                else</span></span>
<span class="srcline"><span class="lineno"><a href="80,1178" id="srcline1178">1178</a></span><span class="line">                    MSSTemp1 = MSSCalculate( V_tar,V_me,V_obj,T_long,T_lat,0 ,T_adj);  </span></span>
<span class="srcline"><span class="lineno"><a href="80,1179" id="srcline1179">1179</a></span><span class="line">                    MSSTemp2 = MSSCalculate( V_tar,V_me,V_obj,T_long,Tc,0 ,T_adj);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1180" id="srcline1180">1180</a></span><span class="line">                    MSS = max(MSSTemp1,MSSTemp2);           </span></span>
<span class="srcline"><span class="lineno"><a href="80,1181" id="srcline1181">1181</a></span><span class="line">                end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1182" id="srcline1182">1182</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1183" id="srcline1183">1183</a></span><span class="line">            elseif (V_obj &lt;= V_tar)&amp;&amp;(V_tar &lt; V_me)</span></span>
<span class="srcline"><span class="lineno"><a href="80,1184" id="srcline1184">1184</a></span><span class="line">                MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,Tc,0 ,T_adj);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1185" id="srcline1185">1185</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1186" id="srcline1186">1186</a></span><span class="line">            elseif (V_obj &lt;= V_me)&amp;&amp;(V_me &lt; V_tar)</span></span>
<span class="srcline"><span class="lineno"><a href="80,1187" id="srcline1187">1187</a></span><span class="line">                MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,Tc,0 ,T_adj);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1188" id="srcline1188">1188</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1189" id="srcline1189">1189</a></span><span class="line">            elseif (V_me &lt;= V_obj)&amp;&amp;(V_obj &lt;= V_tar)</span></span>
<span class="srcline"><span class="lineno"><a href="80,1190" id="srcline1190">1190</a></span><span class="line">                if Tc &gt; T_max</span></span>
<span class="srcline"><span class="lineno"><a href="80,1191" id="srcline1191">1191</a></span><span class="line">                    MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,Tc,0 ,T_adj);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1192" id="srcline1192">1192</a></span><span class="line">                else </span></span>
<span class="srcline"><span class="lineno"><a href="80,1193" id="srcline1193">1193</a></span><span class="line">                    MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,T_max,0 ,T_adj);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1194" id="srcline1194">1194</a></span><span class="line">                end            </span></span>
<span class="srcline"><span class="lineno"><a href="80,1195" id="srcline1195">1195</a></span><span class="line">            else</span></span>
<span class="srcline"><span class="lineno"><a href="80,1196" id="srcline1196">1196</a></span><span class="line">                <span class="comment">%Nothing</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1197" id="srcline1197">1197</a></span><span class="line">                MSS = 255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1198" id="srcline1198">1198</a></span><span class="line">            end    </span></span>
<span class="srcline"><span class="lineno"><a href="80,1199" id="srcline1199">1199</a></span><span class="line">        else</span></span>
<span class="srcline"><span class="lineno"><a href="80,1200" id="srcline1200">1200</a></span><span class="line">            <span class="comment">% Tc &gt; T_long</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1201" id="srcline1201">1201</a></span><span class="line">            if  V_tar &gt; V_obj</span></span>
<span class="srcline"><span class="lineno"><a href="80,1202" id="srcline1202">1202</a></span><span class="line">                MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,Tc,0 ,T_adj);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1203" id="srcline1203">1203</a></span><span class="line">            else</span></span>
<span class="srcline"><span class="lineno"><a href="80,1204" id="srcline1204">1204</a></span><span class="line">                MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,T_lat,0 ,T_adj);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1205" id="srcline1205">1205</a></span><span class="line">            end  </span></span>
<span class="srcline"><span class="lineno"><a href="80,1206" id="srcline1206">1206</a></span><span class="line">        end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1207" id="srcline1207">1207</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1208" id="srcline1208">1208</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="80,1209" id="srcline1209">1209</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1210" id="srcline1210">1210</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1211" id="srcline1211">1211</a></span><span class="line">function MSS = MSSFoJudgment( V_tar,V_me,V_obj,T_long,Tc,T_lat,T_adj )</span></span>
<span class="srcline"><span class="lineno"><a href="80,1212" id="srcline1212">1212</a></span><span class="line"><span class="comment">%UNTITLED5 Summary of this function goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1213" id="srcline1213">1213</a></span><span class="line"><span class="comment">%   Detailed explanation goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1214" id="srcline1214">1214</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1215" id="srcline1215">1215</a></span><span class="line">    if abs(V_me-V_tar)&lt;1e-5</span></span>
<span class="srcline"><span class="lineno"><a href="80,1216" id="srcline1216">1216</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1217" id="srcline1217">1217</a></span><span class="line">        if V_me&gt;V_obj</span></span>
<span class="srcline"><span class="lineno"><a href="80,1218" id="srcline1218">1218</a></span><span class="line">            MSS = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1219" id="srcline1219">1219</a></span><span class="line">        else</span></span>
<span class="srcline"><span class="lineno"><a href="80,1220" id="srcline1220">1220</a></span><span class="line">            MSS = (-V_me+V_obj)*(T_adj+Tc);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1221" id="srcline1221">1221</a></span><span class="line">        end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1222" id="srcline1222">1222</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1223" id="srcline1223">1223</a></span><span class="line">    else</span></span>
<span class="srcline"><span class="lineno"><a href="80,1224" id="srcline1224">1224</a></span><span class="line">        T_max = (V_obj - V_me)/(V_tar - V_me)*T_long;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1225" id="srcline1225">1225</a></span><span class="line">        MSSTemp1 = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1226" id="srcline1226">1226</a></span><span class="line">        MSSTemp2 = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1227" id="srcline1227">1227</a></span><span class="line">        if Tc &lt; T_long</span></span>
<span class="srcline"><span class="lineno"><a href="80,1228" id="srcline1228">1228</a></span><span class="line">            if (V_obj &gt;= V_tar)&amp;&amp;(V_tar &gt;V_me)</span></span>
<span class="srcline"><span class="lineno"><a href="80,1229" id="srcline1229">1229</a></span><span class="line">                MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,Tc,0 ,T_adj);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1230" id="srcline1230">1230</a></span><span class="line">            elseif (V_obj &gt;= V_me)&amp;&amp;(V_me &gt;V_tar)</span></span>
<span class="srcline"><span class="lineno"><a href="80,1231" id="srcline1231">1231</a></span><span class="line">                MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,Tc,0 ,T_adj);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1232" id="srcline1232">1232</a></span><span class="line">            elseif (V_me &gt;= V_obj)&amp;&amp;(V_obj &gt;= V_tar)</span></span>
<span class="srcline"><span class="lineno"><a href="80,1233" id="srcline1233">1233</a></span><span class="line">                if Tc &gt; 2*T_max</span></span>
<span class="srcline"><span class="lineno"><a href="80,1234" id="srcline1234">1234</a></span><span class="line">                    MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,Tc,0 ,T_adj);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1235" id="srcline1235">1235</a></span><span class="line">                else</span></span>
<span class="srcline"><span class="lineno"><a href="80,1236" id="srcline1236">1236</a></span><span class="line">                    MSS = 0;           </span></span>
<span class="srcline"><span class="lineno"><a href="80,1237" id="srcline1237">1237</a></span><span class="line">                end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1238" id="srcline1238">1238</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1239" id="srcline1239">1239</a></span><span class="line">            elseif (V_obj &lt;= V_tar)&amp;&amp;(V_tar &lt; V_me)</span></span>
<span class="srcline"><span class="lineno"><a href="80,1240" id="srcline1240">1240</a></span><span class="line">                <span class="comment">%MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,0,0 );</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1241" id="srcline1241">1241</a></span><span class="line">                MSS = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1242" id="srcline1242">1242</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1243" id="srcline1243">1243</a></span><span class="line">            elseif (V_obj &lt;= V_me)&amp;&amp;(V_me &lt; V_tar)</span></span>
<span class="srcline"><span class="lineno"><a href="80,1244" id="srcline1244">1244</a></span><span class="line">                <span class="comment">%MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,0,0 );</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1245" id="srcline1245">1245</a></span><span class="line">                MSS = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1246" id="srcline1246">1246</a></span><span class="line">            elseif (V_me &lt;= V_obj)&amp;&amp;(V_obj &lt;= V_tar)</span></span>
<span class="srcline"><span class="lineno"><a href="80,1247" id="srcline1247">1247</a></span><span class="line">                if Tc &gt; T_max</span></span>
<span class="srcline"><span class="lineno"><a href="80,1248" id="srcline1248">1248</a></span><span class="line">                    MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,T_max,0 ,T_adj);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1249" id="srcline1249">1249</a></span><span class="line">                else </span></span>
<span class="srcline"><span class="lineno"><a href="80,1250" id="srcline1250">1250</a></span><span class="line">                    MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,Tc,0 ,T_adj);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1251" id="srcline1251">1251</a></span><span class="line">                end            </span></span>
<span class="srcline"><span class="lineno"><a href="80,1252" id="srcline1252">1252</a></span><span class="line">            else</span></span>
<span class="srcline"><span class="lineno"><a href="80,1253" id="srcline1253">1253</a></span><span class="line">                <span class="comment">%Nothing</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1254" id="srcline1254">1254</a></span><span class="line">                MSS = 255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1255" id="srcline1255">1255</a></span><span class="line">            end    </span></span>
<span class="srcline"><span class="lineno"><a href="80,1256" id="srcline1256">1256</a></span><span class="line">        else</span></span>
<span class="srcline"><span class="lineno"><a href="80,1257" id="srcline1257">1257</a></span><span class="line">            <span class="comment">% Tc &gt; T_long</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1258" id="srcline1258">1258</a></span><span class="line">            if (V_obj &gt;= V_tar)&amp;&amp;(V_tar &gt;V_me)</span></span>
<span class="srcline"><span class="lineno"><a href="80,1259" id="srcline1259">1259</a></span><span class="line">                MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,Tc,0 ,T_adj);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1260" id="srcline1260">1260</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1261" id="srcline1261">1261</a></span><span class="line">            elseif (V_obj &gt;= V_me)&amp;&amp;(V_me &gt;V_tar)</span></span>
<span class="srcline"><span class="lineno"><a href="80,1262" id="srcline1262">1262</a></span><span class="line">                MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,Tc,0 ,T_adj);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1263" id="srcline1263">1263</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1264" id="srcline1264">1264</a></span><span class="line">            elseif (V_me &gt;= V_obj)&amp;&amp;(V_obj &gt;= V_tar)</span></span>
<span class="srcline"><span class="lineno"><a href="80,1265" id="srcline1265">1265</a></span><span class="line">                MSSTemp1 = 0;  </span></span>
<span class="srcline"><span class="lineno"><a href="80,1266" id="srcline1266">1266</a></span><span class="line">                MSSTemp2 = MSSCalculate( V_tar,V_me,V_obj,T_long,Tc,0 ,T_adj);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1267" id="srcline1267">1267</a></span><span class="line">                MSS = max(MSSTemp1,MSSTemp2);  </span></span>
<span class="srcline"><span class="lineno"><a href="80,1268" id="srcline1268">1268</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1269" id="srcline1269">1269</a></span><span class="line">            elseif (V_obj &lt;= V_tar)&amp;&amp;(V_tar &lt; V_me)</span></span>
<span class="srcline"><span class="lineno"><a href="80,1270" id="srcline1270">1270</a></span><span class="line">                MSS = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1271" id="srcline1271">1271</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1272" id="srcline1272">1272</a></span><span class="line">            elseif (V_obj &lt;= V_me)&amp;&amp;(V_me &lt; V_tar)</span></span>
<span class="srcline"><span class="lineno"><a href="80,1273" id="srcline1273">1273</a></span><span class="line">                MSS = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1274" id="srcline1274">1274</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1275" id="srcline1275">1275</a></span><span class="line">            elseif (V_me &lt;= V_obj)&amp;&amp;(V_obj &lt;= V_tar)</span></span>
<span class="srcline"><span class="lineno"><a href="80,1276" id="srcline1276">1276</a></span><span class="line">                MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,T_max,0 ,T_adj);           </span></span>
<span class="srcline"><span class="lineno"><a href="80,1277" id="srcline1277">1277</a></span><span class="line">            else</span></span>
<span class="srcline"><span class="lineno"><a href="80,1278" id="srcline1278">1278</a></span><span class="line">                <span class="comment">%Nothing</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1279" id="srcline1279">1279</a></span><span class="line">                MSS = 255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1280" id="srcline1280">1280</a></span><span class="line">            end  </span></span>
<span class="srcline"><span class="lineno"><a href="80,1281" id="srcline1281">1281</a></span><span class="line">        end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1282" id="srcline1282">1282</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1283" id="srcline1283">1283</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1284" id="srcline1284">1284</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1285" id="srcline1285">1285</a></span><span class="line">function MSS = MSSLdJudgment( V_tar,V_me,V_obj,T_long,Tc,T_lat,T_adj )</span></span>
<span class="srcline"><span class="lineno"><a href="80,1286" id="srcline1286">1286</a></span><span class="line"><span class="comment">%UNTITLED5 Summary of this function goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1287" id="srcline1287">1287</a></span><span class="line"><span class="comment">%   Detailed explanation goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1288" id="srcline1288">1288</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1289" id="srcline1289">1289</a></span><span class="line">    if abs(V_me-V_tar)&lt;1e-5</span></span>
<span class="srcline"><span class="lineno"><a href="80,1290" id="srcline1290">1290</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="80,1291" id="srcline1291">1291</a></span><span class="line">        if V_me&gt;V_obj</span></span>
<span class="srcline"><span class="lineno"><a href="80,1292" id="srcline1292">1292</a></span><span class="line">            MSS = (V_me-V_obj)*(T_lat+T_adj);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1293" id="srcline1293">1293</a></span><span class="line">        else</span></span>
<span class="srcline"><span class="lineno"><a href="80,1294" id="srcline1294">1294</a></span><span class="line">            MSS = (V_me-V_obj)*(T_adj+Tc);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1295" id="srcline1295">1295</a></span><span class="line">        end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1296" id="srcline1296">1296</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1297" id="srcline1297">1297</a></span><span class="line">    else</span></span>
<span class="srcline"><span class="lineno"><a href="80,1298" id="srcline1298">1298</a></span><span class="line">        T_max = (V_obj - V_me)/(V_tar - V_me)*T_long;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1299" id="srcline1299">1299</a></span><span class="line">        MSSTemp1 = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1300" id="srcline1300">1300</a></span><span class="line">        MSSTemp2 = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1301" id="srcline1301">1301</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1302" id="srcline1302">1302</a></span><span class="line">        if Tc &lt; T_long</span></span>
<span class="srcline"><span class="lineno"><a href="80,1303" id="srcline1303">1303</a></span><span class="line">            if (V_obj &gt;= V_tar)&amp;&amp;(V_tar &gt;V_me)</span></span>
<span class="srcline"><span class="lineno"><a href="80,1304" id="srcline1304">1304</a></span><span class="line">                MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,Tc,1 ,T_adj);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1305" id="srcline1305">1305</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1306" id="srcline1306">1306</a></span><span class="line">            elseif (V_obj &gt;= V_me)&amp;&amp;(V_me &gt;V_tar)</span></span>
<span class="srcline"><span class="lineno"><a href="80,1307" id="srcline1307">1307</a></span><span class="line">                MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,Tc,1 ,T_adj);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1308" id="srcline1308">1308</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1309" id="srcline1309">1309</a></span><span class="line">            elseif (V_me &gt;= V_obj)&amp;&amp;(V_obj &gt;= V_tar)</span></span>
<span class="srcline"><span class="lineno"><a href="80,1310" id="srcline1310">1310</a></span><span class="line">                if Tc &gt; T_max</span></span>
<span class="srcline"><span class="lineno"><a href="80,1311" id="srcline1311">1311</a></span><span class="line">                    MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,Tc,1 ,T_adj);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1312" id="srcline1312">1312</a></span><span class="line">                else</span></span>
<span class="srcline"><span class="lineno"><a href="80,1313" id="srcline1313">1313</a></span><span class="line">                    <span class="comment">% Tc &lt; T_max</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1314" id="srcline1314">1314</a></span><span class="line">                    MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,T_max,1 ,T_adj);            </span></span>
<span class="srcline"><span class="lineno"><a href="80,1315" id="srcline1315">1315</a></span><span class="line">                end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1316" id="srcline1316">1316</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1317" id="srcline1317">1317</a></span><span class="line">            elseif (V_obj &lt;= V_tar)&amp;&amp;(V_tar &lt; V_me)</span></span>
<span class="srcline"><span class="lineno"><a href="80,1318" id="srcline1318">1318</a></span><span class="line">                MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,T_lat,1 ,T_adj);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1319" id="srcline1319">1319</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1320" id="srcline1320">1320</a></span><span class="line">            elseif (V_obj &lt;= V_me)&amp;&amp;(V_me &lt; V_tar)</span></span>
<span class="srcline"><span class="lineno"><a href="80,1321" id="srcline1321">1321</a></span><span class="line">                MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,T_lat,1 ,T_adj);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1322" id="srcline1322">1322</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1323" id="srcline1323">1323</a></span><span class="line">            elseif (V_me &lt;= V_obj)&amp;&amp;(V_obj &lt;= V_tar)</span></span>
<span class="srcline"><span class="lineno"><a href="80,1324" id="srcline1324">1324</a></span><span class="line">                MSSTemp1 = MSSCalculate( V_tar,V_me,V_obj,T_long,T_lat,1 ,T_adj);  </span></span>
<span class="srcline"><span class="lineno"><a href="80,1325" id="srcline1325">1325</a></span><span class="line">                MSSTemp2 = MSSCalculate( V_tar,V_me,V_obj,T_long,Tc,1 ,T_adj);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1326" id="srcline1326">1326</a></span><span class="line">                MSS = max(MSSTemp1,MSSTemp2);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1327" id="srcline1327">1327</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1328" id="srcline1328">1328</a></span><span class="line">            else</span></span>
<span class="srcline"><span class="lineno"><a href="80,1329" id="srcline1329">1329</a></span><span class="line">                <span class="comment">%Nothing</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1330" id="srcline1330">1330</a></span><span class="line">                MSS = 255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1331" id="srcline1331">1331</a></span><span class="line">            end    </span></span>
<span class="srcline"><span class="lineno"><a href="80,1332" id="srcline1332">1332</a></span><span class="line">        else</span></span>
<span class="srcline"><span class="lineno"><a href="80,1333" id="srcline1333">1333</a></span><span class="line">            <span class="comment">% Tc &gt; T_long</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1334" id="srcline1334">1334</a></span><span class="line">            if V_obj &gt; V_tar</span></span>
<span class="srcline"><span class="lineno"><a href="80,1335" id="srcline1335">1335</a></span><span class="line">                MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,Tc,1 );</span></span>
<span class="srcline"><span class="lineno"><a href="80,1336" id="srcline1336">1336</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1337" id="srcline1337">1337</a></span><span class="line">            else</span></span>
<span class="srcline"><span class="lineno"><a href="80,1338" id="srcline1338">1338</a></span><span class="line">                MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,T_lat,1 );</span></span>
<span class="srcline"><span class="lineno"><a href="80,1339" id="srcline1339">1339</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1340" id="srcline1340">1340</a></span><span class="line">            end    </span></span>
<span class="srcline"><span class="lineno"><a href="80,1341" id="srcline1341">1341</a></span><span class="line">        end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1342" id="srcline1342">1342</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1343" id="srcline1343">1343</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1344" id="srcline1344">1344</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1345" id="srcline1345">1345</a></span><span class="line">function MSS = MSSLoJudgment( V_tar,V_me,V_obj,T_long,Tc,T_lat,T_adj )</span></span>
<span class="srcline"><span class="lineno"><a href="80,1346" id="srcline1346">1346</a></span><span class="line"><span class="comment">%UNTITLED5 Summary of this function goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1347" id="srcline1347">1347</a></span><span class="line"><span class="comment">%   Detailed explanation goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1348" id="srcline1348">1348</a></span><span class="line">    if abs(V_me-V_tar)&lt;1e-5</span></span>
<span class="srcline"><span class="lineno"><a href="80,1349" id="srcline1349">1349</a></span><span class="line">        if V_me&gt;V_obj</span></span>
<span class="srcline"><span class="lineno"><a href="80,1350" id="srcline1350">1350</a></span><span class="line">            MSS = (V_me-V_obj)*(Tc+T_adj);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1351" id="srcline1351">1351</a></span><span class="line">        else</span></span>
<span class="srcline"><span class="lineno"><a href="80,1352" id="srcline1352">1352</a></span><span class="line">            MSS = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1353" id="srcline1353">1353</a></span><span class="line">        end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1354" id="srcline1354">1354</a></span><span class="line">    else</span></span>
<span class="srcline"><span class="lineno"><a href="80,1355" id="srcline1355">1355</a></span><span class="line">        T_max = (V_obj - V_me)/(V_tar - V_me)*T_long;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1356" id="srcline1356">1356</a></span><span class="line">        MSSTemp1 = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1357" id="srcline1357">1357</a></span><span class="line">        MSSTemp2 = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1358" id="srcline1358">1358</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1359" id="srcline1359">1359</a></span><span class="line">        if Tc &lt; T_long</span></span>
<span class="srcline"><span class="lineno"><a href="80,1360" id="srcline1360">1360</a></span><span class="line">            if (V_obj &gt;= V_tar)&amp;&amp;(V_tar &gt;V_me)</span></span>
<span class="srcline"><span class="lineno"><a href="80,1361" id="srcline1361">1361</a></span><span class="line">                <span class="comment">%MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,0,1 );</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1362" id="srcline1362">1362</a></span><span class="line">                MSS = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1363" id="srcline1363">1363</a></span><span class="line">            elseif (V_obj &gt;= V_me)&amp;&amp;(V_me &gt;V_tar)</span></span>
<span class="srcline"><span class="lineno"><a href="80,1364" id="srcline1364">1364</a></span><span class="line">                <span class="comment">%MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,0,1 );</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1365" id="srcline1365">1365</a></span><span class="line">                MSS = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1366" id="srcline1366">1366</a></span><span class="line">            elseif (V_me &gt;= V_obj)&amp;&amp;(V_obj &gt;= V_tar)</span></span>
<span class="srcline"><span class="lineno"><a href="80,1367" id="srcline1367">1367</a></span><span class="line">                if Tc &gt; T_max</span></span>
<span class="srcline"><span class="lineno"><a href="80,1368" id="srcline1368">1368</a></span><span class="line">                    MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,T_max,1 ,T_adj);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1369" id="srcline1369">1369</a></span><span class="line">                else</span></span>
<span class="srcline"><span class="lineno"><a href="80,1370" id="srcline1370">1370</a></span><span class="line">                    <span class="comment">% Tc &lt; T_max</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1371" id="srcline1371">1371</a></span><span class="line">                    MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,Tc,1 ,T_adj);            </span></span>
<span class="srcline"><span class="lineno"><a href="80,1372" id="srcline1372">1372</a></span><span class="line">                end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1373" id="srcline1373">1373</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1374" id="srcline1374">1374</a></span><span class="line">            elseif (V_obj &lt;= V_tar)&amp;&amp;(V_tar &lt; V_me)</span></span>
<span class="srcline"><span class="lineno"><a href="80,1375" id="srcline1375">1375</a></span><span class="line">                MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,Tc,1 ,T_adj);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1376" id="srcline1376">1376</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1377" id="srcline1377">1377</a></span><span class="line">            elseif (V_obj &lt;= V_me)&amp;&amp;(V_me &lt; V_tar)</span></span>
<span class="srcline"><span class="lineno"><a href="80,1378" id="srcline1378">1378</a></span><span class="line">                MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,Tc,1 ,T_adj);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1379" id="srcline1379">1379</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1380" id="srcline1380">1380</a></span><span class="line">            elseif (V_me &lt;= V_obj)&amp;&amp;(V_obj &lt;= V_tar)</span></span>
<span class="srcline"><span class="lineno"><a href="80,1381" id="srcline1381">1381</a></span><span class="line">                if Tc &lt; 2*T_max</span></span>
<span class="srcline"><span class="lineno"><a href="80,1382" id="srcline1382">1382</a></span><span class="line">                    <span class="comment">%MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,0,1 );              </span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1383" id="srcline1383">1383</a></span><span class="line">                    MSS = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1384" id="srcline1384">1384</a></span><span class="line">                else </span></span>
<span class="srcline"><span class="lineno"><a href="80,1385" id="srcline1385">1385</a></span><span class="line">                    MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,Tc,1 ,T_adj);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1386" id="srcline1386">1386</a></span><span class="line">                end            </span></span>
<span class="srcline"><span class="lineno"><a href="80,1387" id="srcline1387">1387</a></span><span class="line">            else</span></span>
<span class="srcline"><span class="lineno"><a href="80,1388" id="srcline1388">1388</a></span><span class="line">                <span class="comment">%Nothing</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1389" id="srcline1389">1389</a></span><span class="line">                MSS = 255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1390" id="srcline1390">1390</a></span><span class="line">            end    </span></span>
<span class="srcline"><span class="lineno"><a href="80,1391" id="srcline1391">1391</a></span><span class="line">        else</span></span>
<span class="srcline"><span class="lineno"><a href="80,1392" id="srcline1392">1392</a></span><span class="line">            <span class="comment">% Tc &gt; T_long</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1393" id="srcline1393">1393</a></span><span class="line">            if (V_obj &gt;= V_tar)&amp;&amp;(V_tar &gt;V_me)</span></span>
<span class="srcline"><span class="lineno"><a href="80,1394" id="srcline1394">1394</a></span><span class="line">                <span class="comment">%MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,0,1 );</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1395" id="srcline1395">1395</a></span><span class="line">                MSS = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1396" id="srcline1396">1396</a></span><span class="line">            elseif (V_obj &gt;= V_me)&amp;&amp;(V_me &gt;V_tar)</span></span>
<span class="srcline"><span class="lineno"><a href="80,1397" id="srcline1397">1397</a></span><span class="line">                <span class="comment">%MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,0,1 );</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1398" id="srcline1398">1398</a></span><span class="line">                MSS = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1399" id="srcline1399">1399</a></span><span class="line">            elseif (V_me &gt;= V_obj)&amp;&amp;(V_obj &gt;= V_tar)</span></span>
<span class="srcline"><span class="lineno"><a href="80,1400" id="srcline1400">1400</a></span><span class="line">                MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,T_max,1 ,T_adj);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1401" id="srcline1401">1401</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1402" id="srcline1402">1402</a></span><span class="line">            elseif (V_obj &lt;= V_tar)&amp;&amp;(V_tar &lt; V_me)</span></span>
<span class="srcline"><span class="lineno"><a href="80,1403" id="srcline1403">1403</a></span><span class="line">                MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,Tc,1 ,T_adj);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1404" id="srcline1404">1404</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1405" id="srcline1405">1405</a></span><span class="line">            elseif (V_obj &lt;= V_me)&amp;&amp;(V_me &lt; V_tar)</span></span>
<span class="srcline"><span class="lineno"><a href="80,1406" id="srcline1406">1406</a></span><span class="line">                MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,Tc,1 ,T_adj);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1407" id="srcline1407">1407</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1408" id="srcline1408">1408</a></span><span class="line">            elseif (V_me &lt;= V_obj)&amp;&amp;(V_obj &lt;= V_tar)</span></span>
<span class="srcline"><span class="lineno"><a href="80,1409" id="srcline1409">1409</a></span><span class="line">                MSSTemp1 = 0;  </span></span>
<span class="srcline"><span class="lineno"><a href="80,1410" id="srcline1410">1410</a></span><span class="line">                MSSTemp2 = MSSCalculate( V_tar,V_me,V_obj,T_long,Tc,1 ,T_adj);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1411" id="srcline1411">1411</a></span><span class="line">                MSS = max(MSSTemp1,MSSTemp2);           </span></span>
<span class="srcline"><span class="lineno"><a href="80,1412" id="srcline1412">1412</a></span><span class="line">            else</span></span>
<span class="srcline"><span class="lineno"><a href="80,1413" id="srcline1413">1413</a></span><span class="line">                <span class="comment">%Nothing</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1414" id="srcline1414">1414</a></span><span class="line">                MSS = 255;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1415" id="srcline1415">1415</a></span><span class="line">            end  </span></span>
<span class="srcline"><span class="lineno"><a href="80,1416" id="srcline1416">1416</a></span><span class="line">        end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1417" id="srcline1417">1417</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1418" id="srcline1418">1418</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1419" id="srcline1419">1419</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1420" id="srcline1420">1420</a></span><span class="line">function MSS = MSSCalculate( V_tar,V_me,V_obj,T_long,Time2Cal,ObjDirection ,T_adj)</span></span>
<span class="srcline"><span class="lineno"><a href="80,1421" id="srcline1421">1421</a></span><span class="line"><span class="comment">%UNTITLED3 Summary of this function goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1422" id="srcline1422">1422</a></span><span class="line"><span class="comment">%   Detailed explanation goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1423" id="srcline1423">1423</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1424" id="srcline1424">1424</a></span><span class="line"><span class="comment">%Time2Cal is the time to be calculated</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1425" id="srcline1425">1425</a></span><span class="line"><span class="comment">%V_tar is the target of mergeing vehicle</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1426" id="srcline1426">1426</a></span><span class="line"><span class="comment">%V_obj is the obstacle object of mergeing vehicle</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1427" id="srcline1427">1427</a></span><span class="line"><span class="comment">%ObjDirection is the direction of object</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1428" id="srcline1428">1428</a></span><span class="line"><span class="comment">%T_long is the time when longitual vel adjust ends</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1429" id="srcline1429">1429</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1430" id="srcline1430">1430</a></span><span class="line">    if Time2Cal &lt; T_long</span></span>
<span class="srcline"><span class="lineno"><a href="80,1431" id="srcline1431">1431</a></span><span class="line">        MSS = (V_tar-V_me)/2/T_long*Time2Cal^2-(V_obj-V_me)*Time2Cal;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1432" id="srcline1432">1432</a></span><span class="line">    else</span></span>
<span class="srcline"><span class="lineno"><a href="80,1433" id="srcline1433">1433</a></span><span class="line"><span class="comment">%         MSS = (V_tar-V_me)/2*T_long - (V_obj - V_me)*T_long - (V_obj - V_tar)*Time2Cal;</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1434" id="srcline1434">1434</a></span><span class="line">        MSS = (V_me - V_tar)/2*T_long + (V_tar - V_obj)*Time2Cal;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1435" id="srcline1435">1435</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1436" id="srcline1436">1436</a></span><span class="line">    MSS = MSS + 4;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1437" id="srcline1437">1437</a></span><span class="line">    if ObjDirection == 1</span></span>
<span class="srcline"><span class="lineno"><a href="80,1438" id="srcline1438">1438</a></span><span class="line">        <span class="comment">%obj is Leading vehicle </span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1439" id="srcline1439">1439</a></span><span class="line">    else</span></span>
<span class="srcline"><span class="lineno"><a href="80,1440" id="srcline1440">1440</a></span><span class="line">        <span class="comment">%obj is Following vehicle</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1441" id="srcline1441">1441</a></span><span class="line">        MSS = (-1)*MSS;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1442" id="srcline1442">1442</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1443" id="srcline1443">1443</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1444" id="srcline1444">1444</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1445" id="srcline1445">1445</a></span><span class="line">function PreGlbVal(x_inIn,y_inIn,angle_inIn,x_outIn,y_outIn,angle_outIn,Info_FdIn,Info_FoIn,Info_LdIn,Info_LoIn,Info_MeIn,X_melimit_In,aylimitIn,axlimitIn)</span></span>
<span class="srcline"><span class="lineno"><a href="80,1446" id="srcline1446">1446</a></span><span class="line">    global V_me V L_veh X_me X L_me T_adj H   Y W_veh  W_me Y_me Y_cal; </span></span>
<span class="srcline"><span class="lineno"><a href="80,1447" id="srcline1447">1447</a></span><span class="line">    global Aylimit Axlimit X_melimit k_maxlimit;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1448" id="srcline1448">1448</a></span><span class="line">    global T_lat  quadsinu2tbl quadcosu2tbl</span></span>
<span class="srcline"><span class="lineno"><a href="80,1449" id="srcline1449">1449</a></span><span class="line">    global x_in y_in angle_in y_out x_out angle_out </span></span>
<span class="srcline"><span class="lineno"><a href="80,1450" id="srcline1450">1450</a></span><span class="line"><span class="comment">%     global MSS  Tc AngleTC</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1451" id="srcline1451">1451</a></span><span class="line">    persistent InitFlg</span></span>
<span class="srcline"><span class="lineno"><a href="80,1452" id="srcline1452">1452</a></span><span class="line">    if isempty(InitFlg)</span></span>
<span class="srcline"><span class="lineno"><a href="80,1453" id="srcline1453">1453</a></span><span class="line">        InitFlg = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1454" id="srcline1454">1454</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1455" id="srcline1455">1455</a></span><span class="line">    Aylimit = aylimitIn;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1456" id="srcline1456">1456</a></span><span class="line">    Axlimit = axlimitIn;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1457" id="srcline1457">1457</a></span><span class="line">    X_melimit = X_melimit_In;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1458" id="srcline1458">1458</a></span><span class="line">    k_maxlimit = 0.2;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1459" id="srcline1459">1459</a></span><span class="line">    <span class="comment">%Accurcy  3 - &gt; 0.005</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1460" id="srcline1460">1460</a></span><span class="line">    Accurcy = 3;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1461" id="srcline1461">1461</a></span><span class="line">    <span class="comment">%lanewidth</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1462" id="srcline1462">1462</a></span><span class="line">    H = 2.5;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1463" id="srcline1463">1463</a></span><span class="line">    <span class="comment">%Time to adjust vel</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1464" id="srcline1464">1464</a></span><span class="line">    T_adj = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1465" id="srcline1465">1465</a></span><span class="line">    <span class="comment">%Time to change lane</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1466" id="srcline1466">1466</a></span><span class="line">    T_lat = 5;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1467" id="srcline1467">1467</a></span><span class="line">    <span class="comment">%Fd Fo Ld Lo, all are considered to be moving in a constant speed</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1468" id="srcline1468">1468</a></span><span class="line"><span class="comment">%     Tc = [0,0,0,0]';</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1469" id="srcline1469">1469</a></span><span class="line">    W_veh = [Info_FdIn(5),Info_FoIn(5),Info_LdIn(5),Info_LoIn(5)]';</span></span>
<span class="srcline"><span class="lineno"><a href="80,1470" id="srcline1470">1470</a></span><span class="line">    L_veh = [Info_FdIn(4),Info_FoIn(4),Info_LdIn(4),Info_LoIn(4)]';</span></span>
<span class="srcline"><span class="lineno"><a href="80,1471" id="srcline1471">1471</a></span><span class="line">    Y = [Info_FdIn(2),Info_FoIn(2),Info_LdIn(2),Info_LoIn(2)]';</span></span>
<span class="srcline"><span class="lineno"><a href="80,1472" id="srcline1472">1472</a></span><span class="line">    X = [Info_FdIn(1),Info_FoIn(1),Info_LdIn(1),Info_LoIn(1)]';</span></span>
<span class="srcline"><span class="lineno"><a href="80,1473" id="srcline1473">1473</a></span><span class="line">    V = [Info_FdIn(3),Info_FoIn(3),Info_LdIn(3),Info_LoIn(3)]';</span></span>
<span class="srcline"><span class="lineno"><a href="80,1474" id="srcline1474">1474</a></span><span class="line">    Y_cal = [(Info_FdIn(2)-Info_FdIn(5)/2),(Info_FoIn(2)+Info_FoIn(5)/2),(Info_LdIn(2)-Info_LdIn(5)/2),(Info_LoIn(2)+Info_LoIn(5)/2)]';</span></span>
<span class="srcline"><span class="lineno"><a href="80,1475" id="srcline1475">1475</a></span><span class="line"><span class="comment">%     for i = 1:4</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1476" id="srcline1476">1476</a></span><span class="line"><span class="comment">%         if abs(V(i)) &gt; 100</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1477" id="srcline1477">1477</a></span><span class="line"><span class="comment">%             if i &lt;2</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1478" id="srcline1478">1478</a></span><span class="line"><span class="comment">%                 X(i) = -200;Y(i) = y_outIn;V(i) = 0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1479" id="srcline1479">1479</a></span><span class="line"><span class="comment">%             elseif i &lt; 3</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1480" id="srcline1480">1480</a></span><span class="line"><span class="comment">%                 X(i) = -200;Y(i) = 0;V(i) = 0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1481" id="srcline1481">1481</a></span><span class="line"><span class="comment">%             elseif i &lt; 4</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1482" id="srcline1482">1482</a></span><span class="line"><span class="comment">%                 X(i) = 200;Y(i) = y_outIn;V(i) = 100;</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1483" id="srcline1483">1483</a></span><span class="line"><span class="comment">%             else</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1484" id="srcline1484">1484</a></span><span class="line"><span class="comment">%                 X(i) = 200;Y(i) = 0;V(i) = 100;</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1485" id="srcline1485">1485</a></span><span class="line"><span class="comment">%             end</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1486" id="srcline1486">1486</a></span><span class="line"><span class="comment">%         end</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1487" id="srcline1487">1487</a></span><span class="line"><span class="comment">%     end</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1488" id="srcline1488">1488</a></span><span class="line">    X_me = Info_MeIn(1);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1489" id="srcline1489">1489</a></span><span class="line">    Y_me = Info_MeIn(2);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1490" id="srcline1490">1490</a></span><span class="line">    V_me = Info_MeIn(3);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1491" id="srcline1491">1491</a></span><span class="line">    L_me = Info_MeIn(4);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1492" id="srcline1492">1492</a></span><span class="line">    W_me = Info_MeIn(5);</span></span>
<span class="srcline"><span class="lineno"><a href="80,1493" id="srcline1493">1493</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,1494" id="srcline1494">1494</a></span><span class="line">    x_in = x_inIn;y_in = y_inIn;angle_in = angle_inIn;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1495" id="srcline1495">1495</a></span><span class="line">    y_out = y_outIn;x_out = x_outIn;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1496" id="srcline1496">1496</a></span><span class="line">    angle_out = angle_outIn;</span></span>
<span class="srcline"><span class="lineno"><a href="80,1497" id="srcline1497">1497</a></span><span class="line">    <span class="comment">%Time of end of longitu vel modify</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1498" id="srcline1498">1498</a></span><span class="line"><span class="comment">%     MSS = [0,0,0,0]';</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1499" id="srcline1499">1499</a></span><span class="line"><span class="comment">%     AngleTC = [0,0,0,0]';</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,1500" id="srcline1500">1500</a></span><span class="line">    if InitFlg &lt; 1e-1</span></span>
<span class="srcline"><span class="lineno"><a href="80,1501" id="srcline1501">1501</a></span><span class="line">        quadsinu2tbl = [0;0;0;0;0;1.00000000000000e-05;1.00000000000000e-05;1.00000000000000e-05;2.00000000000000e-05;3.00000000000000e-05;4.00000000000000e-05;6.00000000000000e-05;7.00000000000000e-05;9.00000000000000e-05;0.000110000000000000;0.000140000000000000;0.000170000000000000;0.000200000000000000;0.000240000000000000;0.000290000000000000;0.000330000000000000;0.000390000000000000;0.000440000000000000;0.000510000000000000;0.000580000000000000;0.000650000000000000;0.000730000000000000;0.000820000000000000;0.000910000000000000;0.00102000000000000;0.00112000000000000;0.00124000000000000;0.00137000000000000;0.00150000000000000;0.00164000000000000;0.00179000000000000;0.00194000000000000;0.00211000000000000;0.00229000000000000;0.00247000000000000;0.00267000000000000;0.00287000000000000;0.00309000000000000;0.00331000000000000;0.00355000000000000;0.00380000000000000;0.00405000000000000;0.00433000000000000;0.00461000000000000;0.00490000000000000;0.00521000000000000;0.00553000000000000;0.00586000000000000;0.00620000000000000;0.00656000000000000;0.00693000000000000;0.00731000000000000;0.00771000000000000;0.00813000000000000;0.00855000000000000;0.00899000000000000;0.00945000000000000;0.00992000000000000;0.0104100000000000;0.0109100000000000;0.0114300000000000;0.0119700000000000;0.0125200000000000;0.0130900000000000;0.0136700000000000;0.0142800000000000;0.0149000000000000;0.0155300000000000;0.0161900000000000;0.0168600000000000;0.0175500000000000;0.0182600000000000;0.0189900000000000;0.0197400000000000;0.0205100000000000;0.0212900000000000;0.0221000000000000;0.0229300000000000;0.0237700000000000;0.0246400000000000;0.0255300000000000;0.0264400000000000;0.0273700000000000;0.0283200000000000;0.0292900000000000;0.0302900000000000;0.0313000000000000;0.0323400000000000;0.0334000000000000;0.0344900000000000;0.0355900000000000;0.0367200000000000;0.0378800000000000;0.0390600000000000;0.0402600000000000;0.0414800000000000;0.0427300000000000;0.0440000000000000;0.0453000000000000;0.0466300000000000;0.0479700000000000;0.0493500000000000;0.0507500000000000;0.0521700000000000;0.0536200000000000;0.0551000000000000;0.0566000000000000;0.0581300000000000;0.0596800000000000;0.0612700000000000;0.0628800000000000;0.0645100000000000;0.0661800000000000;0.0678700000000000;0.0695900000000000;0.0713400000000000;0.0731100000000000;0.0749200000000000;0.0767500000000000;0.0786100000000000;0.0805000000000000;0.0824200000000000;0.0843600000000000;0.0863400000000000;0.0883500000000000;0.0903800000000000;0.0924500000000000;0.0945400000000000;0.0966700000000000;0.0988200000000000;0.101010000000000;0.103220000000000;0.105470000000000;0.107740000000000;0.110050000000000;0.112390000000000;0.114760000000000;0.117160000000000;0.119590000000000;0.122050000000000;0.124540000000000;0.127070000000000;0.129620000000000;0.132210000000000;0.134830000000000;0.137480000000000;0.140160000000000;0.142880000000000;0.145620000000000;0.148400000000000;0.151210000000000;0.154050000000000;0.156920000000000;0.159830000000000;0.162770000000000;0.165740000000000;0.168740000000000;0.171770000000000;0.174840000000000;0.177940000000000;0.181070000000000;0.184230000000000;0.187430000000000;0.190650000000000;0.193910000000000;0.197200000000000;0.200520000000000;0.203880000000000;0.207260000000000;0.210680000000000;0.214130000000000;0.217610000000000;0.221120000000000;0.224670000000000;0.228240000000000;0.231850000000000;0.235480000000000;0.239150000000000;0.242850000000000;0.246580000000000;0.250340000000000;0.254130000000000;0.257950000000000;0.261800000000000;0.265680000000000;0.269590000000000;0.273530000000000;0.277500000000000;0.281490000000000;0.285520000000000;0.289570000000000;0.293660000000000;0.297770000000000;0.301910000000000;0.306070000000000;0.310270000000000;0.314490000000000;0.318740000000000;0.323010000000000;0.327310000000000;0.331640000000000;0.335990000000000;0.340360000000000;0.344770000000000;0.349190000000000;0.353640000000000;0.358110000000000;0.362610000000000;0.367130000000000;0.371670000000000;0.376240000000000;0.380820000000000;0.385430000000000;0.3900600000</span></span>
<span class="srcline"><span class="lineno"><a href="80,1502" id="srcline1502">1502</a></span><span class="line">00000;0.394710000000000;0.399380000000000;0.404060000000000;0.408770000000000;0.413500000000000;0.418240000000000;0.423000000000000;0.427780000000000;0.432570000000000;0.437380000000000;0.442200000000000;0.447040000000000;0.451900000000000;0.456760000000000;0.461640000000000;0.466540000000000;0.471440000000000;0.476360000000000;0.481280000000000;0.486220000000000;0.491160000000000;0.496120000000000;0.501080000000000;0.506050000000000;0.511020000000000;0.516000000000000;0.520990000000000;0.525980000000000;0.530970000000000;0.535960000000000;0.540960000000000;0.545960000000000;0.550960000000000;0.555960000000000;0.560960000000000;0.565960000000000;0.570950000000000;0.575940000000000;0.580930000000000;0.585910000000000;0.590880000000000;0.595850000000000;0.600810000000000;0.605770000000000;0.610710000000000;0.615640000000000;0.620560000000000;0.625470000000000;0.630360000000000;0.635250000000000;0.640110000000000;0.644960000000000;0.649800000000000;0.654610000000000;0.659410000000000;0.664190000000000;0.668950000000000;0.673680000000000;0.678390000000000;0.683080000000000;0.687750000000000;0.692390000000000;0.697000000000000;0.701580000000000;0.706140000000000;0.710670000000000;0.715160000000000;0.719630000000000;0.724060000000000;0.728460000000000;0.732820000000000;0.737150000000000;0.741440000000000;0.745700000000000;0.749910000000000;0.754080000000000;0.758220000000000;0.762310000000000;0.766360000000000;0.770360000000000;0.774320000000000;0.778240000000000;0.782100000000000;0.785920000000000;0.789690000000000;0.793410000000000;0.797080000000000;0.800690000000000;0.804260000000000;0.807770000000000;0.811220000000000;0.814610000000000;0.817950000000000;0.821240000000000;0.824460000000000;0.827620000000000;0.830720000000000;0.833760000000000;0.836730000000000;0.839640000000000;0.842490000000000;0.845270000000000;0.847980000000000;0.850630000000000;0.853200000000000;0.855710000000000;0.858150000000000;0.860510000000000;0.862810000000000;0.865030000000000;0.867170000000000;0.869250000000000;0.871240000000000;0.873160000000000;0.875010000000000;0.876770000000000;0.878460000000000;0.880070000000000;0.881600000000000;0.883050000000000;0.884420000000000;0.885700000000000;0.886910000000000;0.888030000000000;0.889060000000000;0.890020000000000;0.890880000000000;0.891670000000000;0.892370000000000;0.892980000000000;0.893500000000000;0.893940000000000;0.894290000000000;0.894560000000000;0.894730000000000;0.894820000000000];</span></span>
<span class="srcline"><span class="lineno"><a href="80,1503" id="srcline1503">1503</a></span><span class="line">        quadcosu2tbl = [0;0.00500000000000000;0.0100000000000000;0.0150000000000000;0.0200000000000000;0.0250000000000000;0.0300000000000000;0.0350000000000000;0.0400000000000000;0.0450000000000000;0.0500000000000000;0.0550000000000000;0.0600000000000000;0.0650000000000000;0.0700000000000000;0.0750000000000000;0.0800000000000000;0.0850000000000000;0.0900000000000000;0.0950000000000000;0.100000000000000;0.105000000000000;0.110000000000000;0.115000000000000;0.120000000000000;0.125000000000000;0.130000000000000;0.135000000000000;0.139990000000000;0.144990000000000;0.149990000000000;0.154990000000000;0.159990000000000;0.164990000000000;0.169990000000000;0.174980000000000;0.179980000000000;0.184980000000000;0.189980000000000;0.194970000000000;0.199970000000000;0.204960000000000;0.209960000000000;0.214950000000000;0.219950000000000;0.224940000000000;0.229940000000000;0.234930000000000;0.239920000000000;0.244910000000000;0.249900000000000;0.254890000000000;0.259880000000000;0.264870000000000;0.269860000000000;0.274840000000000;0.279830000000000;0.284810000000000;0.289790000000000;0.294780000000000;0.299760000000000;0.304740000000000;0.309710000000000;0.314690000000000;0.319660000000000;0.324640000000000;0.329610000000000;0.334580000000000;0.339550000000000;0.344510000000000;0.349480000000000;0.354440000000000;0.359400000000000;0.364350000000000;0.369310000000000;0.374260000000000;0.379210000000000;0.384150000000000;0.389100000000000;0.394040000000000;0.398980000000000;0.403910000000000;0.408840000000000;0.413770000000000;0.418690000000000;0.423620000000000;0.428530000000000;0.433450000000000;0.438350000000000;0.443260000000000;0.448160000000000;0.453050000000000;0.457940000000000;0.462830000000000;0.467710000000000;0.472590000000000;0.477460000000000;0.482320000000000;0.487180000000000;0.492040000000000;0.496880000000000;0.501730000000000;0.506560000000000;0.511390000000000;0.516210000000000;0.521030000000000;0.525830000000000;0.530630000000000;0.535430000000000;0.540210000000000;0.544990000000000;0.549760000000000;0.554520000000000;0.559270000000000;0.564010000000000;0.568750000000000;0.573470000000000;0.578190000000000;0.582890000000000;0.587590000000000;0.592270000000000;0.596940000000000;0.601610000000000;0.606260000000000;0.610900000000000;0.615530000000000;0.620150000000000;0.624750000000000;0.629350000000000;0.633930000000000;0.638490000000000;0.643050000000000;0.647590000000000;0.652110000000000;0.656620000000000;0.661120000000000;0.665600000000000;0.670070000000000;0.674520000000000;0.678960000000000;0.683380000000000;0.687780000000000;0.692170000000000;0.696540000000000;0.700890000000000;0.705220000000000;0.709540000000000;0.713840000000000;0.718120000000000;0.722380000000000;0.726610000000000;0.730830000000000;0.735030000000000;0.739210000000000;0.743370000000000;0.747500000000000;0.751620000000000;0.755710000000000;0.759780000000000;0.763830000000000;0.767850000000000;0.771850000000000;0.775820000000000;0.779770000000000;0.783690000000000;0.787590000000000;0.791470000000000;0.795310000000000;0.799130000000000;0.802920000000000;0.806690000000000;0.810430000000000;0.814130000000000;0.817810000000000;0.821460000000000;0.825080000000000;0.828670000000000;0.832230000000000;0.835760000000000;0.839250000000000;0.842720000000000;0.846150000000000;0.849550000000000;0.852910000000000;0.856240000000000;0.859540000000000;0.862800000000000;0.866030000000000;0.869220000000000;0.872370000000000;0.875490000000000;0.878570000000000;0.881610000000000;0.884610000000000;0.887580000000000;0.890500000000000;0.893390000000000;0.896230000000000;0.899040000000000;0.901800000000000;0.904520000000000;0.907200000000000;0.909840000000000;0.912440000000000;0.914990000000000;0.917500000000000;0.919960000000000;0.922380000000000;0.924750000000000;0.927080000000000;0.929360000000000;0.931590000000000;0.933780000000000;0.935910000000000;0.938000000000000;0.940040000000000;0.942040000000000;0.943980000000000;0.945870000000000;0.947710000000000;0.949500000000000;0.951240000000000;0.952930000000000;0.954570000000000;0.956150000000000;0.957680000000</span></span>
<span class="srcline"><span class="lineno"><a href="80,1504" id="srcline1504">1504</a></span><span class="line">000;0.959150000000000;0.960570000000000;0.961940000000000;0.963250000000000;0.964510000000000;0.965710000000000;0.966850000000000;0.967940000000000;0.968970000000000;0.969950000000000;0.970860000000000;0.971720000000000;0.972520000000000;0.973260000000000;0.973940000000000;0.974570000000000;0.975130000000000;0.975630000000000;0.976070000000000;0.976450000000000;0.976770000000000;0.977030000000000;0.977230000000000;0.977370000000000;0.977440000000000;0.977450000000000;0.977400000000000;0.977280000000000;0.977100000000000;0.976860000000000;0.976560000000000;0.976190000000000;0.975750000000000;0.975250000000000;0.974690000000000;0.974060000000000;0.973370000000000;0.972610000000000;0.971790000000000;0.970910000000000;0.969960000000000;0.968940000000000;0.967860000000000;0.966710000000000;0.965500000000000;0.964220000000000;0.962880000000000;0.961470000000000;0.959990000000000;0.958450000000000;0.956850000000000;0.955180000000000;0.953440000000000;0.951640000000000;0.949780000000000;0.947850000000000;0.945860000000000;0.943800000000000;0.941670000000000;0.939490000000000;0.937240000000000;0.934920000000000;0.932540000000000;0.930100000000000;0.927600000000000;0.925030000000000;0.922400000000000;0.919710000000000;0.916960000000000;0.914150000000000;0.911280000000000;0.908340000000000;0.905350000000000;0.902300000000000;0.899180000000000;0.896010000000000;0.892790000000000;0.889500000000000;0.886160000000000;0.882760000000000;0.879310000000000;0.875800000000000;0.872240000000000;0.868620000000000;0.864950000000000;0.861230000000000;0.857460000000000;0.853630000000000;0.849760000000000;0.845840000000000;0.841870000000000;0.837850000000000;0.833780000000000;0.829670000000000;0.825520000000000;0.821320000000000;0.817070000000000;0.812790000000000;0.808460000000000;0.804100000000000;0.799690000000000;0.795250000000000;0.790770000000000;0.786250000000000;0.781700000000000;0.777120000000000;0.772500000000000;0.767860000000000;0.763180000000000;0.758470000000000;0.753740000000000;0.748980000000000;0.744190000000000;0.739380000000000;0.734550000000000;0.729700000000000;0.724830000000000;0.719930000000000;0.715030000000000;0.710100000000000;0.705160000000000;0.700210000000000;0.695250000000000;0.690280000000000;0.685300000000000;0.680310000000000;0.675320000000000;0.670320000000000;0.665320000000000];</span></span>
<span class="srcline"><span class="lineno"><a href="80,1505" id="srcline1505">1505</a></span><span class="line">        InitFlg = 1;          </span></span>
<span class="srcline"><span class="lineno"><a href="80,1506" id="srcline1506">1506</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1507" id="srcline1507">1507</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,1508" id="srcline1508">1508</a></span><span class="line"> </span></span>
</pre>
</div>
