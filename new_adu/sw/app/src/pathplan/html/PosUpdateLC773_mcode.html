<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="143,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T1U3">PreTimeAcu</span>,<span class="var type1" id="S3T1U4">xpositionPre</span>,<span class="var type1" id="S4T1U5">ypositionPre</span>,<span class="var type1" id="S5T1U6">Ax</span>,<span class="var type1" id="S6T1U7">Ay</span>,<span class="var type1" id="S7T1U8">Vx</span>,<span class="var type1" id="S8T1U9">Vy</span>,<span class="var type1" id="S9T1U10">Theta</span>, <span class="var type1" id="S10T1U11">xpositionNex</span>,<span class="var type1" id="S11T1U12">ypositionNex</span>,<span class="var type1" id="S12T1U13">PathPlanSucFlg</span>,<span class="var type1" id="S13T1U14">PathTrjFinishFlg</span>,<span class="var type1" id="S14T1U15">LCInTransState</span>] = PosUpdateLC( <span class="var type1" id="S15T1U18">StopFlg</span>,<span class="var type1" id="S16T1U19">StopArc</span>,<span class="var type1" id="S17T1U20">ArcNex</span>,<span class="var type1" id="S18T1U21">ArcPre</span>,<span class="var type1" id="S19T1U22">VPre</span>,<span class="var type1" id="S20T1U23">VNex</span>,<span class="var type1" id="S21T30U24">xoptres</span>,<span class="var type1" id="S22T1U25">x_in</span>,<span class="var type1" id="S23T1U26">y_in</span>,<span class="var type1" id="S24T1U27">angle_in</span>,<span class="var type1" id="S25T1U28">y_out</span>,<span class="var type1" id="S26T1U29">angle_out</span>,<span class="var type1" id="S27T10U30">Info_Me</span>,<span class="var type1" id="S28T1U31">PreTime</span>,<span class="var type1" id="S29T1U32">PathPlanRes</span>,<span class="var type1" id="S30T1U33">ToLeftOrRight</span>,<span class="var type1" id="S31T1U34">CurOp</span>,<span class="var type1" id="S32T1U35">SimpleStop</span>,<span class="var type1" id="S33T1U36">PosPreDisEn</span>,<span class="var type1" id="S34T1U37">ResumeVelAduEnFlg</span>,<span class="var type1" id="S35T1U38">aResume</span>,<span class="var type1" id="S36T1U39">TransCnt</span>,<span class="var type1" id="S37T1U40">PreTimeMin</span>,<span class="var type1" id="S38T10U41">PreInfo_Me</span>,<span class="var type1" id="S39T1U42">LCTransEn</span>,<span class="var type1" id="S40T1U43">LCEnSts</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="143,2" id="srcline2">  2</a></span><span class="line">    <span class="keyword">persistent</span> <span class="var type1" id="S41T1U45">PrePointCalEn</span> <span class="var type1" id="S42T1U46">PointCalEn</span> <span class="var type1" id="S43T33U47">PDeltaTemp</span> <span class="var type1" id="S44T33U48">PArclengthTol</span> <span class="var type1" id="S45T1U49">Ptheta_qitemp</span> <span class="var type1" id="S46T1U50">Pangle_in</span> <span class="var type1" id="S47T1U51">Px_in</span> <span class="var type1" id="S48T1U52">Py_in</span> <span class="var type1" id="S49T1U53">Px_qitemp</span> <span class="var type1" id="S50T1U54">Py_qitemp</span> <span class="var type1" id="S51T1U55">Pangle_out</span> <span class="var type1" id="S52T1U56">Px_out</span> <span class="var type1" id="S53T1U57">Py_out</span> <span class="var type1" id="S54T1U58">PTime</span> <span class="var type1" id="S55T1U59">PT_lat</span> <span class="var type1" id="S56T1U60">PT_long</span> <span class="var type1" id="S57T1U61">PV_me</span> <span class="var type1" id="S58T1U62">PV_tar</span> <span class="var type1" id="S59T1U63">PTransCntInit</span> <span class="var type1" id="S60T1U64">Pxposition</span> <span class="var type1" id="S61T1U65">Pyposition</span> <span class="var type1" id="S62T1U66">ArcHistory</span> <span class="var type1" id="S63T1U67">StopFlgRiseEdge</span> <span class="var type1" id="S64T1U68">ArcAdd</span> <span class="var type1" id="S65T1U69">PPreTmTransCnt</span> <span class="var type1" id="S66T1U70">PInLaneLCTrans</span> <span class="var type1" id="S67T1U71">PPathPlanRes</span> <span class="var type1" id="S68T1U72">PToLeftOrRight</span> <span class="var type1" id="S69T1U73">PxpositionNex</span> <span class="var type1" id="S70T1U74">PypositionNex</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,3" id="srcline3">  3</a></span><span class="line">    <span class="mxinfo " id="T1:U70"><span class="var type1" id="S3T1U77">xpositionPre</span> = <span class="mxinfo " id="T1:U72">0</span></span>;<span class="mxinfo " id="T1:U73"><span class="var type1" id="S4T1U81">ypositionPre</span> = <span class="mxinfo " id="T1:U75">0</span></span>;<span class="mxinfo " id="T1:U76"><span class="var type1" id="S5T1U85">Ax</span> = <span class="mxinfo " id="T1:U78">0</span></span>;<span class="mxinfo " id="T1:U79"><span class="var type1" id="S6T1U89">Ay</span> = <span class="mxinfo " id="T1:U81">0</span></span>;<span class="mxinfo " id="T1:U82"><span class="var type1" id="S7T1U93">Vx</span> = <span class="mxinfo " id="T1:U84">0</span></span>;<span class="mxinfo " id="T1:U85"><span class="var type1" id="S8T1U97">Vy</span> = <span class="mxinfo " id="T1:U87">0</span></span>;<span class="mxinfo " id="T1:U88"><span class="var type1" id="S9T1U101">Theta</span> = <span class="mxinfo " id="T1:U90">0</span></span>;<span class="mxinfo " id="T1:U91"><span class="var type1" id="S13T1U105">PathTrjFinishFlg</span> = <span class="mxinfo " id="T1:U93">0</span></span>;<span class="mxinfo " id="T1:U94"><span class="var type1" id="S71T1U109">FirstTrigFlg</span> = <span class="mxinfo " id="T1:U96">0</span></span>;<span class="mxinfo " id="T1:U97"><span class="var type1" id="S72T1U113">T_lat</span>=<span class="mxinfo " id="T1:U99">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,4" id="srcline4">  4</a></span><span class="line">    <span class="mxinfo " id="T1:U100"><span class="var type1" id="S12T1U117">PathPlanSucFlg</span> = <span class="var type1" id="S29T1U118">PathPlanRes</span></span>;<span class="mxinfo " id="T1:U103"><span class="var type1" id="S14T1U121">LCInTransState</span> = <span class="mxinfo " id="T1:U105">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,5" id="srcline5">  5</a></span><span class="line"><span class="comment">%     if (isempty(PrePointCalEn))||(PathPlanRes &lt; 1e-1)||(CurOp &lt; 4)</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,6" id="srcline6">  6</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T8:U106">isempty(<span class="var type0" id="S41T0U128">PrePointCalEn</span>)</span>||(<span class="mxinfo " id="T8:U107"><span class="var type1" id="S40T1U131">LCEnSts</span>&lt;<span class="mxinfo " id="T1:U109">0.5</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="143,7" id="srcline7">  7</a></span><span class="line">        <span class="mxinfo " id="T1:U110"><span class="var type1" id="S41T1U135">PrePointCalEn</span> = <span class="mxinfo " id="T1:U112">0</span></span>;<span class="mxinfo " id="T1:U113"><span class="var type1" id="S42T1U139">PointCalEn</span> = <span class="mxinfo " id="T1:U115">0</span></span>;<span class="mxinfo " id="T1:U116"><span class="var type1" id="S62T1U143">ArcHistory</span> = <span class="mxinfo " id="T1:U118">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,8" id="srcline8">  8</a></span><span class="line">        <span class="mxinfo " id="T33:U119"><span class="var type1" id="S43T33U147">PDeltaTemp</span>=<span class="mxinfo " id="T33:U121">[<span class="mxinfo " id="T1:U122">0</span> <span class="mxinfo " id="T1:U123">0</span>]</span></span>;<span class="mxinfo " id="T33:U124"><span class="var type1" id="S44T33U154">PArclengthTol</span>=<span class="mxinfo " id="T33:U126">[<span class="mxinfo " id="T1:U127">0</span> <span class="mxinfo " id="T1:U128">0</span>]</span></span>;<span class="mxinfo " id="T1:U129"><span class="var type1" id="S45T1U161">Ptheta_qitemp</span>=<span class="mxinfo " id="T1:U131">0</span></span>;<span class="mxinfo " id="T1:U132"><span class="var type1" id="S46T1U165">Pangle_in</span>=<span class="mxinfo " id="T1:U134">0</span></span>;<span class="mxinfo " id="T1:U135"><span class="var type1" id="S47T1U169">Px_in</span> =<span class="mxinfo " id="T1:U137">0</span></span>;<span class="mxinfo " id="T1:U138"><span class="var type1" id="S48T1U173">Py_in</span>=<span class="mxinfo " id="T1:U140">0</span></span>;<span class="mxinfo " id="T1:U141"><span class="var type1" id="S49T1U177">Px_qitemp</span>=<span class="mxinfo " id="T1:U143">0</span></span>;<span class="mxinfo " id="T1:U144"><span class="var type1" id="S50T1U181">Py_qitemp</span>=<span class="mxinfo " id="T1:U146">0</span></span>;<span class="mxinfo " id="T1:U147"><span class="var type1" id="S51T1U185">Pangle_out</span>=<span class="mxinfo " id="T1:U149">0</span></span>;<span class="mxinfo " id="T1:U150"><span class="var type1" id="S52T1U189">Px_out</span>=<span class="mxinfo " id="T1:U152">0</span></span>;<span class="mxinfo " id="T1:U153"><span class="var type1" id="S53T1U193">Py_out</span>=<span class="mxinfo " id="T1:U155">0</span></span>;<span class="mxinfo " id="T1:U156"><span class="var type1" id="S54T1U197">PTime</span>=<span class="mxinfo " id="T1:U158">0</span></span>;<span class="mxinfo " id="T1:U159"><span class="var type1" id="S63T1U201">StopFlgRiseEdge</span> = <span class="mxinfo " id="T1:U161">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,9" id="srcline9">  9</a></span><span class="line">        <span class="mxinfo " id="T1:U162"><span class="var type1" id="S55T1U205">PT_lat</span>=<span class="mxinfo " id="T1:U164">0</span></span>;<span class="mxinfo " id="T1:U165"><span class="var type1" id="S56T1U209">PT_long</span>=<span class="mxinfo " id="T1:U167">0</span></span>;<span class="mxinfo " id="T1:U168"><span class="var type1" id="S57T1U213">PV_me</span>=<span class="mxinfo " id="T1:U170">0</span></span>;<span class="mxinfo " id="T1:U171"><span class="var type1" id="S58T1U217">PV_tar</span>=<span class="mxinfo " id="T1:U173">0</span></span>;<span class="mxinfo " id="T1:U174"><span class="var type1" id="S60T1U221">Pxposition</span>=<span class="mxinfo " id="T1:U176">0</span></span>;<span class="mxinfo " id="T1:U177"><span class="var type1" id="S61T1U225">Pyposition</span>=<span class="mxinfo " id="T1:U179">0</span></span>;<span class="mxinfo " id="T1:U180"><span class="var type1" id="S64T1U229">ArcAdd</span> = <span class="mxinfo " id="T1:U182">0</span></span>;<span class="mxinfo " id="T1:U183"><span class="var type1" id="S65T1U233">PPreTmTransCnt</span> = <span class="var type1" id="S36T1U234">TransCnt</span></span>;<span class="mxinfo " id="T1:U186"><span class="var type1" id="S59T1U237">PTransCntInit</span> = <span class="var type1" id="S36T1U238">TransCnt</span></span>;<span class="mxinfo " id="T1:U189"><span class="var type1" id="S67T1U241">PPathPlanRes</span> = <span class="mxinfo " id="T1:U191">0</span></span>;<span class="mxinfo " id="T1:U192"><span class="var type1" id="S68T1U245">PToLeftOrRight</span> = <span class="mxinfo " id="T1:U194">0</span></span>;<span class="mxinfo " id="T1:U195"><span class="var type1" id="S69T1U249">PxpositionNex</span> = <span class="mxinfo " id="T1:U197">0</span></span>;<span class="mxinfo " id="T1:U198"><span class="var type1" id="S70T1U253">PypositionNex</span>= <span class="mxinfo " id="T1:U200">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,10" id="srcline10"> 10</a></span><span class="line">        <span class="mxinfo " id="T1:U201"><span class="var type1" id="S66T1U257">PInLaneLCTrans</span> = <span class="mxinfo " id="T1:U203">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,11" id="srcline11"> 11</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,12" id="srcline12"> 12</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T8:U204">isempty(<span class="var type0" id="S42T0U263">PointCalEn</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,13" id="srcline13"> 13</a></span><span class="line">        <span class="mxinfo " id="T1:U205"><span class="var type1" id="S42T1U266">PointCalEn</span> = <span class="mxinfo " id="T1:U207">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,14" id="srcline14"> 14</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,15" id="srcline15"> 15</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T8:U208">isempty(<span class="var type0" id="S66T0U272">PInLaneLCTrans</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,16" id="srcline16"> 16</a></span><span class="line">        <span class="mxinfo " id="T1:U209"><span class="var type1" id="S66T1U275">PInLaneLCTrans</span> = <span class="mxinfo " id="T1:U211">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,17" id="srcline17"> 17</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,18" id="srcline18"> 18</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T8:U212"><span class="var type1" id="S42T1U280">PointCalEn</span> &lt;<span class="mxinfo " id="T1:U214">1e-1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="143,19" id="srcline19"> 19</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,20" id="srcline20"> 20</a></span><span class="line">        <span class="comment">% If In LC transition state</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,21" id="srcline21"> 21</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T8:U215"><span class="var type1" id="S66T1U286">PInLaneLCTrans</span> &gt; <span class="mxinfo " id="T1:U217">0.5</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="143,22" id="srcline22"> 22</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="143,23" id="srcline23"> 23</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T8:U218"><span class="var type1" id="S68T1U291">PToLeftOrRight</span> &gt; <span class="mxinfo " id="T1:U220">0.5</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="143,24" id="srcline24"> 24</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,25" id="srcline25"> 25</a></span><span class="line">                <span class="mxinfo " id="T1:U221"><span class="mxinfo " id="T1:U222"><span class="var type1" id="S27T10U297">Info_Me</span>(<span class="mxinfo " id="T1:U224">2</span>)</span> = <span class="mxinfo " id="T1:U225">-<span class="mxinfo " id="T1:U226"><span class="var type1" id="S27T10U301">Info_Me</span>(<span class="mxinfo " id="T1:U228">2</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,26" id="srcline26"> 26</a></span><span class="line">                <span class="mxinfo " id="T1:U229"><span class="mxinfo " id="T1:U230"><span class="var type1" id="S27T10U306">Info_Me</span>(<span class="mxinfo " id="T1:U232">6</span>)</span> = <span class="mxinfo " id="T1:U233">-<span class="mxinfo " id="T1:U234"><span class="var type1" id="S27T10U310">Info_Me</span>(<span class="mxinfo " id="T1:U236">6</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,27" id="srcline27"> 27</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,28" id="srcline28"> 28</a></span><span class="line">            <span class="comment">% New PPres Rising Edge or Exit Trans and PPres = 0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,29" id="srcline29"> 29</a></span><span class="line">            <span class="keyword">if</span> (<span class="mxinfo " id="T8:U237"><span class="var type1" id="S29T1U318">PathPlanRes</span> &gt; <span class="mxinfo " id="T1:U239">0.5</span></span>)&amp;&amp;(<span class="mxinfo " id="T8:U240"><span class="var type1" id="S67T1U322">PPathPlanRes</span> &lt; <span class="mxinfo " id="T1:U242">0.5</span></span>) || ((<span class="mxinfo " id="T8:U243"><span class="var type1" id="S39T1U328">LCTransEn</span> &lt; <span class="mxinfo " id="T1:U245">0.5</span></span>)&amp;&amp;(<span class="mxinfo " id="T8:U246"><span class="var type1" id="S29T1U332">PathPlanRes</span> &lt; <span class="mxinfo " id="T1:U248">0.5</span></span>))</span></span>
<span class="srcline"><span class="lineno"><a href="143,30" id="srcline30"> 30</a></span><span class="line">                <span class="comment">%End Transition to accept new PlanRes</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,31" id="srcline31"> 31</a></span><span class="line">                <span class="mxinfo " id="T1:U249"><span class="var type1" id="S41T1U336">PrePointCalEn</span> = <span class="mxinfo " id="T1:U251">0</span></span>;<span class="mxinfo " id="T1:U252"><span class="var type1" id="S42T1U340">PointCalEn</span> = <span class="mxinfo " id="T1:U254">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,32" id="srcline32"> 32</a></span><span class="line">                <span class="mxinfo " id="T1:U255"><span class="var type1" id="S66T1U344">PInLaneLCTrans</span> = <span class="mxinfo " id="T1:U257">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,33" id="srcline33"> 33</a></span><span class="line">            <span class="keyword">end</span>        </span></span>
<span class="srcline"><span class="lineno"><a href="143,34" id="srcline34"> 34</a></span><span class="line">        <span class="keyword">end</span>       </span></span>
<span class="srcline"><span class="lineno"><a href="143,35" id="srcline35"> 35</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,36" id="srcline36"> 36</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T8:U258"><span class="var type1" id="S66T1U349">PInLaneLCTrans</span> &gt; <span class="mxinfo " id="T1:U260">0.5</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="143,37" id="srcline37"> 37</a></span><span class="line">        <span class="mxinfo " id="T10:U261"><span class="var type1" id="S27T10U353">Info_Me</span> = <span class="var type1" id="S38T10U354">PreInfo_Me</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,38" id="srcline38"> 38</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,39" id="srcline39"> 39</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T8:U264"><span class="var type1" id="S42T1U358">PointCalEn</span> &lt;<span class="mxinfo " id="T1:U266">1e-1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="143,40" id="srcline40"> 40</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T8:U267"><span class="var type1" id="S29T1U363">PathPlanRes</span> &gt; <span class="mxinfo " id="T1:U269">1e-1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="143,41" id="srcline41"> 41</a></span><span class="line">            <span class="mxinfo " id="T1:U270"><span class="var type1" id="S42T1U367">PointCalEn</span> = <span class="mxinfo " id="T1:U272">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,42" id="srcline42"> 42</a></span><span class="line">            <span class="keyword">if</span> (<span class="mxinfo " id="T8:U273"><span class="var type1" id="S42T1U374">PointCalEn</span> &gt; <span class="mxinfo " id="T1:U275">1e-1</span></span>) &amp;&amp; (<span class="mxinfo " id="T8:U276"><span class="var type1" id="S41T1U378">PrePointCalEn</span> &lt; <span class="mxinfo " id="T1:U278">1e-1</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="143,43" id="srcline43"> 43</a></span><span class="line">                <span class="mxinfo " id="T1:U279"><span class="var type1" id="S41T1U382">PrePointCalEn</span> = <span class="var type1" id="S42T1U383">PointCalEn</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,44" id="srcline44"> 44</a></span><span class="line">                <span class="mxinfo " id="T1:U282"><span class="var type1" id="S71T1U386">FirstTrigFlg</span> = <span class="mxinfo " id="T1:U284">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,45" id="srcline45"> 45</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,46" id="srcline46"> 46</a></span><span class="line">                <span class="mxinfo " id="T1:U285"><span class="var type1" id="S71T1U391">FirstTrigFlg</span> = <span class="mxinfo " id="T1:U287">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,47" id="srcline47"> 47</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,48" id="srcline48"> 48</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,49" id="srcline49"> 49</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,50" id="srcline50"> 50</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,51" id="srcline51"> 51</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T8:U288"><span class="mxinfo " id="T1:U289">abs(<span class="mxinfo " id="T1:U290"><span class="var type1" id="S29T1U400">PathPlanRes</span> - <span class="var type1" id="S67T1U401">PPathPlanRes</span></span>)</span>&gt;<span class="mxinfo " id="T1:U293">1e-1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="143,52" id="srcline52"> 52</a></span><span class="line">        <span class="mxinfo " id="T1:U294"><span class="var type1" id="S67T1U405">PPathPlanRes</span> = <span class="var type1" id="S29T1U406">PathPlanRes</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,53" id="srcline53"> 53</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,54" id="srcline54"> 54</a></span><span class="line">    <span class="mxinfo " id="T33:U297"><span class="var type1" id="S75T33U409">DeltaTemp</span> = <span class="mxinfo " id="T33:U299">[<span class="mxinfo " id="T1:U300">0</span> <span class="mxinfo " id="T1:U301">0</span>]</span></span>;<span class="mxinfo " id="T1:U302"><span class="var type1" id="S10T1U416">xpositionNex</span> = <span class="mxinfo " id="T1:U304">0</span></span>;<span class="mxinfo " id="T1:U305"><span class="var type1" id="S11T1U420">ypositionNex</span>= <span class="mxinfo " id="T1:U307">0</span></span>;<span class="mxinfo " id="T1:U308"><span class="var type1" id="S76T1U424">ThetaNex</span> = <span class="mxinfo " id="T1:U310">0</span></span>;<span class="mxinfo " id="T33:U311"><span class="var type1" id="S77T33U428">k_localmaxTemp</span> = <span class="mxinfo " id="T33:U313">[<span class="mxinfo " id="T1:U314">0</span> <span class="mxinfo " id="T1:U315">0</span>]</span></span>;<span class="mxinfo " id="T33:U316"><span class="var type1" id="S78T33U435">ArclengthTol</span> = <span class="mxinfo " id="T33:U318">[0 0]</span></span>;<span class="mxinfo " id="T1:U319"><span class="var type1" id="S79T1U442">Arc</span> = <span class="mxinfo " id="T1:U321">255</span></span>;<span class="mxinfo " id="T1:U322"><span class="var type1" id="S80T1U446">V_tarPos</span> = <span class="mxinfo " id="T1:U324">255</span></span>;<span class="mxinfo " id="T1:U325"><span class="var type1" id="S81T1U450">x_out</span>=<span class="mxinfo " id="T1:U327"><span class="var type1" id="S21T30U452">xoptres</span>(<span class="mxinfo " id="T9:U329">1</span>)</span></span>;<span class="mxinfo " id="T1:U330"><span class="var type1" id="S82T1U456">V_me</span> = <span class="mxinfo " id="T1:U332"><span class="var type1" id="S27T10U458">Info_Me</span>(<span class="mxinfo " id="T9:U334">3</span>)</span></span>;    </span></span>
<span class="srcline"><span class="lineno"><a href="143,55" id="srcline55"> 55</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="143,56" id="srcline56"> 56</a></span><span class="line">    <span class="comment">% Not supposed to work</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,57" id="srcline57"> 57</a></span><span class="line">    <span class="mxinfo " id="T1:U335"><span class="var type1" id="S2T1U462">PreTimeAcu</span> = <span class="var type1" id="S28T1U463">PreTime</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,58" id="srcline58"> 58</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T8:U338"><span class="var type1" id="S42T1U467">PointCalEn</span> &gt; <span class="mxinfo " id="T1:U340">1e-1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="143,59" id="srcline59"> 59</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T8:U341"><span class="var type1" id="S71T1U472">FirstTrigFlg</span> &gt; <span class="mxinfo " id="T1:U343">1e-1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="143,60" id="srcline60"> 60</a></span><span class="line">            [ <span class="var type1" id="S83T1U477">x_qitemp</span>,<span class="var type1" id="S84T1U478">y_qitemp</span>,<span class="var type1" id="S85T1U479">theta_qitemp</span> ] = <span class="fcn" id="F768N95:B481">qiConfigCal</span>( <span class="var type1" id="S22T1U482">x_in</span>,<span class="var type1" id="S23T1U483">y_in</span>,<span class="var type1" id="S24T1U484">angle_in</span>,<span class="var type1" id="S81T1U485">x_out</span>,<span class="var type1" id="S25T1U486">y_out</span>,<span class="var type1" id="S26T1U487">angle_out</span> );</span></span>
<span class="srcline"><span class="lineno"><a href="143,61" id="srcline61"> 61</a></span><span class="line">            <span class="mxinfo " id="T1:U353"><span class="var type1" id="S87T1U490">x_qi</span> = <span class="var type1" id="S83T1U491">x_qitemp</span></span>;<span class="mxinfo " id="T1:U356"><span class="var type1" id="S88T1U494">y_qi</span> = <span class="var type1" id="S84T1U495">y_qitemp</span></span>;<span class="mxinfo " id="T1:U359"><span class="var type1" id="S89T1U498">theta_qi</span> = <span class="var type1" id="S85T1U499">theta_qitemp</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,62" id="srcline62"> 62</a></span><span class="line">            [<span class="mxinfo " id="T1:U362"><span class="var type1" id="S75T33U504">DeltaTemp</span>(<span class="mxinfo " id="T1:U364">1</span>)</span>,<span class="mxinfo " id="T1:U365"><span class="var type1" id="S77T33U507">k_localmaxTemp</span>(<span class="mxinfo " id="T1:U367">1</span>)</span>,<span class="mxinfo " id="T1:U368"><span class="var type1" id="S78T33U510">ArclengthTol</span>(<span class="mxinfo " id="T9:U370">1</span>)</span>] = <span class="fcn" id="F771N93:B513">ElementaryPathPlot</span>( <span class="var type1" id="S22T1U514">x_in</span>,<span class="var type1" id="S23T1U515">y_in</span>,<span class="var type1" id="S24T1U516">angle_in</span>,<span class="var type1" id="S87T1U517">x_qi</span>,<span class="var type1" id="S88T1U518">y_qi</span>,<span class="var type1" id="S89T1U519">theta_qi</span> );</span></span>
<span class="srcline"><span class="lineno"><a href="143,63" id="srcline63"> 63</a></span><span class="line">            [<span class="mxinfo " id="T1:U377"><span class="var type1" id="S75T33U524">DeltaTemp</span>(<span class="mxinfo " id="T1:U379">2</span>)</span>,<span class="mxinfo " id="T1:U380"><span class="var type1" id="S77T33U527">k_localmaxTemp</span>(<span class="mxinfo " id="T1:U382">2</span>)</span>,<span class="mxinfo " id="T1:U383"><span class="var type1" id="S78T33U530">ArclengthTol</span>(<span class="mxinfo " id="T9:U385">2</span>)</span>] = <span class="fcn" id="F771N93:B533">ElementaryPathPlot</span>( <span class="var type1" id="S87T1U534">x_qi</span>,<span class="var type1" id="S88T1U535">y_qi</span>,<span class="var type1" id="S89T1U536">theta_qi</span>,<span class="var type1" id="S81T1U537">x_out</span>,<span class="var type1" id="S25T1U538">y_out</span>,<span class="var type1" id="S26T1U539">angle_out</span> );</span></span>
<span class="srcline"><span class="lineno"><a href="143,64" id="srcline64"> 64</a></span><span class="line">            <span class="mxinfo " id="T1:U392"><span class="var type1" id="S91T1U542">V_tar</span>=<span class="mxinfo " id="T1:U394"><span class="var type1" id="S21T30U544">xoptres</span>(<span class="mxinfo " id="T9:U396">3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,65" id="srcline65"> 65</a></span><span class="line">            <span class="mxinfo " id="T1:U397"><span class="var type1" id="S68T1U548">PToLeftOrRight</span> = <span class="var type1" id="S30T1U549">ToLeftOrRight</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,66" id="srcline66"> 66</a></span><span class="line"><span class="comment">%             Pxoptres = xoptres;</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,67" id="srcline67"> 67</a></span><span class="line">            <span class="mxinfo " id="T1:U400"><span class="var type1" id="S92T1U552">S_arc</span> = <span class="mxinfo " id="T1:U402"><span class="mxinfo " id="T1:U403"><span class="var type1" id="S78T33U555">ArclengthTol</span>(<span class="mxinfo " id="T1:U405">1</span>)</span> + <span class="mxinfo " id="T1:U406"><span class="var type1" id="S78T33U558">ArclengthTol</span>(<span class="mxinfo " id="T1:U408">2</span>)</span></span></span>;    </span></span>
<span class="srcline"><span class="lineno"><a href="143,68" id="srcline68"> 68</a></span><span class="line">            <span class="mxinfo " id="T1:U409"><span class="var type1" id="S93T1U562">T_long</span> = <span class="mxinfo " id="T1:U411"><span class="mxinfo " id="T1:U412"><span class="mxinfo " id="T1:U413"><span class="mxinfo " id="T1:U414"><span class="var type1" id="S21T30U567">xoptres</span>(<span class="mxinfo " id="T9:U416">2</span>)</span>*<span class="mxinfo " id="T1:U417">2</span></span>*<span class="var type1" id="S92T1U570">S_arc</span></span>/(<span class="mxinfo " id="T1:U419"><span class="var type1" id="S91T1U573">V_tar</span> + <span class="var type1" id="S82T1U574">V_me</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,69" id="srcline69"> 69</a></span><span class="line">            <span class="mxinfo " id="T1:U422"><span class="var type1" id="S94T1U577">S_acc</span> = <span class="mxinfo " id="T1:U424"><span class="mxinfo " id="T1:U425">(<span class="mxinfo " id="T1:U426"><span class="var type1" id="S91T1U582">V_tar</span> + <span class="var type1" id="S82T1U583">V_me</span></span>)/<span class="mxinfo " id="T1:U429">2</span></span> * <span class="var type1" id="S93T1U585">T_long</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,70" id="srcline70"> 70</a></span><span class="line">            <span class="mxinfo " id="T1:U431"><span class="var type1" id="S92T1U588">S_arc</span> = <span class="mxinfo " id="T1:U433"><span class="mxinfo " id="T1:U434"><span class="var type1" id="S78T33U591">ArclengthTol</span>(<span class="mxinfo " id="T9:U436">1</span>)</span> + <span class="mxinfo " id="T1:U437"><span class="var type1" id="S78T33U594">ArclengthTol</span>(<span class="mxinfo " id="T1:U439">2</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,71" id="srcline71"> 71</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T8:U440"><span class="var type1" id="S94T1U599">S_acc</span> &lt; <span class="var type1" id="S92T1U600">S_arc</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="143,72" id="srcline72"> 72</a></span><span class="line">                <span class="mxinfo " id="T1:U443"><span class="var type1" id="S72T1U603">T_lat</span> = <span class="mxinfo " id="T1:U445"><span class="var type1" id="S93T1U605">T_long</span> + <span class="mxinfo " id="T1:U447">(<span class="mxinfo " id="T1:U448"><span class="var type1" id="S92T1U609">S_arc</span> - <span class="var type1" id="S94T1U610">S_acc</span></span>) / <span class="var type1" id="S91T1U611">V_tar</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,73" id="srcline73"> 73</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,74" id="srcline74"> 74</a></span><span class="line">                <span class="mxinfo " id="T1:U452"><span class="var type1" id="S95T1U615">a</span> = <span class="mxinfo " id="T1:U454">(<span class="mxinfo " id="T1:U455"><span class="var type1" id="S91T1U619">V_tar</span> - <span class="var type1" id="S82T1U620">V_me</span></span>)/<span class="var type1" id="S93T1U621">T_long</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,75" id="srcline75"> 75</a></span><span class="line">                <span class="mxinfo " id="T1:U459"><span class="var type1" id="S96T1U624">V_end</span> = <span class="mxinfo " id="T1:U461">sqrt(<span class="mxinfo " id="T1:U462"><span class="mxinfo " id="T1:U463"><span class="var type1" id="S82T1U629">V_me</span>^2</span> + <span class="mxinfo " id="T1:U465"><span class="mxinfo " id="T1:U466"><span class="mxinfo " id="T1:U467">2</span>*<span class="var type1" id="S95T1U634">a</span></span>*<span class="var type1" id="S92T1U635">S_arc</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,76" id="srcline76"> 76</a></span><span class="line">                <span class="keyword">if</span> <span class="mxinfo " id="T8:U470"><span class="var type1" id="S95T1U639">a</span> == <span class="mxinfo " id="T1:U472">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="143,77" id="srcline77"> 77</a></span><span class="line">                    <span class="mxinfo " id="T1:U473"><span class="var type1" id="S72T1U643">T_lat</span> = <span class="mxinfo " id="T1:U475"><span class="var type1" id="S92T1U645">S_arc</span> / <span class="var type1" id="S82T1U646">V_me</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,78" id="srcline78"> 78</a></span><span class="line">                <span class="keyword">else</span>        </span></span>
<span class="srcline"><span class="lineno"><a href="143,79" id="srcline79"> 79</a></span><span class="line">                    <span class="mxinfo " id="T1:U478"><span class="var type1" id="S72T1U650">T_lat</span> = <span class="mxinfo " id="T1:U480">(<span class="mxinfo " id="T1:U481"><span class="var type1" id="S96T1U654">V_end</span> - <span class="var type1" id="S82T1U655">V_me</span></span>)/<span class="var type1" id="S95T1U656">a</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,80" id="srcline80"> 80</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,81" id="srcline81"> 81</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,82" id="srcline82"> 82</a></span><span class="line">            <span class="mxinfo " id="T33:U485"><span class="var type1" id="S43T33U659">PDeltaTemp</span> = <span class="var type1" id="S75T33U660">DeltaTemp</span></span>; <span class="mxinfo " id="T33:U488"><span class="var type1" id="S44T33U663">PArclengthTol</span> = <span class="var type1" id="S78T33U664">ArclengthTol</span></span>;<span class="mxinfo " id="T1:U491"><span class="var type1" id="S45T1U667">Ptheta_qitemp</span> = <span class="var type1" id="S85T1U668">theta_qitemp</span></span>;<span class="mxinfo " id="T1:U494"><span class="var type1" id="S46T1U671">Pangle_in</span> = <span class="var type1" id="S24T1U672">angle_in</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,83" id="srcline83"> 83</a></span><span class="line">            <span class="mxinfo " id="T1:U497"><span class="var type1" id="S47T1U675">Px_in</span> = <span class="var type1" id="S22T1U676">x_in</span></span>; <span class="mxinfo " id="T1:U500"><span class="var type1" id="S48T1U679">Py_in</span> = <span class="var type1" id="S23T1U680">y_in</span></span>;<span class="mxinfo " id="T1:U503"><span class="var type1" id="S49T1U683">Px_qitemp</span> = <span class="var type1" id="S83T1U684">x_qitemp</span></span>;<span class="mxinfo " id="T1:U506"><span class="var type1" id="S50T1U687">Py_qitemp</span> = <span class="var type1" id="S84T1U688">y_qitemp</span></span>;<span class="mxinfo " id="T1:U509"><span class="var type1" id="S51T1U691">Pangle_out</span> = <span class="var type1" id="S26T1U692">angle_out</span></span>; <span class="mxinfo " id="T1:U512"><span class="var type1" id="S52T1U695">Px_out</span> =<span class="var type1" id="S81T1U696">x_out</span></span>;<span class="mxinfo " id="T1:U515"><span class="var type1" id="S53T1U699">Py_out</span>=<span class="var type1" id="S25T1U700">y_out</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,84" id="srcline84"> 84</a></span><span class="line">            <span class="mxinfo " id="T1:U518"><span class="var type1" id="S54T1U703">PTime</span> = <span class="mxinfo " id="T1:U520">0</span></span>; <span class="mxinfo " id="T1:U521"><span class="var type1" id="S55T1U707">PT_lat</span> = <span class="var type1" id="S72T1U708">T_lat</span></span>;<span class="mxinfo " id="T1:U524"><span class="var type1" id="S56T1U711">PT_long</span> = <span class="var type1" id="S93T1U712">T_long</span></span>;<span class="mxinfo " id="T1:U527"><span class="var type1" id="S58T1U715">PV_tar</span> = <span class="var type1" id="S91T1U716">V_tar</span></span>;<span class="mxinfo " id="T1:U530"><span class="var type1" id="S57T1U719">PV_me</span> = <span class="var type1" id="S82T1U720">V_me</span></span>;<span class="mxinfo " id="T1:U533"><span class="var type1" id="S62T1U723">ArcHistory</span> = <span class="mxinfo " id="T1:U535">0</span></span>;<span class="mxinfo " id="T1:U536"><span class="var type1" id="S63T1U727">StopFlgRiseEdge</span> = <span class="mxinfo " id="T1:U538">0</span></span>;<span class="mxinfo " id="T1:U539"><span class="var type1" id="S64T1U731">ArcAdd</span> = <span class="mxinfo " id="T1:U541">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,85" id="srcline85"> 85</a></span><span class="line">            <span class="mxinfo " id="T1:U542"><span class="var type1" id="S59T1U735">PTransCntInit</span> = <span class="var type1" id="S36T1U736">TransCnt</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,86" id="srcline86"> 86</a></span><span class="line">            <span class="mxinfo " id="T1:U545"><span class="var type1" id="S65T1U739">PPreTmTransCnt</span> = <span class="var type1" id="S36T1U740">TransCnt</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,87" id="srcline87"> 87</a></span><span class="line">            <span class="mxinfo " id="T1:U548"><span class="var type1" id="S66T1U743">PInLaneLCTrans</span> = <span class="mxinfo " id="T1:U550">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,88" id="srcline88"> 88</a></span><span class="line">            <span class="mxinfo " id="T1:U551"><span class="var type1" id="S69T1U747">PxpositionNex</span> = <span class="mxinfo " id="T1:U553">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,89" id="srcline89"> 89</a></span><span class="line">            <span class="mxinfo " id="T1:U554"><span class="var type1" id="S70T1U751">PypositionNex</span> = <span class="mxinfo " id="T1:U556">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,90" id="srcline90"> 90</a></span><span class="line">        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,91" id="srcline91"> 91</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T8:U557"><span class="var type1" id="S15T1U757">StopFlg</span> &lt; <span class="mxinfo " id="T1:U559">0.5</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="143,92" id="srcline92"> 92</a></span><span class="line">                <span class="mxinfo " id="T1:U560"><span class="var type1" id="S54T1U761">PTime</span> = <span class="mxinfo " id="T1:U562"><span class="var type1" id="S54T1U763">PTime</span> + <span class="mxinfo " id="T1:U564">0.01</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,93" id="srcline93"> 93</a></span><span class="line">                <span class="keyword">if</span> <span class="mxinfo " id="T8:U565"><span class="var type1" id="S63T1U768">StopFlgRiseEdge</span> &gt; <span class="mxinfo " id="T1:U567">0.5</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="143,94" id="srcline94"> 94</a></span><span class="line">                    <span class="var type1" id="S63T1U772">StopFlgRiseEdge</span> = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="143,95" id="srcline95"> 95</a></span><span class="line">                    <span class="keyword">if</span> <span class="var type1" id="S34T1U777">ResumeVelAduEnFlg</span> &lt; 0.5</span></span>
<span class="srcline"><span class="lineno"><a href="143,96" id="srcline96"> 96</a></span><span class="line">                        <span class="var type1" id="S54T1U781">PTime</span> = <span class="var type1" id="S54T1U783">PTime</span> + 2*<span class="var type1" id="S16T1U787">StopArc</span>/<span class="var type1" id="S57T1U788">PV_me</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,97" id="srcline97"> 97</a></span><span class="line">                    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,98" id="srcline98"> 98</a></span><span class="line">                    <span class="comment">% In order to resume the previous operation, a modify</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,99" id="srcline99"> 99</a></span><span class="line">                    <span class="comment">% of Lat and Long time is needed</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,100" id="srcline100">100</a></span><span class="line">                        <span class="var type1" id="S54T1U792">PTime</span> = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="143,101" id="srcline101">101</a></span><span class="line">                        <span class="var type1" id="S57T1U796">PV_me</span> = <span class="var type1" id="S82T1U797">V_me</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,102" id="srcline102">102</a></span><span class="line">                        <span class="var type1" id="S56T1U800">PT_long</span> = abs(<span class="var type1" id="S58T1U805">PV_tar</span> - <span class="var type1" id="S57T1U806">PV_me</span>)/<span class="var type1" id="S35T1U807">aResume</span>;  </span></span>
<span class="srcline"><span class="lineno"><a href="143,103" id="srcline103">103</a></span><span class="line">                        <span class="var type1" id="S64T1U810">ArcAdd</span> = <span class="var type1" id="S62T1U811">ArcHistory</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,104" id="srcline104">104</a></span><span class="line">                    <span class="keyword">end</span>                    </span></span>
<span class="srcline"><span class="lineno"><a href="143,105" id="srcline105">105</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,106" id="srcline106">106</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,107" id="srcline107">107</a></span><span class="line">                <span class="var type1" id="S63T1U815">StopFlgRiseEdge</span> = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="143,108" id="srcline108">108</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,109" id="srcline109">109</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,110" id="srcline110">110</a></span><span class="line">        <span class="comment">% Transition of Preview Time</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,111" id="srcline111">111</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T8:U584"><span class="var type1" id="S65T1U821">PPreTmTransCnt</span> &gt; <span class="mxinfo " id="T1:U586">0.5</span></span> &amp;&amp; <span class="mxinfo " id="T8:U587"><span class="var type1" id="S59T1U824">PTransCntInit</span> &gt; <span class="mxinfo " id="T1:U589">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="143,112" id="srcline112">112</a></span><span class="line">            <span class="mxinfo " id="T1:U590"><span class="var type1" id="S65T1U828">PPreTmTransCnt</span> = <span class="mxinfo " id="T1:U592"><span class="var type1" id="S65T1U830">PPreTmTransCnt</span> - <span class="mxinfo " id="T1:U594">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,113" id="srcline113">113</a></span><span class="line">            <span class="mxinfo " id="T1:U595"><span class="var type1" id="S28T1U834">PreTime</span> = <span class="mxinfo " id="T1:U597">max(<span class="mxinfo " id="T33:U598">[<span class="var type1" id="S28T1U839">PreTime</span>,<span class="var type1" id="S37T1U840">PreTimeMin</span>]</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,114" id="srcline114">114</a></span><span class="line">            <span class="mxinfo " id="T1:U601"><span class="var type1" id="S28T1U843">PreTime</span> = <span class="mxinfo " id="T1:U603"><span class="mxinfo " id="T1:U604"><span class="mxinfo " id="T1:U605">(<span class="mxinfo " id="T1:U606"><span class="var type1" id="S28T1U849">PreTime</span> - <span class="var type1" id="S37T1U850">PreTimeMin</span></span>) * ( <span class="mxinfo " id="T1:U609"><span class="var type1" id="S59T1U853">PTransCntInit</span> - <span class="var type1" id="S65T1U854">PPreTmTransCnt</span></span> )</span> / <span class="var type1" id="S59T1U855">PTransCntInit</span></span> + <span class="var type1" id="S37T1U856">PreTimeMin</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,115" id="srcline115">115</a></span><span class="line">        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,116" id="srcline116">116</a></span><span class="line">        <span class="keyword">end</span>               </span></span>
<span class="srcline"><span class="lineno"><a href="143,117" id="srcline117">117</a></span><span class="line">        <span class="mxinfo " id="T1:U614"><span class="var type1" id="S99T1U860">i</span> = <span class="mxinfo " id="T1:U616">0</span></span>;<span class="mxinfo " id="T1:U617"><span class="var type1" id="S9T1U864">Theta</span> = <span class="mxinfo " id="T1:U619">0</span></span>;<span class="mxinfo " id="T1:U620"><span class="var type1" id="S100T1U868">Kur</span> = <span class="mxinfo " id="T1:U622">0</span></span>;<span class="mxinfo " id="T1:U623"><span class="var type1" id="S80T1U872">V_tarPos</span> = <span class="mxinfo " id="T1:U625">0</span></span>;<span class="mxinfo " id="T1:U626"><span class="var type1" id="S101T1U876">PreDis</span> = <span class="mxinfo " id="T1:U628">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,118" id="srcline118">118</a></span><span class="line">        <span class="keyword">while</span>(<span class="mxinfo " id="T8:U629"><span class="var type1" id="S99T1U882">i</span>&lt;<span class="mxinfo " id="T1:U631">0.5</span></span>)||((<span class="mxinfo " id="T8:U632"><span class="var type1" id="S101T1U890">PreDis</span> &lt; <span class="mxinfo " id="T1:U634">1</span></span>)&amp;&amp;(<span class="mxinfo " id="T8:U635"><span class="var type1" id="S15T1U894">StopFlg</span>&lt;<span class="mxinfo " id="T1:U637">0.5</span></span>)&amp;&amp;(<span class="mxinfo " id="T8:U638"><span class="var type1" id="S33T1U898">PosPreDisEn</span>&gt;<span class="mxinfo " id="T1:U640">0.5</span></span>)&amp;&amp;(<span class="mxinfo " id="T8:U641"><span class="var type1" id="S99T1U902">i</span>&lt;<span class="mxinfo " id="T1:U643">10</span></span>))</span></span>
<span class="srcline"><span class="lineno"><a href="143,119" id="srcline119">119</a></span><span class="line">            <span class="mxinfo " id="T1:U644"><span class="var type1" id="S99T1U906">i</span>=<span class="mxinfo " id="T1:U646"><span class="var type1" id="S99T1U908">i</span>+<span class="mxinfo " id="T1:U648">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,120" id="srcline120">120</a></span><span class="line">            <span class="mxinfo " id="T1:U649"><span class="var type1" id="S102T1U912">Time</span> = <span class="mxinfo " id="T1:U651"><span class="var type1" id="S54T1U914">PTime</span> + <span class="mxinfo " id="T1:U653">(<span class="var type1" id="S28T1U917">PreTime</span>)*<span class="var type1" id="S99T1U918">i</span></span></span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="143,121" id="srcline121">121</a></span><span class="line">            <span class="mxinfo " id="T1:U656"><span class="var type1" id="S2T1U921">PreTimeAcu</span> = <span class="mxinfo " id="T1:U658">(<span class="var type1" id="S28T1U924">PreTime</span>)*<span class="var type1" id="S99T1U925">i</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,122" id="srcline122">122</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T8:U661"><span class="var type1" id="S15T1U929">StopFlg</span> &lt; <span class="mxinfo " id="T1:U663">0.5</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="143,123" id="srcline123">123</a></span><span class="line">                <span class="keyword">if</span> <span class="mxinfo " id="T8:U664"><span class="var type1" id="S102T1U934">Time</span> &lt;= <span class="var type1" id="S56T1U935">PT_long</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="143,124" id="srcline124">124</a></span><span class="line">                    <span class="keyword">if</span> <span class="mxinfo " id="T8:U667"><span class="mxinfo " id="T1:U668">abs(<span class="mxinfo " id="T1:U669"><span class="var type1" id="S58T1U942">PV_tar</span> - <span class="var type1" id="S57T1U943">PV_me</span></span>)</span> &gt;<span class="mxinfo " id="T1:U672">1e-5</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="143,125" id="srcline125">125</a></span><span class="line">                        <span class="mxinfo " id="T1:U673"><span class="var type1" id="S103T1U947">a_me</span> = <span class="mxinfo " id="T1:U675">(<span class="mxinfo " id="T1:U676"><span class="var type1" id="S58T1U951">PV_tar</span> - <span class="var type1" id="S57T1U952">PV_me</span></span>)/<span class="var type1" id="S56T1U953">PT_long</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,126" id="srcline126">126</a></span><span class="line">                    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,127" id="srcline127">127</a></span><span class="line">                        <span class="mxinfo " id="T1:U680"><span class="var type1" id="S103T1U957">a_me</span> = <span class="mxinfo " id="T1:U682">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,128" id="srcline128">128</a></span><span class="line">                    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,129" id="srcline129">129</a></span><span class="line">                    <span class="mxinfo " id="T1:U683"><span class="var type1" id="S79T1U961">Arc</span> = <span class="mxinfo " id="T1:U685"><span class="mxinfo " id="T1:U686"><span class="var type1" id="S57T1U964">PV_me</span> * <span class="var type1" id="S102T1U965">Time</span></span> + <span class="mxinfo " id="T1:U689"><span class="mxinfo " id="T1:U690"><span class="mxinfo " id="T1:U691">0.5</span> * <span class="var type1" id="S103T1U969">a_me</span></span> * <span class="mxinfo " id="T1:U693"><span class="var type1" id="S102T1U971">Time</span> ^2</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,130" id="srcline130">130</a></span><span class="line">                    <span class="mxinfo " id="T1:U695"><span class="var type1" id="S80T1U975">V_tarPos</span> = <span class="mxinfo " id="T1:U697"><span class="var type1" id="S57T1U977">PV_me</span> + <span class="mxinfo " id="T1:U699"><span class="var type1" id="S102T1U979">Time</span> * <span class="var type1" id="S103T1U980">a_me</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,131" id="srcline131">131</a></span><span class="line">                <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,132" id="srcline132">132</a></span><span class="line">                    <span class="mxinfo " id="T1:U702"><span class="var type1" id="S79T1U984">Arc</span> = <span class="mxinfo " id="T1:U704"><span class="mxinfo " id="T1:U705"><span class="mxinfo " id="T1:U706">(<span class="mxinfo " id="T1:U707"><span class="var type1" id="S57T1U990">PV_me</span> + <span class="var type1" id="S58T1U991">PV_tar</span></span>) /<span class="mxinfo " id="T1:U710">2</span></span> * <span class="var type1" id="S56T1U993">PT_long</span></span> + <span class="mxinfo " id="T1:U712">(<span class="mxinfo " id="T1:U713"><span class="var type1" id="S102T1U997">Time</span> - <span class="var type1" id="S56T1U998">PT_long</span></span>) * <span class="var type1" id="S58T1U999">PV_tar</span></span></span></span>;            </span></span>
<span class="srcline"><span class="lineno"><a href="143,133" id="srcline133">133</a></span><span class="line">                    <span class="mxinfo " id="T1:U717"><span class="var type1" id="S80T1U1002">V_tarPos</span> = <span class="var type1" id="S58T1U1003">PV_tar</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,134" id="srcline134">134</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,135" id="srcline135">135</a></span><span class="line">                <span class="mxinfo " id="T1:U720"><span class="var type1" id="S79T1U1006">Arc</span> = <span class="mxinfo " id="T1:U722"><span class="var type1" id="S79T1U1008">Arc</span> + <span class="var type1" id="S64T1U1009">ArcAdd</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,136" id="srcline136">136</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,137" id="srcline137">137</a></span><span class="line">                <span class="var type1" id="S79T1U1013">Arc</span> = <span class="var type1" id="S62T1U1015">ArcHistory</span> + <span class="var type1" id="S18T1U1016">ArcPre</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,138" id="srcline138">138</a></span><span class="line">                <span class="var type1" id="S80T1U1019">V_tarPos</span> = <span class="var type1" id="S19T1U1020">VPre</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,139" id="srcline139">139</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,140" id="srcline140">140</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T8:U730"><span class="var type1" id="S79T1U1024">Arc</span> &lt;= <span class="mxinfo " id="T1:U732"><span class="var type1" id="S44T33U1026">PArclengthTol</span>(<span class="mxinfo " id="T1:U734">1</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="143,141" id="srcline141">141</a></span><span class="line">                [<span class="var type1" id="S3T1U1031">xpositionPre</span>,<span class="var type1" id="S4T1U1032">ypositionPre</span>,<span class="var type1" id="S9T1U1033">Theta</span>] = <span class="fcn" id="F772N94:B1035">ElementaryPosCal</span>( <span class="var type1" id="S79T1U1036">Arc</span>,<span class="mxinfo " id="T1:U739"><span class="var type1" id="S43T33U1038">PDeltaTemp</span>(<span class="mxinfo " id="T9:U741">1</span>)</span>,<span class="mxinfo " id="T1:U742"><span class="var type1" id="S44T33U1041">PArclengthTol</span>(<span class="mxinfo " id="T9:U744">1</span>)</span>,<span class="var type1" id="S45T1U1043">Ptheta_qitemp</span>,<span class="var type1" id="S46T1U1044">Pangle_in</span>,<span class="var type1" id="S47T1U1045">Px_in</span>,<span class="var type1" id="S48T1U1046">Py_in</span>,<span class="var type1" id="S49T1U1047">Px_qitemp</span>,<span class="var type1" id="S50T1U1048">Py_qitemp</span> );</span></span>
<span class="srcline"><span class="lineno"><a href="143,142" id="srcline142">142</a></span><span class="line">                <span class="keyword">if</span> <span class="mxinfo " id="T8:U751"><span class="var type1" id="S3T1U1052">xpositionPre</span> &gt; <span class="mxinfo " id="T1:U753">50</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="143,143" id="srcline143">143</a></span><span class="line">                <span class="mxinfo " id="T1:U754"><span class="var type1" id="S3T1U1056">xpositionPre</span> = <span class="var type1" id="S3T1U1057">xpositionPre</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,144" id="srcline144">144</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,145" id="srcline145">145</a></span><span class="line">                <span class="keyword">if</span> <span class="mxinfo " id="T8:U757"><span class="var type1" id="S79T1U1061">Arc</span> &lt;= <span class="mxinfo " id="T1:U759"><span class="mxinfo " id="T1:U760"><span class="var type1" id="S44T33U1064">PArclengthTol</span>(<span class="mxinfo " id="T9:U762">1</span>)</span>/<span class="mxinfo " id="T1:U763">2</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="143,146" id="srcline146">146</a></span><span class="line">                    <span class="mxinfo " id="T1:U764"><span class="var type1" id="S100T1U1069">Kur</span> = <span class="mxinfo " id="T1:U766"><span class="var type1" id="S79T1U1071">Arc</span> * <span class="mxinfo " id="T1:U768"><span class="var type1" id="S43T33U1073">PDeltaTemp</span>(<span class="mxinfo " id="T1:U770">1</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,147" id="srcline147">147</a></span><span class="line">                <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,148" id="srcline148">148</a></span><span class="line">                    <span class="mxinfo " id="T1:U771"><span class="var type1" id="S100T1U1078">Kur</span> = <span class="mxinfo " id="T1:U773"><span class="mxinfo " id="T1:U774"><span class="mxinfo " id="T1:U775"><span class="var type1" id="S43T33U1082">PDeltaTemp</span>(<span class="mxinfo " id="T1:U777">1</span>)</span> * <span class="var type1" id="S79T1U1084">Arc</span></span> - <span class="mxinfo " id="T1:U779"><span class="mxinfo " id="T1:U780"><span class="mxinfo " id="T1:U781"><span class="var type1" id="S44T33U1088">PArclengthTol</span>(<span class="mxinfo " id="T9:U783">1</span>)</span>/<span class="mxinfo " id="T1:U784">2</span></span> * <span class="mxinfo " id="T1:U785"><span class="var type1" id="S43T33U1092">PDeltaTemp</span>(<span class="mxinfo " id="T1:U787">1</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,149" id="srcline149">149</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,150" id="srcline150">150</a></span><span class="line">                <span class="mxinfo " id="T1:U788"><span class="var type1" id="S60T1U1096">Pxposition</span> = <span class="var type1" id="S3T1U1097">xpositionPre</span></span>;<span class="mxinfo " id="T1:U791"><span class="var type1" id="S61T1U1100">Pyposition</span> = <span class="var type1" id="S4T1U1101">ypositionPre</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,151" id="srcline151">151</a></span><span class="line">            <span class="keyword">elseif</span> <span class="mxinfo " id="T8:U794"><span class="var type1" id="S79T1U1104">Arc</span> &lt;= (<span class="mxinfo " id="T1:U796"><span class="mxinfo " id="T1:U797"><span class="var type1" id="S44T33U1108">PArclengthTol</span>(<span class="mxinfo " id="T1:U799">1</span>)</span>+<span class="mxinfo " id="T1:U800"><span class="var type1" id="S44T33U1111">PArclengthTol</span>(<span class="mxinfo " id="T1:U802">2</span>)</span></span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,152" id="srcline152">152</a></span><span class="line">                <span class="mxinfo " id="T1:U803"><span class="var type1" id="S79T1U1115">Arc</span> = <span class="mxinfo " id="T1:U805"><span class="var type1" id="S79T1U1117">Arc</span> - <span class="mxinfo " id="T1:U807"><span class="var type1" id="S44T33U1119">PArclengthTol</span>(<span class="mxinfo " id="T1:U809">1</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,153" id="srcline153">153</a></span><span class="line">                [<span class="var type1" id="S3T1U1124">xpositionPre</span>,<span class="var type1" id="S4T1U1125">ypositionPre</span>,<span class="var type1" id="S9T1U1126">Theta</span>] = <span class="fcn" id="F772N94:B1128">ElementaryPosCal</span>( <span class="var type1" id="S79T1U1129">Arc</span>,<span class="mxinfo " id="T1:U814"><span class="var type1" id="S43T33U1131">PDeltaTemp</span>(<span class="mxinfo " id="T9:U816">2</span>)</span>,<span class="mxinfo " id="T1:U817"><span class="var type1" id="S44T33U1134">PArclengthTol</span>(<span class="mxinfo " id="T9:U819">2</span>)</span>,<span class="var type1" id="S51T1U1136">Pangle_out</span>,<span class="var type1" id="S45T1U1137">Ptheta_qitemp</span>,<span class="var type1" id="S49T1U1138">Px_qitemp</span>,<span class="var type1" id="S50T1U1139">Py_qitemp</span>,<span class="var type1" id="S52T1U1140">Px_out</span>,<span class="var type1" id="S53T1U1141">Py_out</span> );</span></span>
<span class="srcline"><span class="lineno"><a href="143,154" id="srcline154">154</a></span><span class="line">                <span class="keyword">if</span> <span class="mxinfo " id="T8:U826"><span class="var type1" id="S79T1U1145">Arc</span> &lt;= <span class="mxinfo " id="T1:U828"><span class="mxinfo " id="T1:U829"><span class="var type1" id="S44T33U1148">PArclengthTol</span>(<span class="mxinfo " id="T9:U831">2</span>)</span>/<span class="mxinfo " id="T1:U832">2</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="143,155" id="srcline155">155</a></span><span class="line">                    <span class="mxinfo " id="T1:U833"><span class="var type1" id="S100T1U1153">Kur</span> = <span class="mxinfo " id="T1:U835"><span class="var type1" id="S79T1U1155">Arc</span> * <span class="mxinfo " id="T1:U837"><span class="var type1" id="S43T33U1157">PDeltaTemp</span>(<span class="mxinfo " id="T1:U839">2</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,156" id="srcline156">156</a></span><span class="line">                <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,157" id="srcline157">157</a></span><span class="line">                    <span class="mxinfo " id="T1:U840"><span class="var type1" id="S100T1U1162">Kur</span> = <span class="mxinfo " id="T1:U842"><span class="mxinfo " id="T1:U843"><span class="mxinfo " id="T1:U844"><span class="var type1" id="S43T33U1166">PDeltaTemp</span>(<span class="mxinfo " id="T1:U846">2</span>)</span> * <span class="var type1" id="S79T1U1168">Arc</span></span> - <span class="mxinfo " id="T1:U848"><span class="mxinfo " id="T1:U849"><span class="mxinfo " id="T1:U850"><span class="var type1" id="S44T33U1172">PArclengthTol</span>(<span class="mxinfo " id="T9:U852">2</span>)</span>/<span class="mxinfo " id="T1:U853">2</span></span> * <span class="mxinfo " id="T1:U854"><span class="var type1" id="S43T33U1176">PDeltaTemp</span>(<span class="mxinfo " id="T1:U856">2</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,158" id="srcline158">158</a></span><span class="line">                <span class="keyword">end</span>            </span></span>
<span class="srcline"><span class="lineno"><a href="143,159" id="srcline159">159</a></span><span class="line">                <span class="mxinfo " id="T1:U857"><span class="var type1" id="S60T1U1180">Pxposition</span> = <span class="var type1" id="S3T1U1181">xpositionPre</span></span>;<span class="mxinfo " id="T1:U860"><span class="var type1" id="S61T1U1184">Pyposition</span> = <span class="var type1" id="S4T1U1185">ypositionPre</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,160" id="srcline160">160</a></span><span class="line">            <span class="keyword">else</span>            </span></span>
<span class="srcline"><span class="lineno"><a href="143,161" id="srcline161">161</a></span><span class="line">                <span class="mxinfo " id="T1:U863"><span class="var type1" id="S79T1U1189">Arc</span> = <span class="mxinfo " id="T1:U865"><span class="mxinfo " id="T1:U866"><span class="var type1" id="S79T1U1192">Arc</span> - <span class="mxinfo " id="T1:U868"><span class="var type1" id="S44T33U1194">PArclengthTol</span>(<span class="mxinfo " id="T1:U870">1</span>)</span></span> - <span class="mxinfo " id="T1:U871"><span class="var type1" id="S44T33U1197">PArclengthTol</span>(<span class="mxinfo " id="T1:U873">2</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,162" id="srcline162">162</a></span><span class="line">    <span class="comment">%             if Time &gt; PT_long</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,163" id="srcline163">163</a></span><span class="line">                    <span class="mxinfo " id="T1:U874"><span class="var type1" id="S3T1U1201">xpositionPre</span> = <span class="mxinfo " id="T1:U876"><span class="var type1" id="S52T1U1203">Px_out</span> + <span class="mxinfo " id="T1:U878"><span class="var type1" id="S79T1U1205">Arc</span> * <span class="mxinfo " id="T1:U880">cos(<span class="var type1" id="S51T1U1208">Pangle_out</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,164" id="srcline164">164</a></span><span class="line">                    <span class="mxinfo " id="T1:U882"><span class="var type1" id="S4T1U1211">ypositionPre</span> = <span class="mxinfo " id="T1:U884"><span class="var type1" id="S53T1U1213">Py_out</span> + <span class="mxinfo " id="T1:U886"><span class="var type1" id="S79T1U1215">Arc</span> * <span class="mxinfo " id="T1:U888">sin(<span class="var type1" id="S51T1U1218">Pangle_out</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,165" id="srcline165">165</a></span><span class="line">    <span class="comment">%             else                </span></span></span>
<span class="srcline"><span class="lineno"><a href="143,166" id="srcline166">166</a></span><span class="line">    <span class="comment">%             end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,167" id="srcline167">167</a></span><span class="line">                <span class="comment">% Straight line preview point calculate;</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,168" id="srcline168">168</a></span><span class="line">                <span class="mxinfo " id="T1:U890"><span class="var type1" id="S9T1U1221">Theta</span> = <span class="mxinfo " id="T1:U892">0</span></span>;<span class="mxinfo " id="T1:U893"><span class="var type1" id="S100T1U1225">Kur</span> = <span class="mxinfo " id="T1:U895">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,169" id="srcline169">169</a></span><span class="line">            <span class="keyword">end</span>            </span></span>
<span class="srcline"><span class="lineno"><a href="143,170" id="srcline170">170</a></span><span class="line">            <span class="mxinfo " id="T1:U896"><span class="var type1" id="S107T1U1229">PreDistheta_rot</span> = <span class="mxinfo " id="T1:U898"><span class="var type1" id="S27T10U1231">Info_Me</span>(<span class="mxinfo " id="T9:U900">6</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,171" id="srcline171">171</a></span><span class="line">            <span class="mxinfo " id="T1:U901"><span class="var type1" id="S101T1U1235">PreDis</span> = <span class="mxinfo " id="T1:U903"><span class="mxinfo " id="T1:U904">(<span class="mxinfo " id="T1:U905"><span class="var type1" id="S3T1U1240">xpositionPre</span> - <span class="mxinfo " id="T1:U907"><span class="var type1" id="S27T10U1242">Info_Me</span>(<span class="mxinfo " id="T1:U909">1</span>)</span></span>)*<span class="mxinfo " id="T1:U910">cos(<span class="var type1" id="S107T1U1246">PreDistheta_rot</span>)</span></span> + <span class="mxinfo " id="T1:U912">(<span class="mxinfo " id="T1:U913"><span class="var type1" id="S4T1U1250">ypositionPre</span> - <span class="mxinfo " id="T1:U915"><span class="var type1" id="S27T10U1252">Info_Me</span>(<span class="mxinfo " id="T1:U917">2</span>)</span></span>)*<span class="mxinfo " id="T1:U918">sin(<span class="var type1" id="S107T1U1256">PreDistheta_rot</span>)</span></span></span></span>;     </span></span>
<span class="srcline"><span class="lineno"><a href="143,172" id="srcline172">172</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,173" id="srcline173">173</a></span><span class="line">        <span class="mxinfo " id="T1:U920"><span class="var type1" id="S7T1U1259">Vx</span> = <span class="mxinfo " id="T1:U922"><span class="var type1" id="S80T1U1261">V_tarPos</span> * <span class="mxinfo " id="T1:U924">cos(<span class="var type1" id="S9T1U1264">Theta</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,174" id="srcline174">174</a></span><span class="line">        <span class="mxinfo " id="T1:U926"><span class="var type1" id="S8T1U1267">Vy</span> = <span class="mxinfo " id="T1:U928"><span class="var type1" id="S80T1U1269">V_tarPos</span> * <span class="mxinfo " id="T1:U930">sin(<span class="var type1" id="S9T1U1272">Theta</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,175" id="srcline175">175</a></span><span class="line">        <span class="mxinfo " id="T1:U932"><span class="var type1" id="S108T1U1275">Arel</span> = <span class="mxinfo " id="T1:U934"><span class="mxinfo " id="T1:U935"><span class="var type1" id="S80T1U1278">V_tarPos</span>^2</span> * <span class="var type1" id="S100T1U1280">Kur</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,176" id="srcline176">176</a></span><span class="line">        <span class="mxinfo " id="T1:U938"><span class="var type1" id="S5T1U1283">Ax</span> = <span class="mxinfo " id="T1:U940"><span class="var type1" id="S108T1U1285">Arel</span> * <span class="mxinfo " id="T1:U942">cos(<span class="var type1" id="S9T1U1288">Theta</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,177" id="srcline177">177</a></span><span class="line">        <span class="mxinfo " id="T1:U944"><span class="var type1" id="S6T1U1291">Ay</span> = <span class="mxinfo " id="T1:U946"><span class="var type1" id="S108T1U1293">Arel</span> * <span class="mxinfo " id="T1:U948">sin(<span class="var type1" id="S9T1U1296">Theta</span>)</span></span></span>;          </span></span>
<span class="srcline"><span class="lineno"><a href="143,178" id="srcline178">178</a></span><span class="line">        <span class="keyword">if</span> (<span class="mxinfo " id="T8:U950"><span class="var type1" id="S101T1U1303">PreDis</span>&lt;<span class="mxinfo " id="T1:U952">0.5</span></span>)&amp;&amp;(<span class="mxinfo " id="T8:U953"><span class="var type1" id="S32T1U1307">SimpleStop</span>&gt;<span class="mxinfo " id="T1:U955">0.5</span></span>)&amp;&amp;(<span class="var type1" id="S15T1U1311">StopFlg</span>&gt;0.5)</span></span>
<span class="srcline"><span class="lineno"><a href="143,179" id="srcline179">179</a></span><span class="line">            <span class="var type1" id="S3T1U1315">xpositionPre</span> = <span class="var type1" id="S27T10U1318">Info_Me</span>(1) + <span class="var type1" id="S18T1U1321">ArcPre</span>*cos(<span class="var type1" id="S27T10U1325">Info_Me</span>(6));</span></span>
<span class="srcline"><span class="lineno"><a href="143,180" id="srcline180">180</a></span><span class="line">            <span class="var type1" id="S4T1U1329">ypositionPre</span> = <span class="var type1" id="S27T10U1332">Info_Me</span>(2) + <span class="var type1" id="S18T1U1335">ArcPre</span>*sin(<span class="var type1" id="S27T10U1339">Info_Me</span>(6));</span></span>
<span class="srcline"><span class="lineno"><a href="143,181" id="srcline181">181</a></span><span class="line">            <span class="var type1" id="S7T1U1343">Vx</span> = 0;<span class="var type1" id="S8T1U1347">Vy</span> = 0;<span class="var type1" id="S9T1U1351">Theta</span> = <span class="var type1" id="S27T10U1353">Info_Me</span>(6);</span></span>
<span class="srcline"><span class="lineno"><a href="143,182" id="srcline182">182</a></span><span class="line">        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,183" id="srcline183">183</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,184" id="srcline184">184</a></span><span class="line">        <span class="comment">%To cal next point</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,185" id="srcline185">185</a></span><span class="line">        <span class="mxinfo " id="T1:U969"><span class="var type1" id="S102T1U1358">Time</span> = <span class="mxinfo " id="T1:U971"><span class="var type1" id="S54T1U1360">PTime</span> + <span class="mxinfo " id="T1:U973">0.01</span></span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="143,186" id="srcline186">186</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T8:U974"><span class="var type1" id="S15T1U1365">StopFlg</span> &lt; <span class="mxinfo " id="T1:U976">0.5</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="143,187" id="srcline187">187</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T8:U977"><span class="var type1" id="S102T1U1370">Time</span> &lt;= <span class="var type1" id="S56T1U1371">PT_long</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="143,188" id="srcline188">188</a></span><span class="line">                <span class="keyword">if</span> <span class="mxinfo " id="T8:U980"><span class="mxinfo " id="T1:U981">abs(<span class="mxinfo " id="T1:U982"><span class="var type1" id="S58T1U1378">PV_tar</span> - <span class="var type1" id="S57T1U1379">PV_me</span></span>)</span> &gt;<span class="mxinfo " id="T1:U985">1e-5</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="143,189" id="srcline189">189</a></span><span class="line">                    <span class="mxinfo " id="T1:U986"><span class="var type1" id="S103T1U1383">a_me</span> = <span class="mxinfo " id="T1:U988">(<span class="mxinfo " id="T1:U989"><span class="var type1" id="S58T1U1387">PV_tar</span> - <span class="var type1" id="S57T1U1388">PV_me</span></span>)/<span class="var type1" id="S56T1U1389">PT_long</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,190" id="srcline190">190</a></span><span class="line">                <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,191" id="srcline191">191</a></span><span class="line">                    <span class="mxinfo " id="T1:U993"><span class="var type1" id="S103T1U1393">a_me</span> = <span class="mxinfo " id="T1:U995">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,192" id="srcline192">192</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,193" id="srcline193">193</a></span><span class="line">                <span class="mxinfo " id="T1:U996"><span class="var type1" id="S79T1U1397">Arc</span> = <span class="mxinfo " id="T1:U998"><span class="mxinfo " id="T1:U999"><span class="var type1" id="S57T1U1400">PV_me</span> * <span class="var type1" id="S102T1U1401">Time</span></span> + <span class="mxinfo " id="T1:U1002"><span class="mxinfo " id="T1:U1003"><span class="mxinfo " id="T1:U1004">0.5</span> * <span class="var type1" id="S103T1U1405">a_me</span></span> * <span class="mxinfo " id="T1:U1006"><span class="var type1" id="S102T1U1407">Time</span> ^2</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,194" id="srcline194">194</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,195" id="srcline195">195</a></span><span class="line">                <span class="mxinfo " id="T1:U1008"><span class="var type1" id="S79T1U1412">Arc</span> = <span class="mxinfo " id="T1:U1010"><span class="mxinfo " id="T1:U1011"><span class="mxinfo " id="T1:U1012">(<span class="mxinfo " id="T1:U1013"><span class="var type1" id="S57T1U1418">PV_me</span> + <span class="var type1" id="S58T1U1419">PV_tar</span></span>) /<span class="mxinfo " id="T1:U1016">2</span></span> * <span class="var type1" id="S56T1U1421">PT_long</span></span> + <span class="mxinfo " id="T1:U1018">(<span class="mxinfo " id="T1:U1019"><span class="var type1" id="S102T1U1425">Time</span> - <span class="var type1" id="S56T1U1426">PT_long</span></span>) * <span class="var type1" id="S58T1U1427">PV_tar</span></span></span></span>;            </span></span>
<span class="srcline"><span class="lineno"><a href="143,196" id="srcline196">196</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,197" id="srcline197">197</a></span><span class="line">            <span class="mxinfo " id="T1:U1023"><span class="var type1" id="S79T1U1430">Arc</span> = <span class="mxinfo " id="T1:U1025"><span class="var type1" id="S79T1U1432">Arc</span> + <span class="var type1" id="S64T1U1433">ArcAdd</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,198" id="srcline198">198</a></span><span class="line">            <span class="mxinfo " id="T1:U1028"><span class="var type1" id="S62T1U1436">ArcHistory</span> = <span class="var type1" id="S79T1U1437">Arc</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,199" id="srcline199">199</a></span><span class="line">        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,200" id="srcline200">200</a></span><span class="line">            <span class="var type1" id="S79T1U1441">Arc</span> = <span class="var type1" id="S62T1U1443">ArcHistory</span> + <span class="var type1" id="S17T1U1444">ArcNex</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,201" id="srcline201">201</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="143,202" id="srcline202">202</a></span><span class="line">            <span class="var type1" id="S62T1U1447">ArcHistory</span> = <span class="var type1" id="S79T1U1448">Arc</span>; </span></span>
<span class="srcline"><span class="lineno"><a href="143,203" id="srcline203">203</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,204" id="srcline204">204</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="143,205" id="srcline205">205</a></span><span class="line">        <span class="keyword">if</span> (<span class="mxinfo " id="T8:U1036"><span class="var type1" id="S32T1U1454">SimpleStop</span>&gt;<span class="mxinfo " id="T1:U1038">0.5</span></span>)&amp;&amp;(<span class="var type1" id="S15T1U1458">StopFlg</span>&gt;0.5)</span></span>
<span class="srcline"><span class="lineno"><a href="143,206" id="srcline206">206</a></span><span class="line">            <span class="var type1" id="S109T1U1462">xpositionNexLo</span> = <span class="var type1" id="S27T10U1465">Info_Me</span>(1) + <span class="var type1" id="S17T1U1468">ArcNex</span>*cos(<span class="var type1" id="S27T10U1472">Info_Me</span>(6));</span></span>
<span class="srcline"><span class="lineno"><a href="143,207" id="srcline207">207</a></span><span class="line">            <span class="var type1" id="S110T1U1476">ypositionNexLo</span> = <span class="var type1" id="S27T10U1479">Info_Me</span>(2) + <span class="var type1" id="S17T1U1482">ArcNex</span>*sin(<span class="var type1" id="S27T10U1486">Info_Me</span>(6));            </span></span>
<span class="srcline"><span class="lineno"><a href="143,208" id="srcline208">208</a></span><span class="line">        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,209" id="srcline209">209</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T8:U1048"><span class="var type1" id="S79T1U1492">Arc</span> &lt;= <span class="mxinfo " id="T1:U1050"><span class="var type1" id="S44T33U1494">PArclengthTol</span>(<span class="mxinfo " id="T1:U1052">1</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="143,210" id="srcline210">210</a></span><span class="line">                [<span class="var type1" id="S109T1U1499">xpositionNexLo</span>,<span class="var type1" id="S110T1U1500">ypositionNexLo</span>,<span class="var type1" id="S76T1U1501">ThetaNex</span>] = <span class="fcn" id="F772N94:B1503">ElementaryPosCal</span>( <span class="var type1" id="S79T1U1504">Arc</span>,<span class="mxinfo " id="T1:U1057"><span class="var type1" id="S43T33U1506">PDeltaTemp</span>(<span class="mxinfo " id="T9:U1059">1</span>)</span>,<span class="mxinfo " id="T1:U1060"><span class="var type1" id="S44T33U1509">PArclengthTol</span>(<span class="mxinfo " id="T9:U1062">1</span>)</span>,<span class="var type1" id="S45T1U1511">Ptheta_qitemp</span>,<span class="var type1" id="S46T1U1512">Pangle_in</span>,<span class="var type1" id="S47T1U1513">Px_in</span>,<span class="var type1" id="S48T1U1514">Py_in</span>,<span class="var type1" id="S49T1U1515">Px_qitemp</span>,<span class="var type1" id="S50T1U1516">Py_qitemp</span> );</span></span>
<span class="srcline"><span class="lineno"><a href="143,211" id="srcline211">211</a></span><span class="line">    <span class="comment">%             Pxposition = xpositionPre;Pyposition = ypositionPre;</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,212" id="srcline212">212</a></span><span class="line">            <span class="keyword">elseif</span> <span class="mxinfo " id="T8:U1069"><span class="var type1" id="S79T1U1519">Arc</span> &lt;= (<span class="mxinfo " id="T1:U1071"><span class="mxinfo " id="T1:U1072"><span class="var type1" id="S44T33U1523">PArclengthTol</span>(<span class="mxinfo " id="T1:U1074">1</span>)</span>+<span class="mxinfo " id="T1:U1075"><span class="var type1" id="S44T33U1526">PArclengthTol</span>(<span class="mxinfo " id="T1:U1077">2</span>)</span></span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,213" id="srcline213">213</a></span><span class="line">                <span class="mxinfo " id="T1:U1078"><span class="var type1" id="S79T1U1530">Arc</span> = <span class="mxinfo " id="T1:U1080"><span class="var type1" id="S79T1U1532">Arc</span> - <span class="mxinfo " id="T1:U1082"><span class="var type1" id="S44T33U1534">PArclengthTol</span>(<span class="mxinfo " id="T1:U1084">1</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,214" id="srcline214">214</a></span><span class="line">                [<span class="var type1" id="S109T1U1539">xpositionNexLo</span>,<span class="var type1" id="S110T1U1540">ypositionNexLo</span>,<span class="var type1" id="S76T1U1541">ThetaNex</span>] = <span class="fcn" id="F772N94:B1543">ElementaryPosCal</span>( <span class="var type1" id="S79T1U1544">Arc</span>,<span class="mxinfo " id="T1:U1089"><span class="var type1" id="S43T33U1546">PDeltaTemp</span>(<span class="mxinfo " id="T9:U1091">2</span>)</span>,<span class="mxinfo " id="T1:U1092"><span class="var type1" id="S44T33U1549">PArclengthTol</span>(<span class="mxinfo " id="T9:U1094">2</span>)</span>,<span class="var type1" id="S51T1U1551">Pangle_out</span>,<span class="var type1" id="S45T1U1552">Ptheta_qitemp</span>,<span class="var type1" id="S49T1U1553">Px_qitemp</span>,<span class="var type1" id="S50T1U1554">Py_qitemp</span>,<span class="var type1" id="S52T1U1555">Px_out</span>,<span class="var type1" id="S53T1U1556">Py_out</span> );      </span></span>
<span class="srcline"><span class="lineno"><a href="143,215" id="srcline215">215</a></span><span class="line">    <span class="comment">%             Pxposition = xpositionPre;Pyposition = ypositionPre;</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,216" id="srcline216">216</a></span><span class="line">            <span class="keyword">else</span>            </span></span>
<span class="srcline"><span class="lineno"><a href="143,217" id="srcline217">217</a></span><span class="line">                <span class="mxinfo " id="T1:U1101"><span class="var type1" id="S79T1U1560">Arc</span> = <span class="mxinfo " id="T1:U1103"><span class="mxinfo " id="T1:U1104"><span class="var type1" id="S79T1U1563">Arc</span> - <span class="mxinfo " id="T1:U1106"><span class="var type1" id="S44T33U1565">PArclengthTol</span>(<span class="mxinfo " id="T1:U1108">1</span>)</span></span> - <span class="mxinfo " id="T1:U1109"><span class="var type1" id="S44T33U1568">PArclengthTol</span>(<span class="mxinfo " id="T1:U1111">2</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,218" id="srcline218">218</a></span><span class="line">    <span class="comment">%             if Time &gt; PT_long</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,219" id="srcline219">219</a></span><span class="line">                    <span class="mxinfo " id="T1:U1112"><span class="var type1" id="S109T1U1572">xpositionNexLo</span> = <span class="mxinfo " id="T1:U1114"><span class="var type1" id="S52T1U1574">Px_out</span> + <span class="mxinfo " id="T1:U1116"><span class="var type1" id="S79T1U1576">Arc</span> * <span class="mxinfo " id="T1:U1118">cos(<span class="var type1" id="S51T1U1579">Pangle_out</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,220" id="srcline220">220</a></span><span class="line">                    <span class="mxinfo " id="T1:U1120"><span class="var type1" id="S110T1U1582">ypositionNexLo</span> = <span class="mxinfo " id="T1:U1122"><span class="var type1" id="S53T1U1584">Py_out</span> + <span class="mxinfo " id="T1:U1124"><span class="var type1" id="S79T1U1586">Arc</span> * <span class="mxinfo " id="T1:U1126">sin(<span class="var type1" id="S51T1U1589">Pangle_out</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,221" id="srcline221">221</a></span><span class="line">    <span class="comment">%             else                </span></span></span>
<span class="srcline"><span class="lineno"><a href="143,222" id="srcline222">222</a></span><span class="line">    <span class="comment">%             end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,223" id="srcline223">223</a></span><span class="line">                <span class="comment">% Straight line preview point calculate;</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,224" id="srcline224">224</a></span><span class="line"><span class="comment">%                 if PathPlanRes &lt; 1e-1 </span></span></span>
<span class="srcline"><span class="lineno"><a href="143,225" id="srcline225">225</a></span><span class="line"><span class="comment">%                     if LCTransEn &lt; 0.5</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,226" id="srcline226">226</a></span><span class="line"><span class="comment">%                         PointCalEn = 0;PrePointCalEn = 0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,227" id="srcline227">227</a></span><span class="line"><span class="comment">%                     else</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,228" id="srcline228">228</a></span><span class="line"><span class="comment">%                         PInLaneLCTrans = 1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,229" id="srcline229">229</a></span><span class="line"><span class="comment">%                         PathPlanSucFlg = 1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,230" id="srcline230">230</a></span><span class="line"><span class="comment">%                     end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,231" id="srcline231">231</a></span><span class="line"><span class="comment">%                 end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,232" id="srcline232">232</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="143,233" id="srcline233">233</a></span><span class="line">                <span class="keyword">if</span> <span class="mxinfo " id="T8:U1128"><span class="var type1" id="S39T1U1593">LCTransEn</span> &lt; <span class="mxinfo " id="T1:U1130">0.5</span></span> </span></span>
<span class="srcline"><span class="lineno"><a href="143,234" id="srcline234">234</a></span><span class="line">                    <span class="keyword">if</span> <span class="mxinfo " id="T8:U1131"><span class="var type1" id="S29T1U1598">PathPlanRes</span> &lt; <span class="mxinfo " id="T1:U1133">1e-1</span></span> </span></span>
<span class="srcline"><span class="lineno"><a href="143,235" id="srcline235">235</a></span><span class="line">                        <span class="mxinfo " id="T1:U1134"><span class="var type1" id="S42T1U1602">PointCalEn</span> = <span class="mxinfo " id="T1:U1136">0</span></span>;<span class="mxinfo " id="T1:U1137"><span class="var type1" id="S41T1U1606">PrePointCalEn</span> = <span class="mxinfo " id="T1:U1139">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,236" id="srcline236">236</a></span><span class="line">                    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,237" id="srcline237">237</a></span><span class="line">                <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,238" id="srcline238">238</a></span><span class="line">                    <span class="mxinfo " id="T1:U1140"><span class="var type1" id="S66T1U1611">PInLaneLCTrans</span> = <span class="mxinfo " id="T1:U1142">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,239" id="srcline239">239</a></span><span class="line">                    <span class="mxinfo " id="T1:U1143"><span class="var type1" id="S12T1U1615">PathPlanSucFlg</span> = <span class="mxinfo " id="T1:U1145">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,240" id="srcline240">240</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,241" id="srcline241">241</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="143,242" id="srcline242">242</a></span><span class="line">                <span class="mxinfo " id="T1:U1146"><span class="var type1" id="S13T1U1619">PathTrjFinishFlg</span> = <span class="mxinfo " id="T1:U1148">1</span></span>;	    </span></span>
<span class="srcline"><span class="lineno"><a href="143,243" id="srcline243">243</a></span><span class="line">            <span class="keyword">end</span> </span></span>
<span class="srcline"><span class="lineno"><a href="143,244" id="srcline244">244</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,245" id="srcline245">245</a></span><span class="line">        <span class="mxinfo " id="T1:U1149"><span class="var type1" id="S10T1U1623">xpositionNex</span> = <span class="var type1" id="S69T1U1624">PxpositionNex</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,246" id="srcline246">246</a></span><span class="line">        <span class="mxinfo " id="T1:U1152"><span class="var type1" id="S11T1U1627">ypositionNex</span> = <span class="var type1" id="S70T1U1628">PypositionNex</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,247" id="srcline247">247</a></span><span class="line">        <span class="mxinfo " id="T1:U1155"><span class="var type1" id="S69T1U1631">PxpositionNex</span> = <span class="var type1" id="S109T1U1632">xpositionNexLo</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,248" id="srcline248">248</a></span><span class="line">        <span class="mxinfo " id="T1:U1158"><span class="var type1" id="S70T1U1635">PypositionNex</span> = <span class="var type1" id="S110T1U1636">ypositionNexLo</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,249" id="srcline249">249</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T8:U1161"><span class="var type1" id="S68T1U1640">PToLeftOrRight</span> &gt; <span class="mxinfo " id="T1:U1163">1e-1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="143,250" id="srcline250">250</a></span><span class="line">        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,251" id="srcline251">251</a></span><span class="line">            <span class="mxinfo " id="T1:U1164"><span class="var type1" id="S4T1U1645">ypositionPre</span> = <span class="mxinfo " id="T1:U1166">-<span class="var type1" id="S4T1U1647">ypositionPre</span></span></span>;<span class="mxinfo " id="T1:U1168"><span class="var type1" id="S6T1U1650">Ay</span> = <span class="mxinfo " id="T1:U1170">-<span class="var type1" id="S6T1U1652">Ay</span></span></span>;<span class="mxinfo " id="T1:U1172"><span class="var type1" id="S8T1U1655">Vy</span> = <span class="mxinfo " id="T1:U1174">-<span class="var type1" id="S8T1U1657">Vy</span></span></span>;<span class="mxinfo " id="T1:U1176"><span class="var type1" id="S9T1U1660">Theta</span> = <span class="mxinfo " id="T1:U1178">- <span class="var type1" id="S9T1U1662">Theta</span></span></span>;<span class="mxinfo " id="T1:U1180"><span class="var type1" id="S11T1U1665">ypositionNex</span> = <span class="mxinfo " id="T1:U1182">-<span class="var type1" id="S11T1U1667">ypositionNex</span></span></span>;            </span></span>
<span class="srcline"><span class="lineno"><a href="143,252" id="srcline252">252</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,253" id="srcline253">253</a></span><span class="line">        <span class="mxinfo " id="T1:U1184"><span class="var type1" id="S14T1U1670">LCInTransState</span> = <span class="var type1" id="S66T1U1671">PInLaneLCTrans</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,254" id="srcline254">254</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,255" id="srcline255">255</a></span><span class="line"><span class="keyword">end</span> </span></span>
<span class="srcline"><span class="lineno"><a href="143,256" id="srcline256">256</a></span><span class="line">    </span></span>
</pre>
<div class="dead">
<pre class="code">
<span class="srcline"><span class="lineno"><a href="143,257" id="srcline257">257</a></span><span class="line">function [xposition,yposition,Theta] = ElementaryPosCal( Arc,Delta,Arclength,angle_out,angle_in,x_in,y_in,x_out,y_out )</span></span>
<span class="srcline"><span class="lineno"><a href="143,258" id="srcline258">258</a></span><span class="line"><span class="comment">%UNTITLED Summary of this function goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,259" id="srcline259">259</a></span><span class="line"><span class="comment">%   Detailed explanation goes here   </span></span></span>
<span class="srcline"><span class="lineno"><a href="143,260" id="srcline260">260</a></span><span class="line">    Beta = (angle_out - angle_in)/2;</span></span>
<span class="srcline"><span class="lineno"><a href="143,261" id="srcline261">261</a></span><span class="line">    theta_rot = angle_in;</span></span>
<span class="srcline"><span class="lineno"><a href="143,262" id="srcline262">262</a></span><span class="line">    x_outRot = (x_out - x_in)*cos(theta_rot) + (y_out - y_in)*sin(theta_rot);</span></span>
<span class="srcline"><span class="lineno"><a href="143,263" id="srcline263">263</a></span><span class="line">    y_outRot = (y_out - y_in)*cos(theta_rot) - (x_out - x_in)*sin(theta_rot);    </span></span>
<span class="srcline"><span class="lineno"><a href="143,264" id="srcline264">264</a></span><span class="line">    if Beta == 0</span></span>
<span class="srcline"><span class="lineno"><a href="143,265" id="srcline265">265</a></span><span class="line">        SignBeta = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="143,266" id="srcline266">266</a></span><span class="line">    else</span></span>
<span class="srcline"><span class="lineno"><a href="143,267" id="srcline267">267</a></span><span class="line">        SignBeta = sign(Beta);</span></span>
<span class="srcline"><span class="lineno"><a href="143,268" id="srcline268">268</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="143,269" id="srcline269">269</a></span><span class="line">    if Arc &lt; Arclength/2    </span></span>
<span class="srcline"><span class="lineno"><a href="143,270" id="srcline270">270</a></span><span class="line">        ulimit = Arc * sqrt(abs(Delta)/2);</span></span>
<span class="srcline"><span class="lineno"><a href="143,271" id="srcline271">271</a></span><span class="line">        Theta = Delta * (Arc)^2/2;</span></span>
<span class="srcline"><span class="lineno"><a href="143,272" id="srcline272">272</a></span><span class="line">        xpositionTemp = sqrt(2/abs(Delta))*quadcosu2(ulimit);</span></span>
<span class="srcline"><span class="lineno"><a href="143,273" id="srcline273">273</a></span><span class="line">        ypositionTemp = sqrt(2/abs(Delta))*quadsinu2(ulimit) * SignBeta;</span></span>
<span class="srcline"><span class="lineno"><a href="143,274" id="srcline274">274</a></span><span class="line">    else</span></span>
<span class="srcline"><span class="lineno"><a href="143,275" id="srcline275">275</a></span><span class="line">        ulimit = (Arclength - Arc) * sqrt(abs(Delta)/2); </span></span>
<span class="srcline"><span class="lineno"><a href="143,276" id="srcline276">276</a></span><span class="line">        <span class="comment">%Theta = 2*Beta*SignBeta - Delta * (Arclength - Arc)^2/2; </span></span></span>
<span class="srcline"><span class="lineno"><a href="143,277" id="srcline277">277</a></span><span class="line">        xpositionMirrTemp = sqrt(2/abs(Delta))*quadcosu2(ulimit);</span></span>
<span class="srcline"><span class="lineno"><a href="143,278" id="srcline278">278</a></span><span class="line">        ypositionMirrTemp = sqrt(2/abs(Delta))*quadsinu2(ulimit) * SignBeta;</span></span>
<span class="srcline"><span class="lineno"><a href="143,279" id="srcline279">279</a></span><span class="line">        <span class="comment">%mirror line Ax+By+C=0</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,280" id="srcline280">280</a></span><span class="line">        x_mirr = (x_outRot)/2;</span></span>
<span class="srcline"><span class="lineno"><a href="143,281" id="srcline281">281</a></span><span class="line">        y_mirr = (y_outRot)/2;</span></span>
<span class="srcline"><span class="lineno"><a href="143,282" id="srcline282">282</a></span><span class="line">        angle_mirr = pi/2 + atan((y_outRot)/(x_outRot));</span></span>
<span class="srcline"><span class="lineno"><a href="143,283" id="srcline283">283</a></span><span class="line">        A = tan(angle_mirr);</span></span>
<span class="srcline"><span class="lineno"><a href="143,284" id="srcline284">284</a></span><span class="line">        B = -1;</span></span>
<span class="srcline"><span class="lineno"><a href="143,285" id="srcline285">285</a></span><span class="line">        C = y_mirr - A * x_mirr;      </span></span>
<span class="srcline"><span class="lineno"><a href="143,286" id="srcline286">286</a></span><span class="line">        <span class="comment">%two points are symmetrical to the Ax+By+C we just defined</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,287" id="srcline287">287</a></span><span class="line">        xpositionTemp = xpositionMirrTemp - 2*A*(A*xpositionMirrTemp+B*ypositionMirrTemp+C)/(A^2+B^2);</span></span>
<span class="srcline"><span class="lineno"><a href="143,288" id="srcline288">288</a></span><span class="line">        ypositionTemp = ypositionMirrTemp - 2*B*(A*xpositionMirrTemp+B*ypositionMirrTemp+C)/(A^2+B^2);</span></span>
<span class="srcline"><span class="lineno"><a href="143,289" id="srcline289">289</a></span><span class="line">        Theta = 2*abs(Beta)*SignBeta - Delta * (Arclength - Arc)^2/2;          </span></span>
<span class="srcline"><span class="lineno"><a href="143,290" id="srcline290">290</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="143,291" id="srcline291">291</a></span><span class="line">    theta_rot = - angle_in;   </span></span>
<span class="srcline"><span class="lineno"><a href="143,292" id="srcline292">292</a></span><span class="line">    xposition = xpositionTemp*cos(theta_rot) + ypositionTemp*sin(theta_rot);</span></span>
<span class="srcline"><span class="lineno"><a href="143,293" id="srcline293">293</a></span><span class="line">    yposition = ypositionTemp*cos(theta_rot) - xpositionTemp*sin(theta_rot) ;  </span></span>
<span class="srcline"><span class="lineno"><a href="143,294" id="srcline294">294</a></span><span class="line">    xposition = xposition + x_in;</span></span>
<span class="srcline"><span class="lineno"><a href="143,295" id="srcline295">295</a></span><span class="line">    yposition = yposition + y_in;</span></span>
<span class="srcline"><span class="lineno"><a href="143,296" id="srcline296">296</a></span><span class="line">    Theta = Theta + angle_in;    </span></span>
<span class="srcline"><span class="lineno"><a href="143,297" id="srcline297">297</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="143,298" id="srcline298">298</a></span><span class="line"><span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,299" id="srcline299">299</a></span><span class="line">function [ x_qi,y_qi,theta_qi ] = qiConfigCal( x_in,y_in,angle_in,x_out,y_out,angle_out )</span></span>
<span class="srcline"><span class="lineno"><a href="143,300" id="srcline300">300</a></span><span class="line"><span class="comment">%UNTITLED2 Summary of this function goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,301" id="srcline301">301</a></span><span class="line"><span class="comment">%   Detailed explanation goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,302" id="srcline302">302</a></span><span class="line">    kesi_en = angle_out - angle_in;</span></span>
<span class="srcline"><span class="lineno"><a href="143,303" id="srcline303">303</a></span><span class="line">    r_en = sqrt((x_in-x_out)^2+(y_in-y_out)^2);</span></span>
<span class="srcline"><span class="lineno"><a href="143,304" id="srcline304">304</a></span><span class="line">    k_qi_en = 2 * sin(kesi_en/2)/r_en;    </span></span>
<span class="srcline"><span class="lineno"><a href="143,305" id="srcline305">305</a></span><span class="line">    if k_qi_en == 0</span></span>
<span class="srcline"><span class="lineno"><a href="143,306" id="srcline306">306</a></span><span class="line">        x_qi = (x_in + x_out)/2;</span></span>
<span class="srcline"><span class="lineno"><a href="143,307" id="srcline307">307</a></span><span class="line">        y_qi = (y_in + y_out)/2;</span></span>
<span class="srcline"><span class="lineno"><a href="143,308" id="srcline308">308</a></span><span class="line">        theta_qi = asin((y_out - y_in)/r_en) * 2 + (angle_in + angle_out)/2;        </span></span>
<span class="srcline"><span class="lineno"><a href="143,309" id="srcline309">309</a></span><span class="line">    else</span></span>
<span class="srcline"><span class="lineno"><a href="143,310" id="srcline310">310</a></span><span class="line">        r_qi_en = abs(1/k_qi_en);</span></span>
<span class="srcline"><span class="lineno"><a href="143,311" id="srcline311">311</a></span><span class="line">        angle_qi_CC = 2* asin(r_en*k_qi_en/2);</span></span>
<span class="srcline"><span class="lineno"><a href="143,312" id="srcline312">312</a></span><span class="line">        alpha_en = atan((y_out-y_in)/(x_out-x_in));</span></span>
<span class="srcline"><span class="lineno"><a href="143,313" id="srcline313">313</a></span><span class="line">        if (x_out &lt; x_in)</span></span>
<span class="srcline"><span class="lineno"><a href="143,314" id="srcline314">314</a></span><span class="line">            alpha_en = alpha_en + pi;</span></span>
<span class="srcline"><span class="lineno"><a href="143,315" id="srcline315">315</a></span><span class="line">        elseif angle_in &gt; pi</span></span>
<span class="srcline"><span class="lineno"><a href="143,316" id="srcline316">316</a></span><span class="line">            alpha_en = alpha_en + pi*2;</span></span>
<span class="srcline"><span class="lineno"><a href="143,317" id="srcline317">317</a></span><span class="line">        end</span></span>
<span class="srcline"><span class="lineno"><a href="143,318" id="srcline318">318</a></span><span class="line">        if alpha_en &gt; 1e-5</span></span>
<span class="srcline"><span class="lineno"><a href="143,319" id="srcline319">319</a></span><span class="line">            while alpha_en &gt; 2*pi</span></span>
<span class="srcline"><span class="lineno"><a href="143,320" id="srcline320">320</a></span><span class="line">                alpha_en = alpha_en - 2 * pi;</span></span>
<span class="srcline"><span class="lineno"><a href="143,321" id="srcline321">321</a></span><span class="line">            end</span></span>
<span class="srcline"><span class="lineno"><a href="143,322" id="srcline322">322</a></span><span class="line">        else</span></span>
<span class="srcline"><span class="lineno"><a href="143,323" id="srcline323">323</a></span><span class="line">            while alpha_en &lt; -2*pi</span></span>
<span class="srcline"><span class="lineno"><a href="143,324" id="srcline324">324</a></span><span class="line">                alpha_en = alpha_en + 2*pi;</span></span>
<span class="srcline"><span class="lineno"><a href="143,325" id="srcline325">325</a></span><span class="line">            end</span></span>
<span class="srcline"><span class="lineno"><a href="143,326" id="srcline326">326</a></span><span class="line">        end</span></span>
<span class="srcline"><span class="lineno"><a href="143,327" id="srcline327">327</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="143,328" id="srcline328">328</a></span><span class="line">        angle_qi = angle_qi_CC/2;</span></span>
<span class="srcline"><span class="lineno"><a href="143,329" id="srcline329">329</a></span><span class="line">        if k_qi_en == 0</span></span>
<span class="srcline"><span class="lineno"><a href="143,330" id="srcline330">330</a></span><span class="line">            signK = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="143,331" id="srcline331">331</a></span><span class="line">        else</span></span>
<span class="srcline"><span class="lineno"><a href="143,332" id="srcline332">332</a></span><span class="line">            signK = sign(k_qi_en);</span></span>
<span class="srcline"><span class="lineno"><a href="143,333" id="srcline333">333</a></span><span class="line">        end</span></span>
<span class="srcline"><span class="lineno"><a href="143,334" id="srcline334">334</a></span><span class="line">        a = r_qi_en * cos(-angle_qi_CC/2+angle_qi)-sqrt(r_qi_en^2-r_en^2/4);</span></span>
<span class="srcline"><span class="lineno"><a href="143,335" id="srcline335">335</a></span><span class="line">        b = r_qi_en * sin(-angle_qi_CC/2+angle_qi);</span></span>
<span class="srcline"><span class="lineno"><a href="143,336" id="srcline336">336</a></span><span class="line">        x_qi = a * sin(alpha_en) * signK - b * cos(alpha_en) * signK + (x_in + x_out) / 2;</span></span>
<span class="srcline"><span class="lineno"><a href="143,337" id="srcline337">337</a></span><span class="line">        y_qi = - a * cos(alpha_en) * signK - b * sin(alpha_en) * signK + (y_in + y_out) / 2 ; </span></span>
<span class="srcline"><span class="lineno"><a href="143,338" id="srcline338">338</a></span><span class="line">        theta_qi = - ( angle_in +angle_out )/2 + 2 * alpha_en;</span></span>
<span class="srcline"><span class="lineno"><a href="143,339" id="srcline339">339</a></span><span class="line">    end</span></span>
<span class="srcline"><span class="lineno"><a href="143,340" id="srcline340">340</a></span><span class="line">    if theta_qi &gt; 1e-5</span></span>
<span class="srcline"><span class="lineno"><a href="143,341" id="srcline341">341</a></span><span class="line">        while theta_qi &gt; 2*pi</span></span>
<span class="srcline"><span class="lineno"><a href="143,342" id="srcline342">342</a></span><span class="line">            theta_qi = theta_qi - 2 * pi;</span></span>
<span class="srcline"><span class="lineno"><a href="143,343" id="srcline343">343</a></span><span class="line">        end</span></span>
<span class="srcline"><span class="lineno"><a href="143,344" id="srcline344">344</a></span><span class="line">    else</span></span>
<span class="srcline"><span class="lineno"><a href="143,345" id="srcline345">345</a></span><span class="line">        while theta_qi &lt; -2*pi</span></span>
<span class="srcline"><span class="lineno"><a href="143,346" id="srcline346">346</a></span><span class="line">            theta_qi = theta_qi + 2*pi;</span></span>
<span class="srcline"><span class="lineno"><a href="143,347" id="srcline347">347</a></span><span class="line">        end</span></span>
<span class="srcline"><span class="lineno"><a href="143,348" id="srcline348">348</a></span><span class="line">    end       </span></span>
<span class="srcline"><span class="lineno"><a href="143,349" id="srcline349">349</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="143,350" id="srcline350">350</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="143,351" id="srcline351">351</a></span><span class="line">function [Delta,k_localmax,Arclength] = ElementaryPathPlot( x_in,y_in,angle_in,x_out,y_out,angle_out )</span></span>
<span class="srcline"><span class="lineno"><a href="143,352" id="srcline352">352</a></span><span class="line">    <span class="comment">%UNTITLED2 Summary of this function goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,353" id="srcline353">353</a></span><span class="line">    <span class="comment">%   Detailed explanation goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,354" id="srcline354">354</a></span><span class="line">    Nlen = 20;</span></span>
<span class="srcline"><span class="lineno"><a href="143,355" id="srcline355">355</a></span><span class="line">    xposition = zeros(Nlen,1);</span></span>
<span class="srcline"><span class="lineno"><a href="143,356" id="srcline356">356</a></span><span class="line">    yposition = zeros(Nlen,1);</span></span>
<span class="srcline"><span class="lineno"><a href="143,357" id="srcline357">357</a></span><span class="line">    Theta = zeros(Nlen,1);</span></span>
<span class="srcline"><span class="lineno"><a href="143,358" id="srcline358">358</a></span><span class="line">    kur = zeros(Nlen,1);</span></span>
<span class="srcline"><span class="lineno"><a href="143,359" id="srcline359">359</a></span><span class="line">    <span class="comment">%ArcPos = zeros(Nlen,1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,360" id="srcline360">360</a></span><span class="line">    Beta = (angle_out - angle_in)/2;</span></span>
<span class="srcline"><span class="lineno"><a href="143,361" id="srcline361">361</a></span><span class="line">    r = sqrt((x_in-x_out)^2+(y_in-y_out)^2);</span></span>
<span class="srcline"><span class="lineno"><a href="143,362" id="srcline362">362</a></span><span class="line">    <span class="comment">%Move</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,363" id="srcline363">363</a></span><span class="line">    x_inMove = x_in - x_in;</span></span>
<span class="srcline"><span class="lineno"><a href="143,364" id="srcline364">364</a></span><span class="line">    y_inMove = y_in - y_in;</span></span>
<span class="srcline"><span class="lineno"><a href="143,365" id="srcline365">365</a></span><span class="line">    x_outMove = x_out - x_in;</span></span>
<span class="srcline"><span class="lineno"><a href="143,366" id="srcline366">366</a></span><span class="line">    y_outMove = y_out - y_in;</span></span>
<span class="srcline"><span class="lineno"><a href="143,367" id="srcline367">367</a></span><span class="line">    <span class="comment">%Rotate</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,368" id="srcline368">368</a></span><span class="line">    theta_rot = angle_in;</span></span>
<span class="srcline"><span class="lineno"><a href="143,369" id="srcline369">369</a></span><span class="line">    x_inRot = x_inMove*cos(theta_rot) + y_inMove*sin(theta_rot);</span></span>
<span class="srcline"><span class="lineno"><a href="143,370" id="srcline370">370</a></span><span class="line">    x_outRot = x_outMove*cos(theta_rot) + y_outMove*sin(theta_rot);</span></span>
<span class="srcline"><span class="lineno"><a href="143,371" id="srcline371">371</a></span><span class="line">    y_inRot = y_inMove*cos(theta_rot) - x_inMove*sin(theta_rot);</span></span>
<span class="srcline"><span class="lineno"><a href="143,372" id="srcline372">372</a></span><span class="line">    y_outRot = y_outMove*cos(theta_rot) - x_outMove*sin(theta_rot);    </span></span>
<span class="srcline"><span class="lineno"><a href="143,373" id="srcline373">373</a></span><span class="line">    SignBeta = sign(Beta);</span></span>
<span class="srcline"><span class="lineno"><a href="143,374" id="srcline374">374</a></span><span class="line">    Beta = abs(Beta);</span></span>
<span class="srcline"><span class="lineno"><a href="143,375" id="srcline375">375</a></span><span class="line">    ulimit = sqrt(Beta);</span></span>
<span class="srcline"><span class="lineno"><a href="143,376" id="srcline376">376</a></span><span class="line">    D_BetaVal = sin(Beta)*quadsinu2(ulimit)+cos(Beta)*quadcosu2(ulimit);</span></span>
<span class="srcline"><span class="lineno"><a href="143,377" id="srcline377">377</a></span><span class="line">    <span class="comment">%Droot = fzero(@(x) sin(x)*quadsinu2(x)+cos(x)*quadcosu2(x), pi);</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,378" id="srcline378">378</a></span><span class="line">    Delta = 8*SignBeta*D_BetaVal^2/r^2;</span></span>
<span class="srcline"><span class="lineno"><a href="143,379" id="srcline379">379</a></span><span class="line">    <span class="comment">%longth of the trajectary     </span></span></span>
<span class="srcline"><span class="lineno"><a href="143,380" id="srcline380">380</a></span><span class="line">    Arclength = 2*sqrt(2*abs(Beta/Delta*SignBeta));</span></span>
<span class="srcline"><span class="lineno"><a href="143,381" id="srcline381">381</a></span><span class="line">    k_localmax = Delta * Arclength/2;    </span></span>
<span class="srcline"><span class="lineno"><a href="143,382" id="srcline382">382</a></span><span class="line"><span class="comment">%     ArcPos = 0:(Arclength/Nlen):Arclength;</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,383" id="srcline383">383</a></span><span class="line">    <span class="comment">%mirror line Ax+By+C=0</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,384" id="srcline384">384</a></span><span class="line"><span class="comment">%     x_mirr = (x_inRot + x_outRot)/2;</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,385" id="srcline385">385</a></span><span class="line"><span class="comment">%     y_mirr = (y_inRot + y_outRot)/2;</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,386" id="srcline386">386</a></span><span class="line"><span class="comment">%     angle_mirr = pi/2 + atan((y_outRot - y_inRot)/(x_outRot - x_inRot));    </span></span></span>
<span class="srcline"><span class="lineno"><a href="143,387" id="srcline387">387</a></span><span class="line"><span class="comment">%     A = tan(angle_mirr);</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,388" id="srcline388">388</a></span><span class="line"><span class="comment">%     B = -1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,389" id="srcline389">389</a></span><span class="line"><span class="comment">%     C = y_mirr - A * x_mirr;    </span></span></span>
<span class="srcline"><span class="lineno"><a href="143,390" id="srcline390">390</a></span><span class="line"><span class="comment">%     for i=1:length(ArcPos)</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,391" id="srcline391">391</a></span><span class="line"><span class="comment">%         if ArcPos(i)&lt;=Arclength/2</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,392" id="srcline392">392</a></span><span class="line"><span class="comment">%             ulimit = ArcPos(i) * sqrt(abs(Delta)/2);</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,393" id="srcline393">393</a></span><span class="line"><span class="comment">%             xposition(i) = sqrt(2/abs(Delta))*quadcosu2(ulimit);</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,394" id="srcline394">394</a></span><span class="line"><span class="comment">%             yposition(i) = sqrt(2/abs(Delta))*quadsinu2(ulimit) * SignBeta;</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,395" id="srcline395">395</a></span><span class="line"><span class="comment">%             Theta(i) = Delta * (ArcPos(i))^2/2;</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,396" id="srcline396">396</a></span><span class="line"><span class="comment">%             kur(i) = ArcPos(i)*Delta;</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,397" id="srcline397">397</a></span><span class="line"><span class="comment">%             </span></span></span>
<span class="srcline"><span class="lineno"><a href="143,398" id="srcline398">398</a></span><span class="line"><span class="comment">%         else</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,399" id="srcline399">399</a></span><span class="line"><span class="comment">%             ulimit = (Arclength - ArcPos(i)) * sqrt(abs(Delta)/2);   </span></span></span>
<span class="srcline"><span class="lineno"><a href="143,400" id="srcline400">400</a></span><span class="line"><span class="comment">%             xpositionMirrTemp = sqrt(2/abs(Delta))*quadcosu2(ulimit);</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,401" id="srcline401">401</a></span><span class="line"><span class="comment">%             ypositionMirrTemp = sqrt(2/abs(Delta))*quadsinu2(ulimit) * SignBeta;</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,402" id="srcline402">402</a></span><span class="line"><span class="comment">%             %two points are symmetrical to the Ax+By+C we just defined</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,403" id="srcline403">403</a></span><span class="line"><span class="comment">%             xposition(i) = xpositionMirrTemp - 2*A*(A*xpositionMirrTemp+B*ypositionMirrTemp+C)/(A^2+B^2);</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,404" id="srcline404">404</a></span><span class="line"><span class="comment">%             yposition(i) = ypositionMirrTemp - 2*B*(A*xpositionMirrTemp+B*ypositionMirrTemp+C)/(A^2+B^2);</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,405" id="srcline405">405</a></span><span class="line"><span class="comment">%             Theta(i) = 2*Beta*SignBeta - Delta * (Arclength - ArcPos(i))^2/2;  </span></span></span>
<span class="srcline"><span class="lineno"><a href="143,406" id="srcline406">406</a></span><span class="line"><span class="comment">%             kur(i) = (Arclength - ArcPos(i))*Delta;  </span></span></span>
<span class="srcline"><span class="lineno"><a href="143,407" id="srcline407">407</a></span><span class="line"><span class="comment">%             </span></span></span>
<span class="srcline"><span class="lineno"><a href="143,408" id="srcline408">408</a></span><span class="line"><span class="comment">%         end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,409" id="srcline409">409</a></span><span class="line"><span class="comment">%         %Rotate and move back</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,410" id="srcline410">410</a></span><span class="line"><span class="comment">%         x_positionMove = xposition(i)*cos(-theta_rot) + yposition(i)*sin(-theta_rot);</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,411" id="srcline411">411</a></span><span class="line"><span class="comment">%         y_positionMove = yposition(i)*cos(-theta_rot) - xposition(i)*sin(-theta_rot);</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,412" id="srcline412">412</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="143,413" id="srcline413">413</a></span><span class="line"><span class="comment">%         xposition(i) = x_positionMove + x_in;</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,414" id="srcline414">414</a></span><span class="line"><span class="comment">%         yposition(i) = y_positionMove + y_in;</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,415" id="srcline415">415</a></span><span class="line"><span class="comment">%         Theta(i) = Theta(i) + theta_rot;</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,416" id="srcline416">416</a></span><span class="line"><span class="comment">%     end   </span></span></span>
<span class="srcline"><span class="lineno"><a href="143,417" id="srcline417">417</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="143,418" id="srcline418">418</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="143,419" id="srcline419">419</a></span><span class="line">function quadcosu2val = quadcosu2( ulimit )</span></span>
<span class="srcline"><span class="lineno"><a href="143,420" id="srcline420">420</a></span><span class="line">    <span class="comment">%UNTITLED4 Summary of this function goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,421" id="srcline421">421</a></span><span class="line">    <span class="comment">%   Detailed explanation goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,422" id="srcline422">422</a></span><span class="line">    <span class="comment">% this function is used to calculate the integral of cos(x^2),which is used</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,423" id="srcline423">423</a></span><span class="line">    <span class="comment">% to calculate x position</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,424" id="srcline424">424</a></span><span class="line">    global quadcosu2tbl</span></span>
<span class="srcline"><span class="lineno"><a href="143,425" id="srcline425">425</a></span><span class="line">    index = fix(ulimit/0.005) + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="143,426" id="srcline426">426</a></span><span class="line">    quadcosu2val = quadcosu2tbl(index);</span></span>
<span class="srcline"><span class="lineno"><a href="143,427" id="srcline427">427</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="143,428" id="srcline428">428</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="143,429" id="srcline429">429</a></span><span class="line">function quadsinu2val = quadsinu2( ulimit )</span></span>
<span class="srcline"><span class="lineno"><a href="143,430" id="srcline430">430</a></span><span class="line"><span class="comment">%UNTITLED4 Summary of this function goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,431" id="srcline431">431</a></span><span class="line"><span class="comment">%   Detailed explanation goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,432" id="srcline432">432</a></span><span class="line"><span class="comment">% this function is used to calculate the integral of sin(x^2),which is used</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,433" id="srcline433">433</a></span><span class="line"><span class="comment">% to calculate y position</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,434" id="srcline434">434</a></span><span class="line">    global quadsinu2tbl </span></span>
<span class="srcline"><span class="lineno"><a href="143,435" id="srcline435">435</a></span><span class="line">    index = fix(ulimit/0.005) + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="143,436" id="srcline436">436</a></span><span class="line">    quadsinu2val = quadsinu2tbl(index);</span></span>
<span class="srcline"><span class="lineno"><a href="143,437" id="srcline437">437</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="143,438" id="srcline438">438</a></span><span class="line"> </span></span>
</pre>
</div>
